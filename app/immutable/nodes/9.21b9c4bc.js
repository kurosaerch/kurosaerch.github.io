import{s as re,a as z,f as Q,V as oe,l as B,x as ne,d as b,c as $,g as V,h as j,W as le,m as R,j as A,i as x,u,n as K,G as ie,C as O}from"../chunks/scheduler.32f194ce.js";import{S as ce,i as me,b as M,d as W,m as F,a as J,t as X,e as Y}from"../chunks/index.aa0a4971.js";import{e as te}from"../chunks/each.e59479a4.js";import{K as ue,A as ge}from"../chunks/ActiveTagList.a34015b3.js";import{S as pe}from"../chunks/Searchbar.cad92e75.js";import{g as fe,a as he}from"../chunks/tags.49324235.js";import{a as Z,r as de}from"../chunks/active-supertags-store.191bceb4.js";import{a as G}from"../chunks/active-tags-store.b6c3d1de.js";import{S as _e,f as we,s as Se}from"../chunks/search-builder.8e7a2c78.js";import{b as ve}from"../chunks/blocked-content-store.4020ee6a.js";import{n as ye,s as be}from"../chunks/supertags-store.5b66bb0f.js";function ae(s,n,t){const r=s.slice();return r[16]=n[t],r}function se(s){let n,t=s[16][0]+"",r,v,c=s[16][1]+"",h;return{c(){n=Q("p"),r=B(t),v=B("="),h=B(c),this.h()},l(o){n=V(o,"P",{class:!0});var l=j(n);r=R(l,t),v=R(l,"="),h=R(l,c),l.forEach(b),this.h()},h(){A(n,"class","fixed svelte-15wziqd")},m(o,l){x(o,n,l),u(n,r),u(n,v),u(n,h)},p(o,l){l&16&&t!==(t=o[16][0]+"")&&K(r,t),l&16&&c!==(c=o[16][1]+"")&&K(h,c)},d(o){o&&b(n)}}}function Ce(s){let n,t,r,v,c,h,o,l,d,C,q,g,_,D,H,L,y,P=s[3][0]+"",e,E,f=s[3][1]+"",w,T;r=new ue({}),c=new pe({props:{placeholder:"Search for tags",fetchSuggestions:s[7]}}),c.$on("pick",s[12]),o=new ge({props:{tags:[...s[2],...s[1]]}}),o.$on("click",s[13]),o.$on("contextmenu",s[14]);let N=te(s[4]),m=[];for(let a=0;a<N.length;a+=1)m[a]=se(ae(s,N,a));return{c(){n=z(),t=Q("section"),M(r.$$.fragment),v=z(),M(c.$$.fragment),h=z(),M(o.$$.fragment),l=z(),d=Q("code"),C=new oe(!1),q=z(),g=Q("code"),_=Q("p"),D=B(s[5]),H=z();for(let a=0;a<m.length;a+=1)m[a].c();L=z(),y=Q("p"),e=B(P),E=B("="),w=B(f),this.h()},l(a){ne("svelte-fr2gtz",document.head).forEach(b),n=$(a),t=V(a,"SECTION",{class:!0});var i=j(t);W(r.$$.fragment,i),v=$(i),W(c.$$.fragment,i),h=$(i),W(o.$$.fragment,i),l=$(i),d=V(i,"CODE",{class:!0});var p=j(d);C=le(p,!1),p.forEach(b),q=$(i),g=V(i,"CODE",{class:!0});var k=j(g);_=V(k,"P",{class:!0});var ee=j(_);D=R(ee,s[5]),ee.forEach(b),H=$(k);for(let I=0;I<m.length;I+=1)m[I].l(k);L=$(k),y=V(k,"P",{class:!0});var U=j(y);e=R(U,P),E=R(U,"="),w=R(U,f),U.forEach(b),k.forEach(b),i.forEach(b),this.h()},h(){document.title="kurosearch - Query Builder",C.a=null,A(d,"class","svelte-15wziqd"),A(_,"class","base svelte-15wziqd"),A(y,"class","tags svelte-15wziqd"),A(g,"class","svelte-15wziqd"),A(t,"class","svelte-15wziqd")},m(a,S){x(a,n,S),x(a,t,S),F(r,t,null),u(t,v),F(c,t,null),u(t,h),F(o,t,null),u(t,l),u(t,d),C.m(s[0],d),u(t,q),u(t,g),u(g,_),u(_,D),u(g,H);for(let i=0;i<m.length;i+=1)m[i]&&m[i].m(g,null);u(g,L),u(g,y),u(y,e),u(y,E),u(y,w),T=!0},p(a,[S]){const i={};if(S&6&&(i.tags=[...a[2],...a[1]]),o.$set(i),(!T||S&1)&&C.p(a[0]),(!T||S&32)&&K(D,a[5]),S&16){N=te(a[4]);let p;for(p=0;p<N.length;p+=1){const k=ae(a,N,p);m[p]?m[p].p(k,S):(m[p]=se(k),m[p].c(),m[p].m(g,L))}for(;p<m.length;p+=1)m[p].d(1);m.length=N.length}(!T||S&8)&&P!==(P=a[3][0]+"")&&K(e,P),(!T||S&8)&&f!==(f=a[3][1]+"")&&K(w,f)},i(a){T||(J(r.$$.fragment,a),J(c.$$.fragment,a),J(o.$$.fragment,a),T=!0)},o(a){X(r.$$.fragment,a),X(c.$$.fragment,a),X(o.$$.fragment,a),T=!1},d(a){a&&(b(n),b(t)),Y(r),Y(c),Y(o),ie(m,a)}}}function ke(s,n,t){let r,v,c,h,o,l,d,C,q,g,_;O(s,Z,e=>t(1,o=e)),O(s,we,e=>t(8,l=e)),O(s,Se,e=>t(9,d=e)),O(s,ve,e=>t(10,C=e)),O(s,G,e=>t(2,q=e)),O(s,de,e=>t(11,g=e)),O(s,be,e=>t(6,_=e));const D=async e=>{const E=await fe(e);return[..._.items.filter(({name:w})=>w.toLowerCase().includes(e.toLowerCase())).map(w=>({label:w.name,count:w.tags.length,type:"supertag"})),...E]},H=e=>{try{return new URL(e)}catch{return null}},L=async e=>{const E=e.detail;if(E.type==="supertag"){const f=_.items.find(w=>w.name===E.label);if(!f){console.warn("Supertag not present.");return}Z.addOrReplace(f)}else{const f=await he(e.detail.label);G.addOrReplace({name:e.detail.label,modifier:e.detail.modifier,count:e.detail.count,type:(f==null?void 0:f.type)??"tag"})}},y=e=>"description"in e.detail?Z.removeByName(e.detail.name):G.removeByName(e.detail.name),P=e=>{"description"in e.detail||(e.detail.modifier=ye(e.detail.modifier),G.addOrReplace(e.detail))};return s.$$.update=()=>{s.$$.dirty&3846&&t(0,r=H(new _e().withPid(g.pageCount).withTags(q).withBlockedContent(C).withSortProperty(d.property).withSortDirection(d.direction).withScoreValue(l.scoreValue).withScoreComparator(l.scoreComparator).withRating(l.rating).withSupertags(o).getQuery())),s.$$.dirty&1&&t(5,v=r&&`${r.protocol}//${r.hostname}`),s.$$.dirty&1&&t(4,c=r?[...r.searchParams.entries()].filter(([e])=>["page","s","q","fields","json","limit"].includes(e)):[]),s.$$.dirty&1&&t(3,h=r?[...r.searchParams.entries()].find(([e])=>e==="tags")??["tags",""]:["tags",""])},[r,o,q,h,c,v,_,D,l,d,C,g,L,y,P]}class Ne extends ce{constructor(n){super(),me(this,n,ke,Ce,re,{})}}export{Ne as component};
