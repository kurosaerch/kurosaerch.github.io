import{s as oe,f as I,a as T,g as D,c as O,y as ue,D as pe,j as b,i as P,d as h,E as ge,l as x,m as ee,e as de,h as R,u as w,F as le,n as Oe,C as ce,G as bt,p as ke,H as Se,I as je,J as ct,K as Ae,L as Ee,v as W,k as ze,M as qe,w as kt,N as wt,z as yt,A as St,B as Et,o as Be,O as Me,P as Ge,r as ut}from"../chunks/scheduler.88299003.js";import{S as ie,i as ae,b as L,d as F,m as A,a as y,t as E,e as B,g as te,c as se,f as Le}from"../chunks/index.15b414ac.js";import{a as Pe}from"../chunks/posts.779cfae3.js";import{s as fe,f as be,r as Te,K as Ct,A as It,a as Ue,S as Dt}from"../chunks/search-builder.db79c358.js";import{S as Nt,n as Pt,s as Ze}from"../chunks/supertags-store.6cf2e13e.js";import{T as Re}from"../chunks/TextButton.2f318c50.js";import{g as Tt,a as Ot}from"../chunks/tags.49324235.js";import{b as ft}from"../chunks/paths.79f06881.js";import{e as Ce}from"../chunks/each.e59479a4.js";import{D as pt,r as Rt}from"../chunks/Dialog.1398ea51.js";import{i as dt,D as gt,g as Vt,G as _t,V as jt,I as Lt}from"../chunks/Details.acdea8cd.js";import{f as Ve}from"../chunks/format-tag.7e313273.js";import{R as Ft,I as Fe}from"../chunks/ModifierSelect.623aacd6.js";import{S as Je}from"../chunks/Select.22805bc7.js";import{R as At}from"../chunks/RotatingTextSelect.7e32facf.js";import{b as Bt}from"../chunks/blocked-content-store.8cb9d99a.js";import{D as Mt}from"../chunks/DetailedTag.8c9e45d9.js";import{S as Ut}from"../chunks/ScrollUpButton.cfa21b3f.js";import{l as zt}from"../chunks/analytics.eca95ce1.js";import{s as qt}from"../chunks/feature-support.28b8c2a5.js";function Gt(n){let e;return{c(){e=x("Reset Filter")},l(s){e=ee(s,"Reset Filter")},m(s,t){P(s,e,t)},d(s){s&&h(e)}}}function Kt(n){let e,s,t,r,o="We couldn't find any posts matching your tags. Sorry...",l,i,a;return i=new Re({props:{title:"In case your filter caused all posts to vanish. Reset it.",$$slots:{default:[Gt]},$$scope:{ctx:n}}}),i.$on("click",n[1]),{c(){e=I("img"),t=T(),r=I("p"),r.textContent=o,l=T(),L(i.$$.fragment),this.h()},l(f){e=D(f,"IMG",{src:!0,alt:!0,class:!0}),t=O(f),r=D(f,"P",{"data-svelte-h":!0}),ue(r)!=="svelte-1utxj3w"&&(r.textContent=o),l=O(f),F(i.$$.fragment,f),this.h()},h(){pe(e.src,s=ft+"/assets/shironeko-confused.png")||b(e,"src",s),b(e,"alt","Nothing here..."),b(e,"class","svelte-1bb5e7g")},m(f,c){P(f,e,c),P(f,t,c),P(f,r,c),P(f,l,c),A(i,f,c),a=!0},p(f,[c]){const d={};c&4&&(d.$$scope={dirty:c,ctx:f}),i.$set(d)},i(f){a||(y(i.$$.fragment,f),a=!0)},o(f){E(i.$$.fragment,f),a=!1},d(f){f&&(h(e),h(t),h(r),h(l)),B(i,f)}}}function Wt(n){const e=ge();return[e,()=>{fe.reset(),fe.reset(),e("sortfilterupdate")}]}class Ht extends ie{constructor(e){super(),ae(this,e,Wt,Kt,oe,{})}}function Qe(n){let e,s;return e=new pt({props:{$$slots:{default:[Jt]},$$scope:{ctx:n}}}),e.$on("close",n[7]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&65543&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function Yt(n){let e;return{c(){e=x("Done")},l(s){e=ee(s,"Done")},m(s,t){P(s,e,t)},d(s){s&&h(e)}}}function Zt(n){let e;return{c(){e=x("Reset")},l(s){e=ee(s,"Reset")},m(s,t){P(s,e,t)},d(s){s&&h(e)}}}function Jt(n){let e,s,t="Sorting and Filtering",r,o,l,i="Sorting",a,f,c,d,g,v,$,k,_,m,u="Filtering by Score",p,C,H,Q,Y,K,ne,Z,X,S="Filtering by Rating",G,z,N,we,j,V,J,U,re,ye,Ie;function De(M){n[10](M)}let Ke={options:xt};n[1].direction!==void 0&&(Ke.value=n[1].direction),c=new Ft({props:Ke}),ke.push(()=>Le(c,"value",De));function ht(M){n[11](M)}let We={options:Xt};n[1].property!==void 0&&(We.value=n[1].property),v=new Je({props:We}),ke.push(()=>Le(v,"value",ht));function $t(M){n[12](M)}let He={options:es};n[2].scoreComparator!==void 0&&(He.value=n[2].scoreComparator),H=new At({props:He}),ke.push(()=>Le(H,"value",$t));function vt(M){n[14](M)}let Ye={options:mt};return n[2].rating!==void 0&&(Ye.value=n[2].rating),N=new Je({props:Ye}),ke.push(()=>Le(N,"value",vt)),V=new Re({props:{title:"Return to searching.",$$slots:{default:[Yt]},$$scope:{ctx:n}}}),V.$on("click",n[7]),U=new Re({props:{title:"Reset sort and filter.",type:"secondary",$$slots:{default:[Zt]},$$scope:{ctx:n}}}),U.$on("click",n[9]),{c(){e=I("div"),s=I("h3"),s.textContent=t,r=T(),o=I("div"),l=I("b"),l.textContent=i,a=T(),f=I("div"),L(c.$$.fragment),g=T(),L(v.$$.fragment),k=T(),_=I("div"),m=I("b"),m.textContent=u,p=T(),C=I("div"),L(H.$$.fragment),Y=T(),K=I("input"),ne=T(),Z=I("div"),X=I("b"),X.textContent=S,G=T(),z=I("div"),L(N.$$.fragment),j=T(),L(V.$$.fragment),J=T(),L(U.$$.fragment),this.h()},l(M){e=D(M,"DIV",{class:!0});var q=R(e);s=D(q,"H3",{"data-svelte-h":!0}),ue(s)!=="svelte-15zouq3"&&(s.textContent=t),r=O(q),o=D(q,"DIV",{});var _e=R(o);l=D(_e,"B",{class:!0,"data-svelte-h":!0}),ue(l)!=="svelte-ekzpgg"&&(l.textContent=i),a=O(_e),f=D(_e,"DIV",{class:!0});var me=R(f);F(c.$$.fragment,me),g=O(me),F(v.$$.fragment,me),me.forEach(h),_e.forEach(h),k=O(q),_=D(q,"DIV",{});var he=R(_);m=D(he,"B",{class:!0,"data-svelte-h":!0}),ue(m)!=="svelte-1flca3"&&(m.textContent=u),p=O(he),C=D(he,"DIV",{class:!0});var $e=R(C);F(H.$$.fragment,$e),Y=O($e),K=D($e,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),$e.forEach(h),he.forEach(h),ne=O(q),Z=D(q,"DIV",{});var ve=R(Z);X=D(ve,"B",{class:!0,"data-svelte-h":!0}),ue(X)!=="svelte-1evbw58"&&(X.textContent=S),G=O(ve),z=D(ve,"DIV",{class:!0});var Ne=R(z);F(N.$$.fragment,Ne),Ne.forEach(h),ve.forEach(h),j=O(q),F(V.$$.fragment,q),J=O(q),F(U.$$.fragment,q),q.forEach(h),this.h()},h(){b(l,"class","svelte-gf4ubn"),b(f,"class","row svelte-gf4ubn"),b(m,"class","svelte-gf4ubn"),b(K,"type","number"),b(K,"min",0),b(K,"max",1e5),b(K,"step",1),b(K,"class","svelte-gf4ubn"),b(C,"class","row svelte-gf4ubn"),b(X,"class","svelte-gf4ubn"),b(z,"class","row svelte-gf4ubn"),b(e,"class","container svelte-gf4ubn")},m(M,q){P(M,e,q),w(e,s),w(e,r),w(e,o),w(o,l),w(o,a),w(o,f),A(c,f,null),w(f,g),A(v,f,null),w(e,k),w(e,_),w(_,m),w(_,p),w(_,C),A(H,C,null),w(C,Y),w(C,K),Se(K,n[0]),w(e,ne),w(e,Z),w(Z,X),w(Z,G),w(Z,z),A(N,z,null),w(e,j),A(V,e,null),w(e,J),A(U,e,null),re=!0,ye||(Ie=[le(K,"input",n[13]),le(K,"keyup",n[8])],ye=!0)},p(M,q){const _e={};!d&&q&2&&(d=!0,_e.value=M[1].direction,je(()=>d=!1)),c.$set(_e);const me={};!$&&q&2&&($=!0,me.value=M[1].property,je(()=>$=!1)),v.$set(me);const he={};!Q&&q&4&&(Q=!0,he.value=M[2].scoreComparator,je(()=>Q=!1)),H.$set(he),q&1&&ct(K.value)!==M[0]&&Se(K,M[0]);const $e={};!we&&q&4&&(we=!0,$e.value=M[2].rating,je(()=>we=!1)),N.$set($e);const ve={};q&65536&&(ve.$$scope={dirty:q,ctx:M}),V.$set(ve);const Ne={};q&65536&&(Ne.$$scope={dirty:q,ctx:M}),U.$set(Ne)},i(M){re||(y(c.$$.fragment,M),y(v.$$.fragment,M),y(H.$$.fragment,M),y(N.$$.fragment,M),y(V.$$.fragment,M),y(U.$$.fragment,M),re=!0)},o(M){E(c.$$.fragment,M),E(v.$$.fragment,M),E(H.$$.fragment,M),E(N.$$.fragment,M),E(V.$$.fragment,M),E(U.$$.fragment,M),re=!1},d(M){M&&h(e),B(c),B(v),B(H),B(N),B(V),B(U),ye=!1,Ae(Ie)}}}function Qt(n){let e,s,t,r,o,l,i,a,f,c,d,g,v,$,k,_=n[3]&&Qe(n);return{c(){e=I("button"),s=I("i"),t=T(),r=I("span"),o=x(n[5]),l=T(),i=I("i"),a=T(),f=I("span"),c=x(n[4]),d=T(),_&&_.c(),g=de(),this.h()},l(m){e=D(m,"BUTTON",{class:!0});var u=R(e);s=D(u,"I",{class:!0}),R(s).forEach(h),t=O(u),r=D(u,"SPAN",{});var p=R(r);o=ee(p,n[5]),p.forEach(h),l=O(u),i=D(u,"I",{class:!0}),R(i).forEach(h),a=O(u),f=D(u,"SPAN",{});var C=R(f);c=ee(C,n[4]),C.forEach(h),u.forEach(h),d=O(m),_&&_.l(m),g=de(),this.h()},h(){b(s,"class","codicon codicon-filter svelte-gf4ubn"),b(i,"class","codicon codicon-arrow-swap svelte-gf4ubn"),b(e,"class","svelte-gf4ubn")},m(m,u){P(m,e,u),w(e,s),w(e,t),w(e,r),w(r,o),w(e,l),w(e,i),w(e,a),w(e,f),w(f,c),P(m,d,u),_&&_.m(m,u),P(m,g,u),v=!0,$||(k=le(e,"click",n[6]),$=!0)},p(m,[u]){(!v||u&32)&&Oe(o,m[5]),(!v||u&16)&&Oe(c,m[4]),m[3]?_?(_.p(m,u),u&8&&y(_,1)):(_=Qe(m),_.c(),y(_,1),_.m(g.parentNode,g)):_&&(te(),E(_,1,1,()=>{_=null}),se())},i(m){v||(y(_),v=!0)},o(m){E(_),v=!1},d(m){m&&(h(e),h(d),h(g)),_&&_.d(m),$=!1,k()}}}const Xt=Object.freeze({id:"Uploaded",score:"Score",updated:"Updated"}),xt=Object.freeze({desc:"codicon codicon-arrow-down",asc:"codicon codicon-arrow-up"}),es=Object.freeze({">=":"≥","<=":"≤"}),mt=Object.freeze({all:"All",safe:"Safe",questionable:"Questionable",explicit:"Explicit"}),ts=Object.freeze({id:{asc:"Oldest",desc:"Newest"},score:{asc:"Worst",desc:"Best"},updated:{asc:"Inactive",desc:"Active"}}),ss=(n,e,s)=>{let t=n==="all"?void 0:mt[n],r=e===0&&s===">="?void 0:`Score${s}${Ve(e)}`;return[t,r].filter(o=>o!==void 0).join(",")||"All"};function ns(n,e,s){let t,r,o,l;ce(n,fe,p=>s(1,o=p)),ce(n,be,p=>s(2,l=p));const i=ge();let a=!1;const f=()=>s(3,a=!0),c=()=>{s(3,a=!1),i("sortfilterupdate")},d=p=>{var C;return dt(p)&&((C=p.target)==null?void 0:C.blur())},g=()=>{fe.reset(),be.reset(),s(0,v=l.scoreValue)};let v;function $(p){n.$$.not_equal(o.direction,p)&&(o.direction=p,fe.set(o))}function k(p){n.$$.not_equal(o.property,p)&&(o.property=p,fe.set(o))}function _(p){n.$$.not_equal(l.scoreComparator,p)&&(l.scoreComparator=p,be.set(l))}function m(){v=ct(this.value),s(0,v),s(2,l)}function u(p){n.$$.not_equal(l.rating,p)&&(l.rating=p,be.set(l))}return n.$$.update=()=>{if(n.$$.dirty&5){v===void 0&&s(0,v=l.scoreValue);let p=Number(v);isNaN(p)||bt(be,l.scoreValue=p,l)}n.$$.dirty&4&&s(5,t=ss(l.rating,l.scoreValue,l.scoreComparator)),n.$$.dirty&2&&s(4,r=ts[o.property][o.direction])},[v,o,l,a,r,t,f,c,d,g,$,k,_,m,u]}class rs extends ie{constructor(e){super(),ae(this,e,ns,Qt,oe,{})}}function ls(n){const e=n.slice(),s=Vt(e[1].file_url,e[1].sample_url,e[1].preview_url);return e[6]=s,e}function os(n){let e,s;return e=new _t({props:{post:n[1]}}),e.$on("click",n[3]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.post=t[1]),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function is(n){let e,s;return e=new jt({props:{src:n[6].animated,poster:n[6].static,width:n[1].width,height:n[1].height,loop:n[1].tags.some(xe)}}),e.$on("click",n[3]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.src=t[6].animated),r&2&&(o.poster=t[6].static),r&2&&(o.width=t[1].width),r&2&&(o.height=t[1].height),r&2&&(o.loop=t[1].tags.some(xe)),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function as(n){let e,s;return e=new Lt({props:{post:n[1],open:n[0]}}),e.$on("click",n[3]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.post=t[1]),r&1&&(o.open=t[0]),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function cs(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),R(e).forEach(h),this.h()},h(){b(e,"class","codicon codicon-screen-full")},m(s,t){P(s,e,t)},p:W,d(s){s&&h(e)}}}function Xe(n){let e,s;return e=new gt({props:{post:n[1]}}),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.post=t[1]),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function us(n){let e,s,t,r,o,l,i,a,f,c;const d=[as,is,os],g=[];function v(_,m){return _[1].type==="image"?0:_[1].type==="video"?1:2}function $(_,m){return m===1?ls(_):_}s=v(n),t=g[s]=d[s]($(n,s)),o=new Fe({props:{class:"button-fullscreen","aria-label":"Enter Fullscreen mode",$$slots:{default:[cs]},$$scope:{ctx:n}}}),o.$on("click",n[4]);let k=n[0]&&Xe(n);return{c(){e=I("div"),t.c(),r=T(),L(o.$$.fragment),l=T(),k&&k.c(),this.h()},l(_){e=D(_,"DIV",{id:!0,class:!0});var m=R(e);t.l(m),r=O(m),F(o.$$.fragment,m),l=O(m),k&&k.l(m),m.forEach(h),this.h()},h(){b(e,"id",i="post_"+n[1].id),b(e,"class","post svelte-pwgq1f"),Ee(e,"open",n[0])},m(_,m){P(_,e,m),g[s].m(e,null),w(e,r),A(o,e,null),w(e,l),k&&k.m(e,null),a=!0,f||(c=le(e,"keydown",n[5]),f=!0)},p(_,[m]){let u=s;s=v(_),s===u?g[s].p($(_,s),m):(te(),E(g[u],1,1,()=>{g[u]=null}),se(),t=g[s],t?t.p($(_,s),m):(t=g[s]=d[s]($(_,s)),t.c()),y(t,1),t.m(e,r));const p={};m&128&&(p.$$scope={dirty:m,ctx:_}),o.$set(p),_[0]?k?(k.p(_,m),m&1&&y(k,1)):(k=Xe(_),k.c(),y(k,1),k.m(e,null)):k&&(te(),E(k,1,1,()=>{k=null}),se()),(!a||m&2&&i!==(i="post_"+_[1].id))&&b(e,"id",i),(!a||m&1)&&Ee(e,"open",_[0])},i(_){a||(y(t),y(o.$$.fragment,_),y(k),a=!0)},o(_){E(t),E(o.$$.fragment,_),E(k),a=!1},d(_){_&&h(e),g[s].d(),B(o),k&&k.d(),f=!1,c()}}}const xe=n=>n.name==="loop";function fs(n,e,s){const t=ge(),r=()=>s(0,l=!l);let{post:o}=e,{open:l=!1}=e;const i=()=>t("fullscreen"),a=f=>{f.key==="f"&&t("fullscreen")};return n.$$set=f=>{"post"in f&&s(1,o=f.post),"open"in f&&s(0,l=f.open)},[l,o,t,r,i,a]}class ps extends ie{constructor(e){super(),ae(this,e,fs,us,oe,{post:1,open:0})}}function et(n){let e,s=n[0].type==="video"?"▶":"GIF",t;return{c(){e=I("span"),t=x(s),this.h()},l(r){e=D(r,"SPAN",{class:!0});var o=R(e);t=ee(o,s),o.forEach(h),this.h()},h(){b(e,"class","type svelte-14imjnt")},m(r,o){P(r,e,o),w(e,t)},p(r,o){o&1&&s!==(s=r[0].type==="video"?"▶":"GIF")&&Oe(t,s)},d(r){r&&h(e)}}}function ds(n){let e,s,t,r,o,l=Ve(n[0].score)+"",i,a,f,c,d,g=n[0].type!=="image"&&et(n);return{c(){e=I("div"),s=I("img"),r=T(),o=I("span"),i=x(l),a=T(),g&&g.c(),this.h()},l(v){e=D(v,"DIV",{id:!0,class:!0,style:!0});var $=R(e);s=D($,"IMG",{src:!0,alt:!0,class:!0,tabindex:!0,loading:!0}),r=O($),o=D($,"SPAN",{class:!0});var k=R(o);i=ee(k,l),k.forEach(h),a=O($),g&&g.l($),$.forEach(h),this.h()},h(){pe(s.src,t=n[1])||b(s,"src",t),b(s,"alt","post"),b(s,"class","post-media svelte-14imjnt"),b(s,"tabindex","-1"),b(s,"loading","lazy"),b(o,"class","score svelte-14imjnt"),b(e,"id",f="post_"+n[0].id),b(e,"class","post svelte-14imjnt"),ze(e,"grid-row","span "+n[2]),Ee(e,"open",open)},m(v,$){P(v,e,$),w(e,s),w(e,r),w(e,o),w(o,i),w(e,a),g&&g.m(e,null),c||(d=[le(e,"click",n[3]),le(e,"keydown",n[4])],c=!0)},p(v,[$]){$&2&&!pe(s.src,t=v[1])&&b(s,"src",t),$&1&&l!==(l=Ve(v[0].score)+"")&&Oe(i,l),v[0].type!=="image"?g?g.p(v,$):(g=et(v),g.c(),g.m(e,null)):g&&(g.d(1),g=null),$&1&&f!==(f="post_"+v[0].id)&&b(e,"id",f),$&0&&Ee(e,"open",open)},i:W,o:W,d(v){v&&h(e),g&&g.d(),c=!1,Ae(d)}}}function gs(n,e,s){let t,{post:r}=e,o=Math.min(Math.round(r.height/r.width*5),15);const l=f=>f.endsWith(".jpg")||f.endsWith(".jpeg")||f.endsWith(".png")||f.endsWith(".webp");function i(f){qe.call(this,n,f)}const a=f=>{var c;(dt(f)||f.key==="f")&&((c=f.target)==null||c.click())};return n.$$set=f=>{"post"in f&&s(0,r=f.post)},n.$$.update=()=>{n.$$.dirty&1&&s(1,t=l(r.sample_url)?r.sample_url:r.preview_url)},[r,t,o,i,a]}class _s extends ie{constructor(e){super(),ae(this,e,gs,ds,oe,{post:0})}}function ms(n){let e,s,t,r;const o=n[3].default,l=kt(o,n,n[2],null);return{c(){e=I("div"),l&&l.c(),this.h()},l(i){e=D(i,"DIV",{role:!0,tabindex:!0,class:!0});var a=R(e);l&&l.l(a),a.forEach(h),this.h()},h(){b(e,"role","none"),b(e,"tabindex","-1"),b(e,"class","dialog fullscreen svelte-1j44awz")},m(i,a){P(i,e,a),l&&l.m(e,null),n[5](e),s=!0,t||(r=[le(e,"keydown",n[4]),le(e,"click",wt(hs))],t=!0)},p(i,[a]){l&&l.p&&(!s||a&4)&&yt(l,o,i,i[2],s?Et(o,i[2],a,null):St(i[2]),null)},i(i){s||(y(l,i),s=!0)},o(i){E(l,i),s=!1},d(i){i&&h(e),l&&l.d(i),n[5](null),t=!1,Ae(r)}}}const hs=()=>{};function $s(n,e,s){let{$$slots:t={},$$scope:r}=e;const o=ge(),l=()=>o("close"),i=g=>{g.key==="Escape"&&l()};let a=()=>{document.fullscreenElement||l()},f;Be(async()=>{f.focus(),document.addEventListener("keydown",i),document.addEventListener("fullscreenchange",a);try{await f.requestFullscreen()}catch{}}),Me(async()=>{document.removeEventListener("keydown",i),document.removeEventListener("fullscreenchange",a);try{await document.exitFullscreen()}catch{}});const c=g=>{g.code==="Escape"&&l()};function d(g){ke[g?"unshift":"push"](()=>{f=g,s(0,f)})}return n.$$set=g=>{"$$scope"in g&&s(2,r=g.$$scope)},[f,l,r,t,c,d]}class vs extends ie{constructor(e){super(),ae(this,e,$s,ms,oe,{})}}function bs(n){let e,s;return e=new _t({props:{post:n[0]}}),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&1&&(o.post=t[0]),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function ks(n){let e,s;return{c(){e=I("video"),this.h()},l(t){e=D(t,"VIDEO",{class:!0,src:!0}),R(e).forEach(h),this.h()},h(){b(e,"class","post-media svelte-12glt11"),pe(e.src,s=n[0].file_url)||b(e,"src",s),e.controls=!0},m(t,r){P(t,e,r),n[5](e)},p(t,r){r&1&&!pe(e.src,s=t[0].file_url)&&b(e,"src",s)},i:W,o:W,d(t){t&&h(e),n[5](null)}}}function ws(n){let e,s,t,r,o;return{c(){e=I("img"),this.h()},l(l){e=D(l,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){b(e,"class","post-media svelte-12glt11"),pe(e.src,s=n[0].file_url)||b(e,"src",s),b(e,"alt",t="Image of Post "+n[0].id),Ee(e,"zoomed",n[1])},m(l,i){P(l,e,i),r||(o=le(e,"click",n[4]),r=!0)},p(l,i){i&1&&!pe(e.src,s=l[0].file_url)&&b(e,"src",s),i&1&&t!==(t="Image of Post "+l[0].id)&&b(e,"alt",t),i&2&&Ee(e,"zoomed",l[1])},i:W,o:W,d(l){l&&h(e),r=!1,o()}}}function ys(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),R(e).forEach(h),this.h()},h(){b(e,"class","codicon codicon-close")},m(s,t){P(s,e,t)},p:W,d(s){s&&h(e)}}}function Ss(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),R(e).forEach(h),this.h()},h(){b(e,"class","codicon codicon-chevron-left")},m(s,t){P(s,e,t)},p:W,d(s){s&&h(e)}}}function Es(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),R(e).forEach(h),this.h()},h(){b(e,"class","codicon codicon-chevron-right")},m(s,t){P(s,e,t)},p:W,d(s){s&&h(e)}}}function Cs(n){let e,s,t,r,o,l,i,a,f,c,d,g,v,$;const k=[ws,ks,bs],_=[];function m(u,p){return u[0].type==="image"?0:u[0].type==="video"?1:2}return s=m(n),t=_[s]=k[s](n),i=new gt({props:{post:n[0]}}),f=new Fe({props:{class:"button-close",$$slots:{default:[ys]},$$scope:{ctx:n}}}),f.$on("click",n[6]),d=new Fe({props:{class:"button-previous",$$slots:{default:[Ss]},$$scope:{ctx:n}}}),d.$on("click",n[7]),v=new Fe({props:{class:"button-next",$$slots:{default:[Es]},$$scope:{ctx:n}}}),v.$on("click",n[8]),{c(){e=I("div"),t.c(),r=T(),o=I("i"),l=T(),L(i.$$.fragment),a=T(),L(f.$$.fragment),c=T(),L(d.$$.fragment),g=T(),L(v.$$.fragment),this.h()},l(u){e=D(u,"DIV",{class:!0});var p=R(e);t.l(p),r=O(p),o=D(p,"I",{class:!0}),R(o).forEach(h),p.forEach(h),l=O(u),F(i.$$.fragment,u),a=O(u),F(f.$$.fragment,u),c=O(u),F(d.$$.fragment,u),g=O(u),F(v.$$.fragment,u),this.h()},h(){b(o,"class","codicon codicon-chevron-down svelte-12glt11"),b(e,"class","svelte-12glt11")},m(u,p){P(u,e,p),_[s].m(e,null),w(e,r),w(e,o),P(u,l,p),A(i,u,p),P(u,a,p),A(f,u,p),P(u,c,p),A(d,u,p),P(u,g,p),A(v,u,p),$=!0},p(u,p){let C=s;s=m(u),s===C?_[s].p(u,p):(te(),E(_[C],1,1,()=>{_[C]=null}),se(),t=_[s],t?t.p(u,p):(t=_[s]=k[s](u),t.c()),y(t,1),t.m(e,r));const H={};p&1&&(H.post=u[0]),i.$set(H);const Q={};p&2048&&(Q.$$scope={dirty:p,ctx:u}),f.$set(Q);const Y={};p&2048&&(Y.$$scope={dirty:p,ctx:u}),d.$set(Y);const K={};p&2048&&(K.$$scope={dirty:p,ctx:u}),v.$set(K)},i(u){$||(y(t),y(i.$$.fragment,u),y(f.$$.fragment,u),y(d.$$.fragment,u),y(v.$$.fragment,u),$=!0)},o(u){E(t),E(i.$$.fragment,u),E(f.$$.fragment,u),E(d.$$.fragment,u),E(v.$$.fragment,u),$=!1},d(u){u&&(h(e),h(l),h(a),h(c),h(g)),_[s].d(),B(i,u),B(f,u),B(d,u),B(v,u)}}}function Is(n){let e,s;return e=new vs({props:{$$slots:{default:[Cs]},$$scope:{ctx:n}}}),e.$on("close",n[9]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,[r]){const o={};r&2055&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function Ds(n,e,s){const t=ge(),r=$=>{if($.key==="f"&&($.preventDefault(),$.stopPropagation(),t("close")),$.key==="ArrowLeft"&&($.preventDefault(),$.stopPropagation(),t("previous")),$.key==="ArrowRight"&&($.preventDefault(),$.stopPropagation(),t("next")),$.key===" "||$.key==="k"){$.preventDefault(),$.stopPropagation(),i&&(i.paused?i.play():i.pause());const k=document.querySelector(".fullscreen.circle");k&&k.click()}i&&($.key==="j"?s(2,i.currentTime=Math.max(0,i.currentTime-5),i):$.key==="l"&&s(2,i.currentTime=Math.min(i.duration,i.currentTime+5),i))};let{post:o}=e,l=o.width/o.height<.33,i;Be(()=>{document.addEventListener("keydown",r)}),Me(()=>document.removeEventListener("keydown",r));const a=()=>s(1,l=!l);function f($){ke[$?"unshift":"push"](()=>{i=$,s(2,i)})}const c=()=>t("close"),d=()=>t("previous"),g=()=>t("next");function v($){qe.call(this,n,$)}return n.$$set=$=>{"post"in $&&s(0,o=$.post)},[o,l,i,t,a,f,c,d,g,v]}class Ns extends ie{constructor(e){super(),ae(this,e,Ds,Is,oe,{post:0})}}function tt(n,e,s){const t=n.slice();return t[12]=e[s],t[14]=s,t}function st(n,e,s){const t=n.slice();return t[12]=e[s],t[14]=s,t}function Ps(n){let e,s,t=Ce(n[2].posts),r=[];for(let l=0;l<t.length;l+=1)r[l]=nt(tt(n,t,l));const o=l=>E(r[l],1,1,()=>{r[l]=null});return{c(){e=I("section");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){e=D(l,"SECTION",{class:!0,style:!0});var i=R(e);for(let a=0;a<r.length;a+=1)r[a].l(i);i.forEach(h),this.h()},h(){b(e,"class","multi svelte-q6spg0"),ze(e,"grid-template-columns","repeat("+n[3]+", 1fr)")},m(l,i){P(l,e,i);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);s=!0},p(l,i){if(i&5){t=Ce(l[2].posts);let a;for(a=0;a<t.length;a+=1){const f=tt(l,t,a);r[a]?(r[a].p(f,i),y(r[a],1)):(r[a]=nt(f),r[a].c(),y(r[a],1),r[a].m(e,null))}for(te(),a=t.length;a<r.length;a+=1)o(a);se()}(!s||i&8)&&ze(e,"grid-template-columns","repeat("+l[3]+", 1fr)")},i(l){if(!s){for(let i=0;i<t.length;i+=1)y(r[i]);s=!0}},o(l){r=r.filter(Boolean);for(let i=0;i<r.length;i+=1)E(r[i]);s=!1},d(l){l&&h(e),Ge(r,l)}}}function Ts(n){let e,s,t=Ce(n[2].posts),r=[];for(let l=0;l<t.length;l+=1)r[l]=rt(st(n,t,l));const o=l=>E(r[l],1,1,()=>{r[l]=null});return{c(){e=I("section");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){e=D(l,"SECTION",{class:!0});var i=R(e);for(let a=0;a<r.length;a+=1)r[a].l(i);i.forEach(h),this.h()},h(){b(e,"class","single svelte-q6spg0")},m(l,i){P(l,e,i);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);s=!0},p(l,i){if(i&5){t=Ce(l[2].posts);let a;for(a=0;a<t.length;a+=1){const f=st(l,t,a);r[a]?(r[a].p(f,i),y(r[a],1)):(r[a]=rt(f),r[a].c(),y(r[a],1),r[a].m(e,null))}for(te(),a=t.length;a<r.length;a+=1)o(a);se()}},i(l){if(!s){for(let i=0;i<t.length;i+=1)y(r[i]);s=!0}},o(l){r=r.filter(Boolean);for(let i=0;i<r.length;i+=1)E(r[i]);s=!1},d(l){l&&h(e),Ge(r,l)}}}function nt(n){let e,s;function t(){return n[7](n[12],n[14])}return e=new _s({props:{post:n[12]}}),e.$on("click",t),{c(){L(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){A(e,r,o),s=!0},p(r,o){n=r;const l={};o&4&&(l.post=n[12]),e.$set(l)},i(r){s||(y(e.$$.fragment,r),s=!0)},o(r){E(e.$$.fragment,r),s=!1},d(r){B(e,r)}}}function rt(n){let e,s;function t(){return n[6](n[12],n[14])}return e=new ps({props:{post:n[12]}}),e.$on("fullscreen",t),{c(){L(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){A(e,r,o),s=!0},p(r,o){n=r;const l={};o&4&&(l.post=n[12]),e.$set(l)},i(r){s||(y(e.$$.fragment,r),s=!0)},o(r){E(e.$$.fragment,r),s=!1},d(r){B(e,r)}}}function lt(n){let e,s;return e=new Ns({props:{post:n[0].post}}),e.$on("close",n[8]),e.$on("previous",n[9]),e.$on("next",n[10]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&1&&(o.post=t[0].post),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function Os(n){let e,s,t=Ve(n[2].postCount)+"",r,o,l,i,a,f,c,d,g,v;i=new rs({}),i.$on("sortfilterupdate",n[5]);const $=[Ts,Ps],k=[];function _(u,p){return u[3]==="1"?0:1}f=_(n),c=k[f]=$[f](n);let m=n[1]&&n[0]!==void 0&&lt(n);return{c(){e=I("div"),s=I("span"),r=x(t),o=x(" posts"),l=T(),L(i.$$.fragment),a=T(),c.c(),d=T(),m&&m.c(),g=de(),this.h()},l(u){e=D(u,"DIV",{class:!0});var p=R(e);s=D(p,"SPAN",{});var C=R(s);r=ee(C,t),o=ee(C," posts"),C.forEach(h),l=O(p),F(i.$$.fragment,p),p.forEach(h),a=O(u),c.l(u),d=O(u),m&&m.l(u),g=de(),this.h()},h(){b(e,"class","svelte-q6spg0")},m(u,p){P(u,e,p),w(e,s),w(s,r),w(s,o),w(e,l),A(i,e,null),P(u,a,p),k[f].m(u,p),P(u,d,p),m&&m.m(u,p),P(u,g,p),v=!0},p(u,[p]){(!v||p&4)&&t!==(t=Ve(u[2].postCount)+"")&&Oe(r,t);let C=f;f=_(u),f===C?k[f].p(u,p):(te(),E(k[C],1,1,()=>{k[C]=null}),se(),c=k[f],c?c.p(u,p):(c=k[f]=$[f](u),c.c()),y(c,1),c.m(d.parentNode,d)),u[1]&&u[0]!==void 0?m?(m.p(u,p),p&3&&y(m,1)):(m=lt(u),m.c(),y(m,1),m.m(g.parentNode,g)):m&&(te(),E(m,1,1,()=>{m=null}),se())},i(u){v||(y(i.$$.fragment,u),y(c),y(m),v=!0)},o(u){E(i.$$.fragment,u),E(c),E(m),v=!1},d(u){u&&(h(e),h(a),h(d),h(g)),B(i),k[f].d(u),m&&m.d(u)}}}function Rs(n,e,s){let t,r;ce(n,Te,k=>s(2,t=k)),ce(n,Rt,k=>s(3,r=k));const o=ge(),l=()=>{s(1,a=location.hash.length>2)};let i,a=location.hash.length>2;Be(()=>{window.addEventListener("hashchange",l)}),Me(()=>{window.removeEventListener("hashchange",l)});function f(k){qe.call(this,n,k)}return[i,a,t,r,o,f,(k,_)=>{s(0,i={post:k,index:_}),location.hash="fullscreen"},(k,_)=>{s(0,i={post:k,index:_}),location.hash="fullscreen"},()=>{var k,_;(k=i==null?void 0:i.post)!=null&&k.id&&((_=document.querySelector(`#post_${i.post.id} .post-media`))==null||_.focus()),s(0,i=void 0),history.back()},()=>{let k=Math.max(i.index-1,0);s(0,i={index:k,post:t.posts[k]})},()=>{let k=Math.min(i.index+1,t.posts.length);s(0,i={index:k,post:t.posts[k]}),k>t.posts.length-3&&t.posts.length!==t.postCount&&o("endreached")}]}class Vs extends ie{constructor(e){super(),ae(this,e,Rs,Os,oe,{})}}function js(n){let e;return{c(){e=I("div")},l(s){e=D(s,"DIV",{}),R(e).forEach(h)},m(s,t){P(s,e,t),n[2](e)},p:W,i:W,o:W,d(s){s&&h(e),n[2](null)}}}function Ls(n,e,s){let{rootMargin:t}=e;const r=ge(),o=new IntersectionObserver(a=>{a[0].isIntersecting&&r("intersection")},{rootMargin:t});let l;function i(a){ke[a?"unshift":"push"](()=>{l=a,s(0,l)})}return n.$$set=a=>{"rootMargin"in a&&s(1,t=a.rootMargin)},n.$$.update=()=>{n.$$.dirty&1&&(o.disconnect(),l&&o.observe(l))},[l,t,i]}class Fs extends ie{constructor(e){super(),ae(this,e,Ls,js,oe,{rootMargin:1})}}function As(n){let e,s,t,r,o="You have seen everything there is to see...";return{c(){e=I("img"),t=T(),r=I("p"),r.textContent=o,this.h()},l(l){e=D(l,"IMG",{src:!0,alt:!0,class:!0}),t=O(l),r=D(l,"P",{"data-svelte-h":!0}),ue(r)!=="svelte-1i75mtf"&&(r.textContent=o),this.h()},h(){pe(e.src,s=ft+"/assets/shironeko-x.png")||b(e,"src",s),b(e,"alt","No more results to load"),b(e,"class","svelte-1pkma0d")},m(l,i){P(l,e,i),P(l,t,i),P(l,r,i)},p:W,i:W,o:W,d(l){l&&(h(e),h(t),h(r))}}}class Bs extends ie{constructor(e){super(),ae(this,e,null,As,oe,{})}}function ot(n,e,s){const t=n.slice();return t[9]=e[s],t}function it(n){let e,s;return e=new Mt({props:{tag:n[9]}}),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&4&&(o.tag=t[9]),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function Ms(n){let e;return{c(){e=x("Create supertag")},l(s){e=ee(s,"Create supertag")},m(s,t){P(s,e,t)},d(s){s&&h(e)}}}function Us(n){let e,s,t="Create Supertag",r,o,l,i,a,f="Name",c,d,g,v,$,k="Description",_,m,u,p,C,H="Tags",Q,Y,K,ne,Z,X,S,G,z=Ce(n[2]),N=[];for(let j=0;j<z.length;j+=1)N[j]=it(ot(n,z,j));const we=j=>E(N[j],1,1,()=>{N[j]=null});return Z=new Re({props:{title:n[3]?"Click to create supertag":"Enter a valid name to continue",disabled:!n[3],$$slots:{default:[Ms]},$$scope:{ctx:n}}}),Z.$on("click",n[8]),{c(){e=I("section"),s=I("h3"),s.textContent=t,r=T(),o=I("button"),l=T(),i=I("div"),a=I("label"),a.textContent=f,c=T(),d=I("input"),g=T(),v=I("div"),$=I("label"),$.textContent=k,_=T(),m=I("input"),u=T(),p=I("div"),C=I("span"),C.textContent=H,Q=T(),Y=I("ol");for(let j=0;j<N.length;j+=1)N[j].c();K=T(),ne=I("div"),L(Z.$$.fragment),this.h()},l(j){e=D(j,"SECTION",{class:!0});var V=R(e);s=D(V,"H3",{"data-svelte-h":!0}),ue(s)!=="svelte-ho1cwx"&&(s.textContent=t),r=O(V),o=D(V,"BUTTON",{class:!0}),R(o).forEach(h),l=O(V),i=D(V,"DIV",{class:!0});var J=R(i);a=D(J,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ue(a)!=="svelte-10k8a68"&&(a.textContent=f),c=O(J),d=D(J,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),J.forEach(h),g=O(V),v=D(V,"DIV",{class:!0});var U=R(v);$=D(U,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ue($)!=="svelte-14n9kp6"&&($.textContent=k),_=O(U),m=D(U,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),U.forEach(h),u=O(V),p=D(V,"DIV",{class:!0});var re=R(p);C=D(re,"SPAN",{class:!0,"data-svelte-h":!0}),ue(C)!=="svelte-7hjyox"&&(C.textContent=H),Q=O(re),Y=D(re,"OL",{class:!0});var ye=R(Y);for(let De=0;De<N.length;De+=1)N[De].l(ye);ye.forEach(h),re.forEach(h),K=O(V),ne=D(V,"DIV",{class:!0});var Ie=R(ne);F(Z.$$.fragment,Ie),Ie.forEach(h),V.forEach(h),this.h()},h(){b(o,"class",ut("codicon codicon-close")+" svelte-xkjm86"),b(a,"for","supertag-name"),b(a,"class","svelte-xkjm86"),b(d,"type","text"),b(d,"placeholder","Descriptive name"),b(d,"id","supertag-name"),b(d,"class","svelte-xkjm86"),b(i,"class","svelte-xkjm86"),b($,"for","supertag-description"),b($,"class","svelte-xkjm86"),b(m,"type","text"),b(m,"placeholder","Short description"),b(m,"id","supertag-description"),b(m,"class","svelte-xkjm86"),b(v,"class","svelte-xkjm86"),b(C,"class","svelte-xkjm86"),b(Y,"class","svelte-xkjm86"),b(p,"class","svelte-xkjm86"),b(ne,"class","last svelte-xkjm86"),b(e,"class","svelte-xkjm86")},m(j,V){P(j,e,V),w(e,s),w(e,r),w(e,o),w(e,l),w(e,i),w(i,a),w(i,c),w(i,d),Se(d,n[0]),w(e,g),w(e,v),w(v,$),w(v,_),w(v,m),Se(m,n[1]),w(e,u),w(e,p),w(p,C),w(p,Q),w(p,Y);for(let J=0;J<N.length;J+=1)N[J]&&N[J].m(Y,null);w(e,K),w(e,ne),A(Z,ne,null),X=!0,S||(G=[le(o,"click",n[5]),le(d,"input",n[6]),le(m,"input",n[7])],S=!0)},p(j,V){if(V&1&&d.value!==j[0]&&Se(d,j[0]),V&2&&m.value!==j[1]&&Se(m,j[1]),V&4){z=Ce(j[2]);let U;for(U=0;U<z.length;U+=1){const re=ot(j,z,U);N[U]?(N[U].p(re,V),y(N[U],1)):(N[U]=it(re),N[U].c(),y(N[U],1),N[U].m(Y,null))}for(te(),U=z.length;U<N.length;U+=1)we(U);se()}const J={};V&8&&(J.title=j[3]?"Click to create supertag":"Enter a valid name to continue"),V&8&&(J.disabled=!j[3]),V&4096&&(J.$$scope={dirty:V,ctx:j}),Z.$set(J)},i(j){if(!X){for(let V=0;V<z.length;V+=1)y(N[V]);y(Z.$$.fragment,j),X=!0}},o(j){N=N.filter(Boolean);for(let V=0;V<N.length;V+=1)E(N[V]);E(Z.$$.fragment,j),X=!1},d(j){j&&h(e),Ge(N,j),B(Z),S=!1,Ae(G)}}}function zs(n){let e,s;return e=new pt({props:{$$slots:{default:[Us]},$$scope:{ctx:n}}}),e.$on("close",n[5]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,[r]){const o={};r&4111&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function qs(n,e,s){let t,{name:r=""}=e,{description:o=""}=e,{tags:l}=e;const i=ge(),a=()=>i("close");function f(){r=this.value,s(0,r)}function c(){o=this.value,s(1,o)}const d=()=>{i("submit",{name:r,description:o,tags:l.map(({modifier:g,name:v})=>({modifier:g,name:v}))}),a()};return n.$$set=g=>{"name"in g&&s(0,r=g.name),"description"in g&&s(1,o=g.description),"tags"in g&&s(2,l=g.tags)},n.$$.update=()=>{n.$$.dirty&5&&s(3,t=typeof r=="string"&&r!==""&&l.length>1)},[r,o,l,t,i,a,f,c,d]}class Gs extends ie{constructor(e){super(),ae(this,e,qs,zs,oe,{name:0,description:1,tags:2})}}function Ks(n){let e,s,t,r,o,l,i,a,f,c;return{c(){e=I("div"),s=I("div"),t=I("i"),r=T(),o=I("div"),l=I("h3"),i=x(n[0]),a=T(),f=I("span"),c=x(n[2]),this.h()},l(d){e=D(d,"DIV",{class:!0});var g=R(e);s=D(g,"DIV",{class:!0});var v=R(s);t=D(v,"I",{class:!0}),R(t).forEach(h),v.forEach(h),r=O(g),o=D(g,"DIV",{});var $=R(o);l=D($,"H3",{class:!0});var k=R(l);i=ee(k,n[0]),k.forEach(h),a=O($),f=D($,"SPAN",{});var _=R(f);c=ee(_,n[2]),_.forEach(h),$.forEach(h),g.forEach(h),this.h()},h(){b(t,"class",ut(n[1])+" svelte-1tvgln1"),b(s,"class","icon svelte-1tvgln1"),b(l,"class","svelte-1tvgln1"),b(e,"class","error svelte-1tvgln1")},m(d,g){P(d,e,g),w(e,s),w(s,t),w(e,r),w(e,o),w(o,l),w(l,i),w(o,a),w(o,f),w(f,c)},p:W,i:W,o:W,d(d){d&&h(e)}}}function Ws(n,e,s){let{error:t}=e,r=t.message==="Failed to fetch"?"Connection Error":"Application Error",o=t.message==="Failed to fetch"?"codicon codicon-debug-disconnect":"codicon codicon-error",l=t.message==="Failed to fetch"?"Failed to connect to the server. Make sure you have a stable internet connection.":t.message;return n.$$set=i=>{"error"in i&&s(3,t=i.error)},[r,o,l,t]}class Hs extends ie{constructor(e){super(),ae(this,e,Ws,Ks,oe,{error:3})}}const Ys=n=>({tags:xs(n),sort:en(n),filter:tn(n)}),Zs=n=>{const e=new URLSearchParams,{tags:s,sort:t,filter:r}=n;return s&&s.length>0&&e.append("tags",Js(s)),t&&(t.property!=="id"||(t==null?void 0:t.direction)!=="desc")&&e.append("sort",Qs(t)),r&&(r.rating!=="all"||r.scoreComparator!==">="||r.scoreValue!==0)&&e.append("filter",Xs(r)),e},Js=n=>n.join(";"),Qs=n=>n.property+":"+n.direction,Xs=n=>{const e=[];if(n.rating!=="all"){const s="rating:"+n.rating;e.push(s)}if(n.scoreComparator!==">="||n.scoreValue!==0){const s="score"+n.scoreComparator+n.scoreValue;e.push(s)}return e.join(";")},xs=n=>{if(!n.has("tags"))return[];const s=(n.get("tags")??"").split(";");return!Array.isArray(s)||s.length===0?[]:s},en=n=>{try{if(!n.has("sort"))return;const e=n.get("sort")??"",[s,t]=e.split(":");return{property:s,direction:t}}catch{console.warn("Invalid sort provided in url");return}},tn=n=>{try{if(!n.has("filter"))return;const s=(n.get("filter")??"").split(";");let t={};return s.forEach(r=>{if(r.startsWith("rating:")){const[,o]=r.split(":");o!=="all"&&(t.rating=o)}if(r.startsWith("score")){const o=r.match(/score(..)(\d+)/);if(o){const[,l,i]=o;t.scoreComparator=l;const a=Number(i);a&&(t.scoreValue=a)}}}),t}catch{console.warn("Invalid sort provided in url");return}};function sn(n){let e;return{c(){e=x("Search")},l(s){e=ee(s,"Search")},m(s,t){P(s,e,t)},d(s){s&&h(e)}}}function nn(n){let e,s,t,r,o,l;const i=[on,ln],a=[];function f(c,d){return c[3].postCount===0?0:1}return s=f(n),t=a[s]=i[s](n),o=new Ut({}),{c(){e=I("section"),t.c(),r=T(),L(o.$$.fragment),this.h()},l(c){e=D(c,"SECTION",{class:!0});var d=R(e);t.l(d),d.forEach(h),r=O(c),F(o.$$.fragment,c),this.h()},h(){b(e,"class","svelte-rk0y4a")},m(c,d){P(c,e,d),a[s].m(e,null),P(c,r,d),A(o,c,d),l=!0},p(c,d){let g=s;s=f(c),s===g?a[s].p(c,d):(te(),E(a[g],1,1,()=>{a[g]=null}),se(),t=a[s],t?t.p(c,d):(t=a[s]=i[s](c),t.c()),y(t,1),t.m(e,null))},i(c){l||(y(t),y(o.$$.fragment,c),l=!0)},o(c){E(t),E(o.$$.fragment,c),l=!1},d(c){c&&(h(e),h(r)),a[s].d(),B(o,c)}}}function rn(n){let e,s;return e=new Hs({props:{error:n[1]}}),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.error=t[1]),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function ln(n){let e,s,t,r,o,l;e=new Vs({}),e.$on("sortfilterupdate",n[7]),e.$on("endreached",n[8]);const i=[cn,an],a=[];function f(c,d){return c[3].posts.length===c[3].postCount?0:1}return t=f(n),r=a[t]=i[t](n),{c(){L(e.$$.fragment),s=T(),r.c(),o=de()},l(c){F(e.$$.fragment,c),s=O(c),r.l(c),o=de()},m(c,d){A(e,c,d),P(c,s,d),a[t].m(c,d),P(c,o,d),l=!0},p(c,d){let g=t;t=f(c),t===g?a[t].p(c,d):(te(),E(a[g],1,1,()=>{a[g]=null}),se(),r=a[t],r?r.p(c,d):(r=a[t]=i[t](c),r.c()),y(r,1),r.m(o.parentNode,o))},i(c){l||(y(e.$$.fragment,c),y(r),l=!0)},o(c){E(e.$$.fragment,c),E(r),l=!1},d(c){c&&(h(s),h(o)),B(e,c),a[t].d(c)}}}function on(n){let e,s;return e=new Ht({}),e.$on("sortfilterupdate",n[7]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p:W,i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function an(n){let e,s;return e=new Fs({props:{rootMargin:"1000px"}}),e.$on("intersection",n[8]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p:W,i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function cn(n){let e,s;return e=new Bs({}),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p:W,i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function at(n){let e,s;return e=new Gs({props:{tags:n[0]}}),e.$on("close",n[16]),e.$on("submit",n[17]),{c(){L(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,r){A(e,t,r),s=!0},p(t,r){const o={};r&1&&(o.tags=t[0]),e.$set(o)},i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){B(e,t)}}}function un(n){let e,s,t,r,o,l,i,a,f,c,d,g,v,$;s=new Ct({}),r=new Nt({props:{placeholder:"Search for tags",fetchSuggestions:n[6]}}),r.$on("pick",n[12]),l=new Re({props:{title:"Search with the tags above",$$slots:{default:[sn]},$$scope:{ctx:n}}}),l.$on("click",n[7]),a=new It({props:{tags:[...n[0],...n[4]]}}),a.$on("click",n[13]),a.$on("contextmenu",n[14]),a.$on("createSupertag",n[15]);const k=[rn,nn],_=[];function m(p,C){return p[1]?0:p[3].requested?1:-1}~(c=m(n))&&(d=_[c]=k[c](n));let u=n[2]&&at(n);return{c(){e=I("section"),L(s.$$.fragment),t=T(),L(r.$$.fragment),o=T(),L(l.$$.fragment),i=T(),L(a.$$.fragment),f=T(),d&&d.c(),g=T(),u&&u.c(),v=de(),this.h()},l(p){e=D(p,"SECTION",{id:!0,class:!0});var C=R(e);F(s.$$.fragment,C),t=O(C),F(r.$$.fragment,C),o=O(C),F(l.$$.fragment,C),i=O(C),F(a.$$.fragment,C),C.forEach(h),f=O(p),d&&d.l(p),g=O(p),u&&u.l(p),v=de(),this.h()},h(){b(e,"id","search"),b(e,"class","svelte-rk0y4a")},m(p,C){P(p,e,C),A(s,e,null),w(e,t),A(r,e,null),w(e,o),A(l,e,null),w(e,i),A(a,e,null),P(p,f,C),~c&&_[c].m(p,C),P(p,g,C),u&&u.m(p,C),P(p,v,C),$=!0},p(p,[C]){const H={};C&33554432&&(H.$$scope={dirty:C,ctx:p}),l.$set(H);const Q={};C&17&&(Q.tags=[...p[0],...p[4]]),a.$set(Q);let Y=c;c=m(p),c===Y?~c&&_[c].p(p,C):(d&&(te(),E(_[Y],1,1,()=>{_[Y]=null}),se()),~c?(d=_[c],d?d.p(p,C):(d=_[c]=k[c](p),d.c()),y(d,1),d.m(g.parentNode,g)):d=null),p[2]?u?(u.p(p,C),C&4&&y(u,1)):(u=at(p),u.c(),y(u,1),u.m(v.parentNode,v)):u&&(te(),E(u,1,1,()=>{u=null}),se())},i(p){$||(y(s.$$.fragment,p),y(r.$$.fragment,p),y(l.$$.fragment,p),y(a.$$.fragment,p),y(d),y(u),$=!0)},o(p){E(s.$$.fragment,p),E(r.$$.fragment,p),E(l.$$.fragment,p),E(a.$$.fragment,p),E(d),E(u),$=!1},d(p){p&&(h(e),h(f),h(g),h(v)),B(s),B(r),B(l),B(a),~c&&_[c].d(p),u&&u.d(p)}}}const fn=async(n,e,s)=>{let t=!1;const{tags:r,sort:o,filter:l}=Ys(new URL(location.href).searchParams);return r&&r.length>0&&(n.reset(),await Promise.all(r.map(async i=>await n.addByName(i))),t=!0),o&&(e.update(o),t=!0),l&&(s.update(l),t=!0),t};function pn(n,e,s){let t,r,o,l,i,a,f,c;ce(n,be,S=>s(10,r=S)),ce(n,fe,S=>s(11,o=S)),ce(n,Pe,S=>s(0,l=S)),ce(n,Te,S=>s(3,i=S)),ce(n,Ue,S=>s(4,a=S)),ce(n,Bt,S=>s(20,f=S)),ce(n,Ze,S=>s(5,c=S));let d=!1,g,v=!1,$=0;const k=(S,G,z)=>{const N=new URL(location.protocol+"//"+location.host+location.pathname);return Zs({tags:S.map(j=>j.name),sort:G,filter:z}).forEach((j,V)=>{N.searchParams.set(V,j)}),N},_=async S=>{const G=await Tt(S);return[...c.items.filter(({name:N})=>N.toLowerCase().includes(S.toLowerCase())).map(N=>({label:N.name,count:N.tags.length,type:"supertag"})),...G]},m=()=>new Dt().withPid(i.pageCount).withTags(l).withBlockedContent(f).withSortProperty(o.property).withSortDirection(o.direction).withScoreValue(r.scoreValue).withScoreComparator(r.scoreComparator).withRating(r.rating).withSupertags(a),u=async S=>{if(!d){s(1,g=void 0),d=!0;try{const G=i.pageCount;await S(),zt(G).catch(()=>{})}catch(G){s(1,g=G),console.warn(G)}finally{d=!1}}},p=async()=>{console.log(l),Te.reset(),$=0,u(async()=>{const[S,G]=await m().getPageAndCount();Te.addPage(S,G)})},C=async()=>{u(async()=>{const S=await m().getPage();Te.addPage(S)})},H=S=>{var G,z;if((S.key==="/"||S.key==="s")&&(!document.activeElement||document.activeElement===document.body)&&((G=document.getElementById("searchbar"))==null||G.focus(),S.preventDefault(),S.stopPropagation()),S.ctrlKey&&S.key==="Enter"&&(S.preventDefault(),S.stopPropagation(),p()),S.ctrlKey&&S.key==="m"&&((z=document.getElementById("select-modifier"))==null||z.click()),S.ctrlKey&&S.key==="ArrowDown"){const N=document.getElementsByClassName("post-media");N[$].focus(),$=Math.min($+1,Math.max(0,N.length-1))}S.ctrlKey&&S.key==="ArrowUp"&&(document.getElementsByClassName("post-media")[$].focus(),$=Math.max($-1,0))};Be(async()=>{document.addEventListener("keydown",H),await fn(Pe,fe,be)&&p()}),Me(()=>{document.removeEventListener("keydown",H)});const Q=async S=>{const G=S.detail;if(G.type==="supertag"){const z=c.items.find(N=>N.name===G.label);if(!z){console.warn("Supertag not present.");return}Ue.addOrReplace(z)}else{const z=await Ot(S.detail.label);Pe.addOrReplace({name:S.detail.label,modifier:S.detail.modifier,count:S.detail.count,type:(z==null?void 0:z.type)??"tag"})}},Y=S=>"description"in S.detail?Ue.removeByName(S.detail.name):Pe.removeByName(S.detail.name),K=S=>{"description"in S.detail||(S.detail.modifier=Pt(S.detail.modifier),Pe.addOrReplace(S.detail))},ne=()=>s(2,v=!0),Z=()=>s(2,v=!1),X=S=>Ze.add(S.detail);return n.$$.update=()=>{n.$$.dirty&3073&&s(9,t=k(l,o,r)),n.$$.dirty&512&&qt()&&history.replaceState(null,"",t)},[l,g,v,i,a,c,_,p,C,t,r,o,Q,Y,K,ne,Z,X]}class Rn extends ie{constructor(e){super(),ae(this,e,pn,un,oe,{})}}export{Rn as component};
