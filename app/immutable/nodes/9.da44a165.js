import{s as re,a as O,f as U,U as ne,l as D,x as oe,d as b,c as B,g as V,h as j,V as le,m as L,j as A,i as x,u,n as K,P as ie,C as R}from"../chunks/scheduler.88299003.js";import{S as ce,i as ge,b as F,d as G,m as J,a as W,t as X,e as Y}from"../chunks/index.15b414ac.js";import{e as te}from"../chunks/each.e59479a4.js";import{K as ue,A as me,S as he,a as Z,f as pe,s as de,r as fe}from"../chunks/search-builder.294e378f.js";import{S as _e,n as Se,s as ve}from"../chunks/supertags-store.a1c90c25.js";import{g as we,a as ye}from"../chunks/tags.58927cde.js";import{a as I}from"../chunks/posts.e3ad19e2.js";import{b as be}from"../chunks/blocked-content-store.8cb9d99a.js";function ae(s,o,t){const r=s.slice();return r[16]=o[t],r}function se(s){let o,t=s[16][0]+"",r,w,c=s[16][1]+"",p;return{c(){o=U("p"),r=D(t),w=D("="),p=D(c),this.h()},l(n){o=V(n,"P",{class:!0});var l=j(o);r=L(l,t),w=L(l,"="),p=L(l,c),l.forEach(b),this.h()},h(){A(o,"class","fixed svelte-dhg4ur")},m(n,l){x(n,o,l),u(o,r),u(o,w),u(o,p)},p(n,l){l&16&&t!==(t=n[16][0]+"")&&K(r,t),l&16&&c!==(c=n[16][1]+"")&&K(p,c)},d(n){n&&b(o)}}}function Ce(s){let o,t,r,w,c,p,n,l,d,C,T,m,f,q,H,N,y,$=s[3][0]+"",e,E,_=s[3][1]+"",S,P;r=new ue({}),c=new _e({props:{placeholder:"Search for tags",fetchSuggestions:s[7]}}),c.$on("pick",s[12]),n=new me({props:{tags:[...s[2],...s[1]]}}),n.$on("click",s[13]),n.$on("contextmenu",s[14]);let Q=te(s[4]),g=[];for(let a=0;a<Q.length;a+=1)g[a]=se(ae(s,Q,a));return{c(){o=O(),t=U("section"),F(r.$$.fragment),w=O(),F(c.$$.fragment),p=O(),F(n.$$.fragment),l=O(),d=U("code"),C=new ne(!1),T=O(),m=U("code"),f=U("p"),q=D(s[5]),H=O();for(let a=0;a<g.length;a+=1)g[a].c();N=O(),y=U("p"),e=D($),E=D("="),S=D(_),this.h()},l(a){oe("svelte-fr2gtz",document.head).forEach(b),o=B(a),t=V(a,"SECTION",{class:!0});var i=j(t);G(r.$$.fragment,i),w=B(i),G(c.$$.fragment,i),p=B(i),G(n.$$.fragment,i),l=B(i),d=V(i,"CODE",{class:!0});var h=j(d);C=le(h,!1),h.forEach(b),T=B(i),m=V(i,"CODE",{class:!0});var k=j(m);f=V(k,"P",{class:!0});var ee=j(f);q=L(ee,s[5]),ee.forEach(b),H=B(k);for(let M=0;M<g.length;M+=1)g[M].l(k);N=B(k),y=V(k,"P",{class:!0});var z=j(y);e=L(z,$),E=L(z,"="),S=L(z,_),z.forEach(b),k.forEach(b),i.forEach(b),this.h()},h(){document.title="kurosearch - Query Builder",C.a=null,A(d,"class","svelte-dhg4ur"),A(f,"class","base svelte-dhg4ur"),A(y,"class","tags svelte-dhg4ur"),A(m,"class","svelte-dhg4ur"),A(t,"class","svelte-dhg4ur")},m(a,v){x(a,o,v),x(a,t,v),J(r,t,null),u(t,w),J(c,t,null),u(t,p),J(n,t,null),u(t,l),u(t,d),C.m(s[0],d),u(t,T),u(t,m),u(m,f),u(f,q),u(m,H);for(let i=0;i<g.length;i+=1)g[i]&&g[i].m(m,null);u(m,N),u(m,y),u(y,e),u(y,E),u(y,S),P=!0},p(a,[v]){const i={};if(v&6&&(i.tags=[...a[2],...a[1]]),n.$set(i),(!P||v&1)&&C.p(a[0]),(!P||v&32)&&K(q,a[5]),v&16){Q=te(a[4]);let h;for(h=0;h<Q.length;h+=1){const k=ae(a,Q,h);g[h]?g[h].p(k,v):(g[h]=se(k),g[h].c(),g[h].m(m,N))}for(;h<g.length;h+=1)g[h].d(1);g.length=Q.length}(!P||v&8)&&$!==($=a[3][0]+"")&&K(e,$),(!P||v&8)&&_!==(_=a[3][1]+"")&&K(S,_)},i(a){P||(W(r.$$.fragment,a),W(c.$$.fragment,a),W(n.$$.fragment,a),P=!0)},o(a){X(r.$$.fragment,a),X(c.$$.fragment,a),X(n.$$.fragment,a),P=!1},d(a){a&&(b(o),b(t)),Y(r),Y(c),Y(n),ie(g,a)}}}function ke(s,o,t){let r,w,c,p,n,l,d,C,T,m,f;R(s,Z,e=>t(1,n=e)),R(s,pe,e=>t(8,l=e)),R(s,de,e=>t(9,d=e)),R(s,be,e=>t(10,C=e)),R(s,I,e=>t(2,T=e)),R(s,fe,e=>t(11,m=e)),R(s,ve,e=>t(6,f=e));const q=async e=>{const E=await we(e);return[...f.items.filter(({name:S})=>S.toLowerCase().includes(e.toLowerCase())).map(S=>({label:S.name,count:S.tags.length,type:"supertag"})),...E]},H=e=>{try{return new URL(e)}catch{return null}},N=async e=>{const E=e.detail;if(E.type==="supertag"){const _=f.items.find(S=>S.name===E.label);if(!_){console.warn("Supertag not present.");return}Z.addOrReplace(_)}else{const _=await ye(e.detail.label);I.addOrReplace({name:e.detail.label,modifier:e.detail.modifier,count:e.detail.count,type:_.type})}},y=e=>"description"in e.detail?Z.removeByName(e.detail.name):I.removeByName(e.detail.name),$=e=>{"description"in e.detail||(e.detail.modifier=Se(e.detail.modifier),I.addOrReplace(e.detail))};return s.$$.update=()=>{s.$$.dirty&3846&&t(0,r=H(new he().withPid(m.pageCount).withTags(T).withBlockedContent(C).withSortProperty(d.property).withSortDirection(d.direction).withScoreValue(l.scoreValue).withScoreComparator(l.scoreComparator).withRating(l.rating).withSupertags(n).getQuery())),s.$$.dirty&1&&t(5,w=r&&`${r.protocol}//${r.hostname}`),s.$$.dirty&1&&t(4,c=r?[...r.searchParams.entries()].filter(([e])=>["page","s","q","fields","json","limit"].includes(e)):[]),s.$$.dirty&1&&t(3,p=r?[...r.searchParams.entries()].find(([e])=>e==="tags")??["tags",""]:["tags",""])},[r,n,T,p,c,w,f,q,l,d,C,m,N,y,$]}class Le extends ce{constructor(o){super(),ge(this,o,ke,Ce,re,{})}}export{Le as component};
