import{s as re,a as O,f as U,U as ne,l as D,x as oe,d as b,c as B,g as V,h as j,V as le,m as L,j as A,i as x,u,n as K,G as ie,C as R}from"../chunks/scheduler.0a29c992.js";import{S as ce,i as me,b as M,d as F,m as J,a as W,t as X,e as Y}from"../chunks/index.6d8df040.js";import{e as te}from"../chunks/each.e59479a4.js";import{K as ue,A as ge}from"../chunks/ActiveTagList.0ac41c7b.js";import{S as he,n as pe,s as de}from"../chunks/supertags-store.ef0243e2.js";import{g as fe,a as _e}from"../chunks/tags.49324235.js";import{S as Se,a as Z,f as ve,s as we,r as ye}from"../chunks/active-supertags-store.11df592d.js";import{a as G}from"../chunks/active-tags-store.a60398a6.js";import{b as be}from"../chunks/blocked-content-store.2a43e35e.js";function ae(s,o,t){const r=s.slice();return r[16]=o[t],r}function se(s){let o,t=s[16][0]+"",r,w,c=s[16][1]+"",d;return{c(){o=U("p"),r=D(t),w=D("="),d=D(c),this.h()},l(n){o=V(n,"P",{class:!0});var l=j(o);r=L(l,t),w=L(l,"="),d=L(l,c),l.forEach(b),this.h()},h(){A(o,"class","fixed svelte-dhg4ur")},m(n,l){x(n,o,l),u(o,r),u(o,w),u(o,d)},p(n,l){l&16&&t!==(t=n[16][0]+"")&&K(r,t),l&16&&c!==(c=n[16][1]+"")&&K(d,c)},d(n){n&&b(o)}}}function Ce(s){let o,t,r,w,c,d,n,l,f,C,P,g,_,q,H,N,y,$=s[3][0]+"",e,E,p=s[3][1]+"",S,T;r=new ue({}),c=new he({props:{placeholder:"Search for tags",fetchSuggestions:s[7]}}),c.$on("pick",s[12]),n=new ge({props:{tags:[...s[2],...s[1]]}}),n.$on("click",s[13]),n.$on("contextmenu",s[14]);let Q=te(s[4]),m=[];for(let a=0;a<Q.length;a+=1)m[a]=se(ae(s,Q,a));return{c(){o=O(),t=U("section"),M(r.$$.fragment),w=O(),M(c.$$.fragment),d=O(),M(n.$$.fragment),l=O(),f=U("code"),C=new ne(!1),P=O(),g=U("code"),_=U("p"),q=D(s[5]),H=O();for(let a=0;a<m.length;a+=1)m[a].c();N=O(),y=U("p"),e=D($),E=D("="),S=D(p),this.h()},l(a){oe("svelte-fr2gtz",document.head).forEach(b),o=B(a),t=V(a,"SECTION",{class:!0});var i=j(t);F(r.$$.fragment,i),w=B(i),F(c.$$.fragment,i),d=B(i),F(n.$$.fragment,i),l=B(i),f=V(i,"CODE",{class:!0});var h=j(f);C=le(h,!1),h.forEach(b),P=B(i),g=V(i,"CODE",{class:!0});var k=j(g);_=V(k,"P",{class:!0});var ee=j(_);q=L(ee,s[5]),ee.forEach(b),H=B(k);for(let I=0;I<m.length;I+=1)m[I].l(k);N=B(k),y=V(k,"P",{class:!0});var z=j(y);e=L(z,$),E=L(z,"="),S=L(z,p),z.forEach(b),k.forEach(b),i.forEach(b),this.h()},h(){document.title="kurosearch - Query Builder",C.a=null,A(f,"class","svelte-dhg4ur"),A(_,"class","base svelte-dhg4ur"),A(y,"class","tags svelte-dhg4ur"),A(g,"class","svelte-dhg4ur"),A(t,"class","svelte-dhg4ur")},m(a,v){x(a,o,v),x(a,t,v),J(r,t,null),u(t,w),J(c,t,null),u(t,d),J(n,t,null),u(t,l),u(t,f),C.m(s[0],f),u(t,P),u(t,g),u(g,_),u(_,q),u(g,H);for(let i=0;i<m.length;i+=1)m[i]&&m[i].m(g,null);u(g,N),u(g,y),u(y,e),u(y,E),u(y,S),T=!0},p(a,[v]){const i={};if(v&6&&(i.tags=[...a[2],...a[1]]),n.$set(i),(!T||v&1)&&C.p(a[0]),(!T||v&32)&&K(q,a[5]),v&16){Q=te(a[4]);let h;for(h=0;h<Q.length;h+=1){const k=ae(a,Q,h);m[h]?m[h].p(k,v):(m[h]=se(k),m[h].c(),m[h].m(g,N))}for(;h<m.length;h+=1)m[h].d(1);m.length=Q.length}(!T||v&8)&&$!==($=a[3][0]+"")&&K(e,$),(!T||v&8)&&p!==(p=a[3][1]+"")&&K(S,p)},i(a){T||(W(r.$$.fragment,a),W(c.$$.fragment,a),W(n.$$.fragment,a),T=!0)},o(a){X(r.$$.fragment,a),X(c.$$.fragment,a),X(n.$$.fragment,a),T=!1},d(a){a&&(b(o),b(t)),Y(r),Y(c),Y(n),ie(m,a)}}}function ke(s,o,t){let r,w,c,d,n,l,f,C,P,g,_;R(s,Z,e=>t(1,n=e)),R(s,ve,e=>t(8,l=e)),R(s,we,e=>t(9,f=e)),R(s,be,e=>t(10,C=e)),R(s,G,e=>t(2,P=e)),R(s,ye,e=>t(11,g=e)),R(s,de,e=>t(6,_=e));const q=async e=>{const E=await fe(e);return[..._.items.filter(({name:S})=>S.toLowerCase().includes(e.toLowerCase())).map(S=>({label:S.name,count:S.tags.length,type:"supertag"})),...E]},H=e=>{try{return new URL(e)}catch{return null}},N=async e=>{const E=e.detail;if(E.type==="supertag"){const p=_.items.find(S=>S.name===E.label);if(!p){console.warn("Supertag not present.");return}Z.addOrReplace(p)}else{const p=await _e(e.detail.label);G.addOrReplace({name:e.detail.label,modifier:e.detail.modifier,count:e.detail.count,type:(p==null?void 0:p.type)??"tag"})}},y=e=>"description"in e.detail?Z.removeByName(e.detail.name):G.removeByName(e.detail.name),$=e=>{"description"in e.detail||(e.detail.modifier=pe(e.detail.modifier),G.addOrReplace(e.detail))};return s.$$.update=()=>{s.$$.dirty&3846&&t(0,r=H(new Se().withPid(g.pageCount).withTags(P).withBlockedContent(C).withSortProperty(f.property).withSortDirection(f.direction).withScoreValue(l.scoreValue).withScoreComparator(l.scoreComparator).withRating(l.rating).withSupertags(n).getQuery())),s.$$.dirty&1&&t(5,w=r&&`${r.protocol}//${r.hostname}`),s.$$.dirty&1&&t(4,c=r?[...r.searchParams.entries()].filter(([e])=>["page","s","q","fields","json","limit"].includes(e)):[]),s.$$.dirty&1&&t(3,d=r?[...r.searchParams.entries()].find(([e])=>e==="tags")??["tags",""]:["tags",""])},[r,n,P,d,c,w,_,q,l,f,C,g,N,y,$]}class qe extends ce{constructor(o){super(),me(this,o,ke,Ce,re,{})}}export{qe as component};
