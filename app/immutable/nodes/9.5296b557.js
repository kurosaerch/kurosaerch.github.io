import{s as re,a as z,f as Q,V as ne,l as B,x as oe,d as b,c as $,g as V,h as j,W as le,m as R,j as A,i as x,u,n as K,G as ie,C as O}from"../chunks/scheduler.32f194ce.js";import{S as ce,i as me,b as M,d as W,m as F,a as J,t as X,e as Y}from"../chunks/index.aa0a4971.js";import{e as te}from"../chunks/each.e59479a4.js";import{K as ue,A as ge}from"../chunks/ActiveTagList.d76da173.js";import{S as pe,n as he,s as de}from"../chunks/supertags-store.b42c237d.js";import{g as fe,a as _e}from"../chunks/tags.49324235.js";import{S as we,a as Z,f as Se,s as ve,r as ye}from"../chunks/active-supertags-store.25be6742.js";import{a as G}from"../chunks/active-tags-store.0c57ba23.js";import{b as be}from"../chunks/blocked-content-store.7da87934.js";function ae(s,o,t){const r=s.slice();return r[16]=o[t],r}function se(s){let o,t=s[16][0]+"",r,v,c=s[16][1]+"",d;return{c(){o=Q("p"),r=B(t),v=B("="),d=B(c),this.h()},l(n){o=V(n,"P",{class:!0});var l=j(o);r=R(l,t),v=R(l,"="),d=R(l,c),l.forEach(b),this.h()},h(){A(o,"class","fixed svelte-15wziqd")},m(n,l){x(n,o,l),u(o,r),u(o,v),u(o,d)},p(n,l){l&16&&t!==(t=n[16][0]+"")&&K(r,t),l&16&&c!==(c=n[16][1]+"")&&K(d,c)},d(n){n&&b(o)}}}function Ce(s){let o,t,r,v,c,d,n,l,f,C,q,g,_,D,H,L,y,P=s[3][0]+"",e,E,h=s[3][1]+"",w,T;r=new ue({}),c=new pe({props:{placeholder:"Search for tags",fetchSuggestions:s[7]}}),c.$on("pick",s[12]),n=new ge({props:{tags:[...s[2],...s[1]]}}),n.$on("click",s[13]),n.$on("contextmenu",s[14]);let N=te(s[4]),m=[];for(let a=0;a<N.length;a+=1)m[a]=se(ae(s,N,a));return{c(){o=z(),t=Q("section"),M(r.$$.fragment),v=z(),M(c.$$.fragment),d=z(),M(n.$$.fragment),l=z(),f=Q("code"),C=new ne(!1),q=z(),g=Q("code"),_=Q("p"),D=B(s[5]),H=z();for(let a=0;a<m.length;a+=1)m[a].c();L=z(),y=Q("p"),e=B(P),E=B("="),w=B(h),this.h()},l(a){oe("svelte-fr2gtz",document.head).forEach(b),o=$(a),t=V(a,"SECTION",{class:!0});var i=j(t);W(r.$$.fragment,i),v=$(i),W(c.$$.fragment,i),d=$(i),W(n.$$.fragment,i),l=$(i),f=V(i,"CODE",{class:!0});var p=j(f);C=le(p,!1),p.forEach(b),q=$(i),g=V(i,"CODE",{class:!0});var k=j(g);_=V(k,"P",{class:!0});var ee=j(_);D=R(ee,s[5]),ee.forEach(b),H=$(k);for(let I=0;I<m.length;I+=1)m[I].l(k);L=$(k),y=V(k,"P",{class:!0});var U=j(y);e=R(U,P),E=R(U,"="),w=R(U,h),U.forEach(b),k.forEach(b),i.forEach(b),this.h()},h(){document.title="kurosearch - Query Builder",C.a=null,A(f,"class","svelte-15wziqd"),A(_,"class","base svelte-15wziqd"),A(y,"class","tags svelte-15wziqd"),A(g,"class","svelte-15wziqd"),A(t,"class","svelte-15wziqd")},m(a,S){x(a,o,S),x(a,t,S),F(r,t,null),u(t,v),F(c,t,null),u(t,d),F(n,t,null),u(t,l),u(t,f),C.m(s[0],f),u(t,q),u(t,g),u(g,_),u(_,D),u(g,H);for(let i=0;i<m.length;i+=1)m[i]&&m[i].m(g,null);u(g,L),u(g,y),u(y,e),u(y,E),u(y,w),T=!0},p(a,[S]){const i={};if(S&6&&(i.tags=[...a[2],...a[1]]),n.$set(i),(!T||S&1)&&C.p(a[0]),(!T||S&32)&&K(D,a[5]),S&16){N=te(a[4]);let p;for(p=0;p<N.length;p+=1){const k=ae(a,N,p);m[p]?m[p].p(k,S):(m[p]=se(k),m[p].c(),m[p].m(g,L))}for(;p<m.length;p+=1)m[p].d(1);m.length=N.length}(!T||S&8)&&P!==(P=a[3][0]+"")&&K(e,P),(!T||S&8)&&h!==(h=a[3][1]+"")&&K(w,h)},i(a){T||(J(r.$$.fragment,a),J(c.$$.fragment,a),J(n.$$.fragment,a),T=!0)},o(a){X(r.$$.fragment,a),X(c.$$.fragment,a),X(n.$$.fragment,a),T=!1},d(a){a&&(b(o),b(t)),Y(r),Y(c),Y(n),ie(m,a)}}}function ke(s,o,t){let r,v,c,d,n,l,f,C,q,g,_;O(s,Z,e=>t(1,n=e)),O(s,Se,e=>t(8,l=e)),O(s,ve,e=>t(9,f=e)),O(s,be,e=>t(10,C=e)),O(s,G,e=>t(2,q=e)),O(s,ye,e=>t(11,g=e)),O(s,de,e=>t(6,_=e));const D=async e=>{const E=await fe(e);return[..._.items.filter(({name:w})=>w.toLowerCase().includes(e.toLowerCase())).map(w=>({label:w.name,count:w.tags.length,type:"supertag"})),...E]},H=e=>{try{return new URL(e)}catch{return null}},L=async e=>{const E=e.detail;if(E.type==="supertag"){const h=_.items.find(w=>w.name===E.label);if(!h){console.warn("Supertag not present.");return}Z.addOrReplace(h)}else{const h=await _e(e.detail.label);G.addOrReplace({name:e.detail.label,modifier:e.detail.modifier,count:e.detail.count,type:(h==null?void 0:h.type)??"tag"})}},y=e=>"description"in e.detail?Z.removeByName(e.detail.name):G.removeByName(e.detail.name),P=e=>{"description"in e.detail||(e.detail.modifier=he(e.detail.modifier),G.addOrReplace(e.detail))};return s.$$.update=()=>{s.$$.dirty&3846&&t(0,r=H(new we().withPid(g.pageCount).withTags(q).withBlockedContent(C).withSortProperty(f.property).withSortDirection(f.direction).withScoreValue(l.scoreValue).withScoreComparator(l.scoreComparator).withRating(l.rating).withSupertags(n).getQuery())),s.$$.dirty&1&&t(5,v=r&&`${r.protocol}//${r.hostname}`),s.$$.dirty&1&&t(4,c=r?[...r.searchParams.entries()].filter(([e])=>["page","s","q","fields","json","limit"].includes(e)):[]),s.$$.dirty&1&&t(3,d=r?[...r.searchParams.entries()].find(([e])=>e==="tags")??["tags",""]:["tags",""])},[r,n,q,d,c,v,_,D,l,f,C,g,L,y,P]}class De extends ce{constructor(o){super(),me(this,o,ke,Ce,re,{})}}export{De as component};
