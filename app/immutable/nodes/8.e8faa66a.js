import{s as re,a as $,f as Q,U as ne,l as B,x as oe,d as y,c as O,g as U,h as V,V as le,m as D,j,i as x,u,n as F,P as ie,C as N}from"../chunks/scheduler.88299003.js";import{S as ce,i as ge,b as M,d as G,m as J,a as W,t as X,e as Y}from"../chunks/index.15b414ac.js";import{e as te}from"../chunks/each.e59479a4.js";import{K as ue,A as me,S as he,a as Z,s as pe,r as de}from"../chunks/search-builder.1bb73e3b.js";import{S as fe,n as _e,s as ve}from"../chunks/supertags-store.112748a7.js";import{g as Se,a as ye}from"../chunks/tags.58927cde.js";import{a as z}from"../chunks/active-tags-store.ee1f6602.js";import{b as we}from"../chunks/blocked-content-store.805c4a3d.js";function ae(s,l,t){const r=s.slice();return r[15]=l[t],r}function se(s){let l,t=s[15][0]+"",r,_,c=s[15][1]+"",d;return{c(){l=Q("p"),r=B(t),_=B("="),d=B(c),this.h()},l(n){l=U(n,"P",{class:!0});var o=V(l);r=D(o,t),_=D(o,"="),d=D(o,c),o.forEach(y),this.h()},h(){j(l,"class","fixed svelte-dhg4ur")},m(n,o){x(n,l,o),u(l,r),u(l,_),u(l,d)},p(n,o){o&16&&t!==(t=n[15][0]+"")&&F(r,t),o&16&&c!==(c=n[15][1]+"")&&F(d,c)},d(n){n&&y(l)}}}function be(s){let l,t,r,_,c,d,n,o,v,w,T,m,P,R,A,L,S,e=s[3][0]+"",b,C,p=s[3][1]+"",H,E;r=new ue({}),c=new fe({props:{placeholder:"Search for tags",fetchSuggestions:s[7]}}),c.$on("pick",s[11]),n=new me({props:{tags:[...s[2],...s[1]]}}),n.$on("click",s[12]),n.$on("contextmenu",s[13]);let q=te(s[4]),g=[];for(let a=0;a<q.length;a+=1)g[a]=se(ae(s,q,a));return{c(){l=$(),t=Q("section"),M(r.$$.fragment),_=$(),M(c.$$.fragment),d=$(),M(n.$$.fragment),o=$(),v=Q("code"),w=new ne(!1),T=$(),m=Q("code"),P=Q("p"),R=B(s[5]),A=$();for(let a=0;a<g.length;a+=1)g[a].c();L=$(),S=Q("p"),b=B(e),C=B("="),H=B(p),this.h()},l(a){oe("svelte-fr2gtz",document.head).forEach(y),l=O(a),t=U(a,"SECTION",{class:!0});var i=V(t);G(r.$$.fragment,i),_=O(i),G(c.$$.fragment,i),d=O(i),G(n.$$.fragment,i),o=O(i),v=U(i,"CODE",{class:!0});var h=V(v);w=le(h,!1),h.forEach(y),T=O(i),m=U(i,"CODE",{class:!0});var k=V(m);P=U(k,"P",{class:!0});var ee=V(P);R=D(ee,s[5]),ee.forEach(y),A=O(k);for(let I=0;I<g.length;I+=1)g[I].l(k);L=O(k),S=U(k,"P",{class:!0});var K=V(S);b=D(K,e),C=D(K,"="),H=D(K,p),K.forEach(y),k.forEach(y),i.forEach(y),this.h()},h(){document.title="kurosearch - Query Builder",w.a=null,j(v,"class","svelte-dhg4ur"),j(P,"class","base svelte-dhg4ur"),j(S,"class","tags svelte-dhg4ur"),j(m,"class","svelte-dhg4ur"),j(t,"class","svelte-dhg4ur")},m(a,f){x(a,l,f),x(a,t,f),J(r,t,null),u(t,_),J(c,t,null),u(t,d),J(n,t,null),u(t,o),u(t,v),w.m(s[0],v),u(t,T),u(t,m),u(m,P),u(P,R),u(m,A);for(let i=0;i<g.length;i+=1)g[i]&&g[i].m(m,null);u(m,L),u(m,S),u(S,b),u(S,C),u(S,H),E=!0},p(a,[f]){const i={};if(f&6&&(i.tags=[...a[2],...a[1]]),n.$set(i),(!E||f&1)&&w.p(a[0]),(!E||f&32)&&F(R,a[5]),f&16){q=te(a[4]);let h;for(h=0;h<q.length;h+=1){const k=ae(a,q,h);g[h]?g[h].p(k,f):(g[h]=se(k),g[h].c(),g[h].m(m,L))}for(;h<g.length;h+=1)g[h].d(1);g.length=q.length}(!E||f&8)&&e!==(e=a[3][0]+"")&&F(b,e),(!E||f&8)&&p!==(p=a[3][1]+"")&&F(H,p)},i(a){E||(W(r.$$.fragment,a),W(c.$$.fragment,a),W(n.$$.fragment,a),E=!0)},o(a){X(r.$$.fragment,a),X(c.$$.fragment,a),X(n.$$.fragment,a),E=!1},d(a){a&&(y(l),y(t)),Y(r),Y(c),Y(n),ie(g,a)}}}function Ce(s,l,t){let r,_,c,d,n,o,v,w,T,m;N(s,Z,e=>t(1,n=e)),N(s,pe,e=>t(8,o=e)),N(s,we,e=>t(9,v=e)),N(s,z,e=>t(2,w=e)),N(s,de,e=>t(10,T=e)),N(s,ve,e=>t(6,m=e));const P=async e=>{const b=await Se(e);return[...m.items.filter(({name:p})=>p.toLowerCase().includes(e.toLowerCase())).map(p=>({label:p.name,count:p.tags.length,type:"supertag"})),...b]},R=e=>{try{return new URL(e)}catch{return null}},A=async e=>{const b=e.detail;if(b.type==="supertag"){const C=m.items.find(p=>p.name===b.label);if(!C){console.log("Supertag not present.");return}Z.addOrReplace(C)}else{const C=await ye(e.detail.label);z.addOrReplace({name:e.detail.label,modifier:e.detail.modifier,count:e.detail.count,type:C.type})}},L=e=>"description"in e.detail?Z.removeByName(e.detail.name):z.removeByName(e.detail.name),S=e=>{"description"in e.detail||(e.detail.modifier=_e(e.detail.modifier),z.addOrReplace(e.detail))};return s.$$.update=()=>{s.$$.dirty&1798&&t(0,r=R(new he().withPid(T.pageCount).withTags(w).withBlockedContent(v).withSortProperty(o.sortProperty).withSortDirection(o.sortDirection).withScoreValue(o.scoreValue).withScoreComparator(o.scoreComparator).withRating(o.rating).withSupertags(n).getQuery())),s.$$.dirty&1&&t(5,_=r&&`${r.protocol}//${r.hostname}`),s.$$.dirty&1&&t(4,c=r?[...r.searchParams.entries()].filter(([e])=>["page","s","q","fields","json","limit"].includes(e)):[]),s.$$.dirty&1&&t(3,d=r?[...r.searchParams.entries()].find(([e])=>e==="tags")??["tags",""]:["tags",""])},[r,n,w,d,c,_,m,P,o,v,T,A,L,S]}class Re extends ce{constructor(l){super(),ge(this,l,Ce,be,re,{})}}export{Re as component};
