import{s as re,a as O,f as U,U as ne,l as D,x as oe,d as b,c as B,g as V,h as j,V as le,m as L,j as A,i as x,u as g,n as K,P as ie,C as R}from"../chunks/scheduler.88299003.js";import{S as ce,i as ue,b as F,d as G,m as J,a as W,t as X,e as Y}from"../chunks/index.15b414ac.js";import{e as te}from"../chunks/each.e59479a4.js";import{K as ge,A as me,S as he,a as Z,f as pe,s as de,r as fe}from"../chunks/search-builder.db79c358.js";import{S as _e,n as Se,s as ve}from"../chunks/supertags-store.318786ac.js";import{g as we,a as ye}from"../chunks/tags.49324235.js";import{a as I}from"../chunks/posts.779cfae3.js";import{b as be}from"../chunks/blocked-content-store.8cb9d99a.js";function ae(s,o,t){const r=s.slice();return r[16]=o[t],r}function se(s){let o,t=s[16][0]+"",r,w,c=s[16][1]+"",d;return{c(){o=U("p"),r=D(t),w=D("="),d=D(c),this.h()},l(n){o=V(n,"P",{class:!0});var l=j(o);r=L(l,t),w=L(l,"="),d=L(l,c),l.forEach(b),this.h()},h(){A(o,"class","fixed svelte-dhg4ur")},m(n,l){x(n,o,l),g(o,r),g(o,w),g(o,d)},p(n,l){l&16&&t!==(t=n[16][0]+"")&&K(r,t),l&16&&c!==(c=n[16][1]+"")&&K(d,c)},d(n){n&&b(o)}}}function Ce(s){let o,t,r,w,c,d,n,l,f,C,T,m,_,q,H,N,y,$=s[3][0]+"",e,E,p=s[3][1]+"",S,P;r=new ge({}),c=new _e({props:{placeholder:"Search for tags",fetchSuggestions:s[7]}}),c.$on("pick",s[12]),n=new me({props:{tags:[...s[2],...s[1]]}}),n.$on("click",s[13]),n.$on("contextmenu",s[14]);let Q=te(s[4]),u=[];for(let a=0;a<Q.length;a+=1)u[a]=se(ae(s,Q,a));return{c(){o=O(),t=U("section"),F(r.$$.fragment),w=O(),F(c.$$.fragment),d=O(),F(n.$$.fragment),l=O(),f=U("code"),C=new ne(!1),T=O(),m=U("code"),_=U("p"),q=D(s[5]),H=O();for(let a=0;a<u.length;a+=1)u[a].c();N=O(),y=U("p"),e=D($),E=D("="),S=D(p),this.h()},l(a){oe("svelte-fr2gtz",document.head).forEach(b),o=B(a),t=V(a,"SECTION",{class:!0});var i=j(t);G(r.$$.fragment,i),w=B(i),G(c.$$.fragment,i),d=B(i),G(n.$$.fragment,i),l=B(i),f=V(i,"CODE",{class:!0});var h=j(f);C=le(h,!1),h.forEach(b),T=B(i),m=V(i,"CODE",{class:!0});var k=j(m);_=V(k,"P",{class:!0});var ee=j(_);q=L(ee,s[5]),ee.forEach(b),H=B(k);for(let M=0;M<u.length;M+=1)u[M].l(k);N=B(k),y=V(k,"P",{class:!0});var z=j(y);e=L(z,$),E=L(z,"="),S=L(z,p),z.forEach(b),k.forEach(b),i.forEach(b),this.h()},h(){document.title="kurosearch - Query Builder",C.a=null,A(f,"class","svelte-dhg4ur"),A(_,"class","base svelte-dhg4ur"),A(y,"class","tags svelte-dhg4ur"),A(m,"class","svelte-dhg4ur"),A(t,"class","svelte-dhg4ur")},m(a,v){x(a,o,v),x(a,t,v),J(r,t,null),g(t,w),J(c,t,null),g(t,d),J(n,t,null),g(t,l),g(t,f),C.m(s[0],f),g(t,T),g(t,m),g(m,_),g(_,q),g(m,H);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(m,null);g(m,N),g(m,y),g(y,e),g(y,E),g(y,S),P=!0},p(a,[v]){const i={};if(v&6&&(i.tags=[...a[2],...a[1]]),n.$set(i),(!P||v&1)&&C.p(a[0]),(!P||v&32)&&K(q,a[5]),v&16){Q=te(a[4]);let h;for(h=0;h<Q.length;h+=1){const k=ae(a,Q,h);u[h]?u[h].p(k,v):(u[h]=se(k),u[h].c(),u[h].m(m,N))}for(;h<u.length;h+=1)u[h].d(1);u.length=Q.length}(!P||v&8)&&$!==($=a[3][0]+"")&&K(e,$),(!P||v&8)&&p!==(p=a[3][1]+"")&&K(S,p)},i(a){P||(W(r.$$.fragment,a),W(c.$$.fragment,a),W(n.$$.fragment,a),P=!0)},o(a){X(r.$$.fragment,a),X(c.$$.fragment,a),X(n.$$.fragment,a),P=!1},d(a){a&&(b(o),b(t)),Y(r),Y(c),Y(n),ie(u,a)}}}function ke(s,o,t){let r,w,c,d,n,l,f,C,T,m,_;R(s,Z,e=>t(1,n=e)),R(s,pe,e=>t(8,l=e)),R(s,de,e=>t(9,f=e)),R(s,be,e=>t(10,C=e)),R(s,I,e=>t(2,T=e)),R(s,fe,e=>t(11,m=e)),R(s,ve,e=>t(6,_=e));const q=async e=>{const E=await we(e);return[..._.items.filter(({name:S})=>S.toLowerCase().includes(e.toLowerCase())).map(S=>({label:S.name,count:S.tags.length,type:"supertag"})),...E]},H=e=>{try{return new URL(e)}catch{return null}},N=async e=>{const E=e.detail;if(E.type==="supertag"){const p=_.items.find(S=>S.name===E.label);if(!p){console.warn("Supertag not present.");return}Z.addOrReplace(p)}else{const p=await ye(e.detail.label);I.addOrReplace({name:e.detail.label,modifier:e.detail.modifier,count:e.detail.count,type:(p==null?void 0:p.type)??"tag"})}},y=e=>"description"in e.detail?Z.removeByName(e.detail.name):I.removeByName(e.detail.name),$=e=>{"description"in e.detail||(e.detail.modifier=Se(e.detail.modifier),I.addOrReplace(e.detail))};return s.$$.update=()=>{s.$$.dirty&3846&&t(0,r=H(new he().withPid(m.pageCount).withTags(T).withBlockedContent(C).withSortProperty(f.property).withSortDirection(f.direction).withScoreValue(l.scoreValue).withScoreComparator(l.scoreComparator).withRating(l.rating).withSupertags(n).getQuery())),s.$$.dirty&1&&t(5,w=r&&`${r.protocol}//${r.hostname}`),s.$$.dirty&1&&t(4,c=r?[...r.searchParams.entries()].filter(([e])=>["page","s","q","fields","json","limit"].includes(e)):[]),s.$$.dirty&1&&t(3,d=r?[...r.searchParams.entries()].find(([e])=>e==="tags")??["tags",""]:["tags",""])},[r,n,T,d,c,w,_,q,l,f,C,m,N,y,$]}class Le extends ce{constructor(o){super(),ue(this,o,ke,Ce,re,{})}}export{Le as component};
