import{s as ae,f as N,a as B,U as se,l as $,g as U,h as V,c as L,V as re,d as k,m as E,j,i as te,u as m,n as H,P as ne,C as q}from"../chunks/scheduler.6c5d9662.js";import{S as oe,i as le,b as M,d as z,m as G,a as J,t as W,e as X}from"../chunks/index.8c724fb2.js";import{e as Z}from"../chunks/each.e59479a4.js";import{K as ie,A as ce,S as ge,a as Y,s as me,r as ue}from"../chunks/search-builder.006009c0.js";import{S as he,n as pe,s as fe}from"../chunks/supertags-store.aa92af77.js";import{g as de,a as _e}from"../chunks/tags.afa77e19.js";import{a as Q}from"../chunks/active-tags-store.72f5ae3d.js";import{b as Se}from"../chunks/blocked-content-store.64bd99a1.js";function x(a,s,r){const o=a.slice();return o[15]=s[r],o}function ee(a){let s,r=a[15][0]+"",o,h,f=a[15][1]+"",c;return{c(){s=N("p"),o=$(r),h=$("="),c=$(f),this.h()},l(u){s=U(u,"P",{class:!0});var n=V(s);o=E(n,r),h=E(n,"="),c=E(n,f),n.forEach(k),this.h()},h(){j(s,"class","fixed svelte-dhg4ur")},m(u,n){te(u,s,n),m(s,o),m(s,h),m(s,c)},p(u,n){n&16&&r!==(r=u[15][0]+"")&&H(o,r),n&16&&f!==(f=u[15][1]+"")&&H(c,f)},d(u){u&&k(s)}}}function ve(a){let s,r,o,h,f,c,u,n,y,P,p,d,O,A,D,v,T=a[3][0]+"",e,b,_=a[3][1]+"",S,C;r=new ie({}),h=new he({props:{placeholder:"Search for tags",fetchSuggestions:a[7]}}),h.$on("pick",a[11]),c=new ce({props:{tags:[...a[2],...a[1]]}}),c.$on("click",a[12]),c.$on("contextmenu",a[13]);let R=Z(a[4]),g=[];for(let t=0;t<R.length;t+=1)g[t]=ee(x(a,R,t));return{c(){s=N("section"),M(r.$$.fragment),o=B(),M(h.$$.fragment),f=B(),M(c.$$.fragment),u=B(),n=N("code"),y=new se(!1),P=B(),p=N("code"),d=N("p"),O=$(a[5]),A=B();for(let t=0;t<g.length;t+=1)g[t].c();D=B(),v=N("p"),e=$(T),b=$("="),S=$(_),this.h()},l(t){s=U(t,"SECTION",{class:!0});var l=V(s);z(r.$$.fragment,l),o=L(l),z(h.$$.fragment,l),f=L(l),z(c.$$.fragment,l),u=L(l),n=U(l,"CODE",{class:!0});var w=V(n);y=re(w,!1),w.forEach(k),P=L(l),p=U(l,"CODE",{class:!0});var i=V(p);d=U(i,"P",{class:!0});var F=V(d);O=E(F,a[5]),F.forEach(k),A=L(i);for(let I=0;I<g.length;I+=1)g[I].l(i);D=L(i),v=U(i,"P",{class:!0});var K=V(v);e=E(K,T),b=E(K,"="),S=E(K,_),K.forEach(k),i.forEach(k),l.forEach(k),this.h()},h(){y.a=null,j(n,"class","svelte-dhg4ur"),j(d,"class","base svelte-dhg4ur"),j(v,"class","tags svelte-dhg4ur"),j(p,"class","svelte-dhg4ur"),j(s,"class","svelte-dhg4ur")},m(t,l){te(t,s,l),G(r,s,null),m(s,o),G(h,s,null),m(s,f),G(c,s,null),m(s,u),m(s,n),y.m(a[0],n),m(s,P),m(s,p),m(p,d),m(d,O),m(p,A);for(let w=0;w<g.length;w+=1)g[w]&&g[w].m(p,null);m(p,D),m(p,v),m(v,e),m(v,b),m(v,S),C=!0},p(t,[l]){const w={};if(l&6&&(w.tags=[...t[2],...t[1]]),c.$set(w),(!C||l&1)&&y.p(t[0]),(!C||l&32)&&H(O,t[5]),l&16){R=Z(t[4]);let i;for(i=0;i<R.length;i+=1){const F=x(t,R,i);g[i]?g[i].p(F,l):(g[i]=ee(F),g[i].c(),g[i].m(p,D))}for(;i<g.length;i+=1)g[i].d(1);g.length=R.length}(!C||l&8)&&T!==(T=t[3][0]+"")&&H(e,T),(!C||l&8)&&_!==(_=t[3][1]+"")&&H(S,_)},i(t){C||(J(r.$$.fragment,t),J(h.$$.fragment,t),J(c.$$.fragment,t),C=!0)},o(t){W(r.$$.fragment,t),W(h.$$.fragment,t),W(c.$$.fragment,t),C=!1},d(t){t&&k(s),X(r),X(h),X(c),ne(g,t)}}}function we(a,s,r){let o,h,f,c,u,n,y,P,p,d;q(a,Y,e=>r(1,u=e)),q(a,me,e=>r(8,n=e)),q(a,Se,e=>r(9,y=e)),q(a,Q,e=>r(2,P=e)),q(a,ue,e=>r(10,p=e)),q(a,fe,e=>r(6,d=e));const O=async e=>{const b=await de(e);return[...d.items.filter(({name:S})=>S.toLowerCase().includes(e.toLowerCase())).map(S=>({label:S.name,count:S.tags.length,type:"supertag"})),...b]},A=e=>{try{return new URL(e)}catch{return null}},D=async e=>{const b=e.detail;if(b.type==="supertag"){const _=d.items.find(S=>S.name===b.label);if(!_){console.log("Supertag not present.");return}Y.addOrReplace(_)}else{const _=await _e(e.detail.label);Q.addOrReplace({name:e.detail.label,modifier:e.detail.modifier,count:e.detail.count,type:_.type})}},v=e=>"description"in e.detail?Y.removeByName(e.detail.name):Q.removeByName(e.detail.name),T=e=>{"description"in e.detail||(e.detail.modifier=pe(e.detail.modifier),Q.addOrReplace(e.detail))};return a.$$.update=()=>{a.$$.dirty&1798&&r(0,o=A(new ge().withPid(p.pageCount).withTags(P).withBlockedContent(y).withSortProperty(n.sortProperty).withSortDirection(n.sortDirection).withScoreValue(n.scoreValue).withScoreComparator(n.scoreComparator).withRating(n.rating).withSupertags(u).getQuery())),a.$$.dirty&1&&r(5,h=o&&`${o.protocol}//${o.hostname}`),a.$$.dirty&1&&r(4,f=o?[...o.searchParams.entries()].filter(([e])=>["page","s","q","fields","json","limit"].includes(e)):[]),a.$$.dirty&1&&r(3,c=o?[...o.searchParams.entries()].find(([e])=>e==="tags")??["tags",""]:["tags",""])},[o,u,P,c,f,h,d,O,n,y,p,D,v,T]}class Oe extends oe{constructor(s){super(),le(this,s,we,ve,ae,{})}}export{Oe as component};
