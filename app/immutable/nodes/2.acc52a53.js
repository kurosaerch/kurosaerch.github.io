import{s as le,f as C,a as N,g as I,c as T,y as ue,D as pe,j as v,i as D,d as h,E as me,l as x,m as ee,e as _e,h as O,u as y,F as re,n as Te,C as fe,G as vt,p as be,H as ye,I as Re,J as it,K as je,L as we,v as G,k as qe,M as Ue,w as bt,N as kt,z as yt,A as wt,B as Et,o as Fe,O as Ve,P as ze,r as ct}from"../chunks/scheduler.88299003.js";import{S as oe,i as ae,b as R,d as A,m as B,a as E,t as S,e as j,g as te,c as se,f as Ae}from"../chunks/index.15b414ac.js";import{s as ce,r as Ne,K as St,A as Ct,a as Me,S as It}from"../chunks/search-builder.9209983a.js";import{a as De}from"../chunks/posts.e71a7ea5.js";import{S as Pt,n as Dt,s as Ye}from"../chunks/supertags-store.82737375.js";import{T as Oe}from"../chunks/TextButton.2f318c50.js";import{g as Nt,a as Tt}from"../chunks/tags.58927cde.js";import{b as ut}from"../chunks/paths.c1300dd8.js";import{e as Ee}from"../chunks/each.e59479a4.js";import{D as ft,r as Ot}from"../chunks/Dialog.f8853b6f.js";import{i as pt,D as _t,g as Lt,G as mt,V as Rt,I as At}from"../chunks/Details.15636c71.js";import{f as Le}from"../chunks/format-tag.d6c065e3.js";import{R as Bt,I as Be}from"../chunks/ModifierSelect.623aacd6.js";import{S as Ze}from"../chunks/Select.22805bc7.js";import{R as jt}from"../chunks/RotatingTextSelect.7e32facf.js";import{b as Ft}from"../chunks/blocked-content-store.db35eae7.js";import{D as Vt}from"../chunks/DetailedTag.28ff9b0d.js";import{S as Mt}from"../chunks/ScrollUpButton.cfa21b3f.js";import{l as qt}from"../chunks/analytics.eca95ce1.js";function Ut(n){let e;return{c(){e=x("Reset Filter")},l(s){e=ee(s,"Reset Filter")},m(s,t){D(s,e,t)},d(s){s&&h(e)}}}function zt(n){let e,s,t,r,l="We couldn't find any posts matching your tags. Sorry...",o,a,i;return a=new Oe({props:{title:"In case your filter caused all posts to vanish. Reset it.",$$slots:{default:[Ut]},$$scope:{ctx:n}}}),a.$on("click",n[1]),{c(){e=C("img"),t=N(),r=C("p"),r.textContent=l,o=N(),R(a.$$.fragment),this.h()},l(f){e=I(f,"IMG",{src:!0,alt:!0,class:!0}),t=T(f),r=I(f,"P",{"data-svelte-h":!0}),ue(r)!=="svelte-1utxj3w"&&(r.textContent=l),o=T(f),A(a.$$.fragment,f),this.h()},h(){pe(e.src,s=ut+"/assets/shironeko-confused.png")||v(e,"src",s),v(e,"alt","Nothing here..."),v(e,"class","svelte-1bb5e7g")},m(f,u){D(f,e,u),D(f,t,u),D(f,r,u),D(f,o,u),B(a,f,u),i=!0},p(f,[u]){const p={};u&4&&(p.$$scope={dirty:u,ctx:f}),a.$set(p)},i(f){i||(E(a.$$.fragment,f),i=!0)},o(f){S(a.$$.fragment,f),i=!1},d(f){f&&(h(e),h(t),h(r),h(o)),j(a,f)}}}function Gt(n){const e=me();return[e,()=>{ce.reset(),e("sortfilterupdate")}]}class Kt extends oe{constructor(e){super(),ae(this,e,Gt,zt,le,{})}}function Je(n){let e,s;return e=new ft({props:{$$slots:{default:[Yt]},$$scope:{ctx:n}}}),e.$on("close",n[6]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&32771&&(l.$$scope={dirty:r,ctx:t}),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Wt(n){let e;return{c(){e=x("Done")},l(s){e=ee(s,"Done")},m(s,t){D(s,e,t)},d(s){s&&h(e)}}}function Ht(n){let e;return{c(){e=x("Reset")},l(s){e=ee(s,"Reset")},m(s,t){D(s,e,t)},d(s){s&&h(e)}}}function Yt(n){let e,s,t="Sorting and Filtering",r,l,o,a="Sorting",i,f,u,p,m,k,$,b,d,g,c="Filtering by Score",_,P,W,Q,H,K,ie,w,U,J="Filtering by Rating",Z,X,M,Se,F,L,Y,q,ne,ke,Ce;function Ie(V){n[8](V)}let Ge={options:Qt};n[1].sortDirection!==void 0&&(Ge.value=n[1].sortDirection),u=new Bt({props:Ge}),be.push(()=>Ae(u,"value",Ie));function gt(V){n[9](V)}let Ke={options:Jt};n[1].sortProperty!==void 0&&(Ke.value=n[1].sortProperty),k=new Ze({props:Ke}),be.push(()=>Ae(k,"value",gt));function ht(V){n[10](V)}let We={options:Xt};n[1].scoreComparator!==void 0&&(We.value=n[1].scoreComparator),W=new jt({props:We}),be.push(()=>Ae(W,"value",ht));function $t(V){n[13](V)}let He={options:dt};return n[1].rating!==void 0&&(He.value=n[1].rating),M=new Ze({props:He}),be.push(()=>Ae(M,"value",$t)),L=new Oe({props:{title:"Return to searching.",$$slots:{default:[Wt]},$$scope:{ctx:n}}}),L.$on("click",n[6]),q=new Oe({props:{title:"Reset sort and filter.",type:"secondary",$$slots:{default:[Ht]},$$scope:{ctx:n}}}),q.$on("click",n[7]),{c(){e=C("div"),s=C("h3"),s.textContent=t,r=N(),l=C("label"),o=C("b"),o.textContent=a,i=N(),f=C("div"),R(u.$$.fragment),m=N(),R(k.$$.fragment),b=N(),d=C("label"),g=C("b"),g.textContent=c,_=N(),P=C("div"),R(W.$$.fragment),H=N(),K=C("input"),ie=N(),w=C("label"),U=C("b"),U.textContent=J,Z=N(),X=C("div"),R(M.$$.fragment),F=N(),R(L.$$.fragment),Y=N(),R(q.$$.fragment),this.h()},l(V){e=I(V,"DIV",{class:!0});var z=O(e);s=I(z,"H3",{"data-svelte-h":!0}),ue(s)!=="svelte-15zouq3"&&(s.textContent=t),r=T(z),l=I(z,"LABEL",{class:!0});var de=O(l);o=I(de,"B",{"data-svelte-h":!0}),ue(o)!=="svelte-ekzpgg"&&(o.textContent=a),i=T(de),f=I(de,"DIV",{class:!0});var ge=O(f);A(u.$$.fragment,ge),m=T(ge),A(k.$$.fragment,ge),ge.forEach(h),de.forEach(h),b=T(z),d=I(z,"LABEL",{class:!0});var he=O(d);g=I(he,"B",{"data-svelte-h":!0}),ue(g)!=="svelte-1flca3"&&(g.textContent=c),_=T(he),P=I(he,"DIV",{class:!0});var $e=O(P);A(W.$$.fragment,$e),H=T($e),K=I($e,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),$e.forEach(h),he.forEach(h),ie=T(z),w=I(z,"LABEL",{class:!0});var ve=O(w);U=I(ve,"B",{"data-svelte-h":!0}),ue(U)!=="svelte-1evbw58"&&(U.textContent=J),Z=T(ve),X=I(ve,"DIV",{class:!0});var Pe=O(X);A(M.$$.fragment,Pe),Pe.forEach(h),ve.forEach(h),F=T(z),A(L.$$.fragment,z),Y=T(z),A(q.$$.fragment,z),z.forEach(h),this.h()},h(){v(f,"class","row svelte-1omoy36"),v(l,"class","svelte-1omoy36"),v(K,"type","number"),v(K,"min",0),v(K,"max",1e5),v(K,"step",1),v(K,"class","svelte-1omoy36"),v(P,"class","row svelte-1omoy36"),v(d,"class","svelte-1omoy36"),v(X,"class","row svelte-1omoy36"),v(w,"class","svelte-1omoy36"),v(e,"class","container svelte-1omoy36")},m(V,z){D(V,e,z),y(e,s),y(e,r),y(e,l),y(l,o),y(l,i),y(l,f),B(u,f,null),y(f,m),B(k,f,null),y(e,b),y(e,d),y(d,g),y(d,_),y(d,P),B(W,P,null),y(P,H),y(P,K),ye(K,n[0]),y(e,ie),y(e,w),y(w,U),y(w,Z),y(w,X),B(M,X,null),y(e,F),B(L,e,null),y(e,Y),B(q,e,null),ne=!0,ke||(Ce=[re(K,"input",n[11]),re(K,"keyup",n[12])],ke=!0)},p(V,z){const de={};!p&&z&2&&(p=!0,de.value=V[1].sortDirection,Re(()=>p=!1)),u.$set(de);const ge={};!$&&z&2&&($=!0,ge.value=V[1].sortProperty,Re(()=>$=!1)),k.$set(ge);const he={};!Q&&z&2&&(Q=!0,he.value=V[1].scoreComparator,Re(()=>Q=!1)),W.$set(he),z&1&&it(K.value)!==V[0]&&ye(K,V[0]);const $e={};!Se&&z&2&&(Se=!0,$e.value=V[1].rating,Re(()=>Se=!1)),M.$set($e);const ve={};z&32768&&(ve.$$scope={dirty:z,ctx:V}),L.$set(ve);const Pe={};z&32768&&(Pe.$$scope={dirty:z,ctx:V}),q.$set(Pe)},i(V){ne||(E(u.$$.fragment,V),E(k.$$.fragment,V),E(W.$$.fragment,V),E(M.$$.fragment,V),E(L.$$.fragment,V),E(q.$$.fragment,V),ne=!0)},o(V){S(u.$$.fragment,V),S(k.$$.fragment,V),S(W.$$.fragment,V),S(M.$$.fragment,V),S(L.$$.fragment,V),S(q.$$.fragment,V),ne=!1},d(V){V&&h(e),j(u),j(k),j(W),j(M),j(L),j(q),ke=!1,je(Ce)}}}function Zt(n){let e,s,t,r,l,o,a,i,f,u,p,m,k,$,b,d=n[2]&&Je(n);return{c(){e=C("button"),s=C("i"),t=N(),r=C("span"),l=x(n[4]),o=N(),a=C("i"),i=N(),f=C("span"),u=x(n[3]),p=N(),d&&d.c(),m=_e(),this.h()},l(g){e=I(g,"BUTTON",{class:!0});var c=O(e);s=I(c,"I",{class:!0}),O(s).forEach(h),t=T(c),r=I(c,"SPAN",{});var _=O(r);l=ee(_,n[4]),_.forEach(h),o=T(c),a=I(c,"I",{class:!0}),O(a).forEach(h),i=T(c),f=I(c,"SPAN",{});var P=O(f);u=ee(P,n[3]),P.forEach(h),c.forEach(h),p=T(g),d&&d.l(g),m=_e(),this.h()},h(){v(s,"class","codicon codicon-filter svelte-1omoy36"),v(a,"class","codicon codicon-arrow-swap svelte-1omoy36"),v(e,"class","svelte-1omoy36")},m(g,c){D(g,e,c),y(e,s),y(e,t),y(e,r),y(r,l),y(e,o),y(e,a),y(e,i),y(e,f),y(f,u),D(g,p,c),d&&d.m(g,c),D(g,m,c),k=!0,$||(b=re(e,"click",n[5]),$=!0)},p(g,[c]){(!k||c&16)&&Te(l,g[4]),(!k||c&8)&&Te(u,g[3]),g[2]?d?(d.p(g,c),c&4&&E(d,1)):(d=Je(g),d.c(),E(d,1),d.m(m.parentNode,m)):d&&(te(),S(d,1,1,()=>{d=null}),se())},i(g){k||(E(d),k=!0)},o(g){S(d),k=!1},d(g){g&&(h(e),h(p),h(m)),d&&d.d(g),$=!1,b()}}}const Jt=Object.freeze({id:"Uploaded",score:"Score",updated:"Updated"}),Qt=Object.freeze({desc:"codicon codicon-arrow-down",asc:"codicon codicon-arrow-up"}),Xt=Object.freeze({">=":"≥","<=":"≤"}),dt=Object.freeze({all:"All",safe:"Safe",questionable:"Questionable",explicit:"Explicit"}),xt=Object.freeze({id:{asc:"Oldest",desc:"Newest"},score:{asc:"Worst",desc:"Best"},updated:{asc:"Inactive",desc:"Active"}}),es=(n,e,s)=>{let t=n==="all"?void 0:dt[n],r=e===0&&s===">="?void 0:`Score${s}${Le(e)}`;return[t,r].filter(l=>l!==void 0).join(",")||"All"};function ts(n,e,s){let t,r,l;fe(n,ce,c=>s(1,l=c));const o=me();let a=!1;const i=()=>s(2,a=!0),f=()=>{s(2,a=!1),o("sortfilterupdate")},u=()=>{ce.reset(),s(0,p=l.scoreValue)};let p;function m(c){n.$$.not_equal(l.sortDirection,c)&&(l.sortDirection=c,ce.set(l))}function k(c){n.$$.not_equal(l.sortProperty,c)&&(l.sortProperty=c,ce.set(l))}function $(c){n.$$.not_equal(l.scoreComparator,c)&&(l.scoreComparator=c,ce.set(l))}function b(){p=it(this.value),s(0,p),s(1,l)}const d=c=>pt(c)&&c.target.blur();function g(c){n.$$.not_equal(l.rating,c)&&(l.rating=c,ce.set(l))}return n.$$.update=()=>{if(n.$$.dirty&3){p===void 0&&s(0,p=l.scoreValue);let c=Number(p);isNaN(c)||vt(ce,l.scoreValue=c,l)}n.$$.dirty&2&&s(4,t=es(l.rating,l.scoreValue,l.scoreComparator)),n.$$.dirty&2&&s(3,r=xt[l.sortProperty][l.sortDirection])},[p,l,a,r,t,i,f,u,m,k,$,b,d,g]}class ss extends oe{constructor(e){super(),ae(this,e,ts,Zt,le,{})}}function ns(n){const e=n.slice(),s=Lt(e[1].file_url,e[1].sample_url,e[1].preview_url);return e[6]=s,e}function rs(n){let e,s;return e=new mt({props:{post:n[1]}}),e.$on("click",n[3]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&2&&(l.post=t[1]),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function ls(n){let e,s;return e=new Rt({props:{src:n[6].animated,poster:n[6].static,width:n[1].width,height:n[1].height,loop:n[1].tags.some(Xe)}}),e.$on("click",n[3]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&2&&(l.src=t[6].animated),r&2&&(l.poster=t[6].static),r&2&&(l.width=t[1].width),r&2&&(l.height=t[1].height),r&2&&(l.loop=t[1].tags.some(Xe)),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function os(n){let e,s;return e=new At({props:{post:n[1],open:n[0]}}),e.$on("click",n[3]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&2&&(l.post=t[1]),r&1&&(l.open=t[0]),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function as(n){let e;return{c(){e=C("i"),this.h()},l(s){e=I(s,"I",{class:!0}),O(e).forEach(h),this.h()},h(){v(e,"class","codicon codicon-screen-full")},m(s,t){D(s,e,t)},p:G,d(s){s&&h(e)}}}function Qe(n){let e,s;return e=new _t({props:{post:n[1]}}),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&2&&(l.post=t[1]),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function is(n){let e,s,t,r,l,o,a,i,f,u;const p=[os,ls,rs],m=[];function k(d,g){return d[1].type==="image"?0:d[1].type==="video"?1:2}function $(d,g){return g===1?ns(d):d}s=k(n),t=m[s]=p[s]($(n,s)),l=new Be({props:{class:"button-fullscreen","aria-label":"Enter Fullscreen mode",$$slots:{default:[as]},$$scope:{ctx:n}}}),l.$on("click",n[4]);let b=n[0]&&Qe(n);return{c(){e=C("div"),t.c(),r=N(),R(l.$$.fragment),o=N(),b&&b.c(),this.h()},l(d){e=I(d,"DIV",{id:!0,class:!0});var g=O(e);t.l(g),r=T(g),A(l.$$.fragment,g),o=T(g),b&&b.l(g),g.forEach(h),this.h()},h(){v(e,"id",a="post_"+n[1].id),v(e,"class","post svelte-pwgq1f"),we(e,"open",n[0])},m(d,g){D(d,e,g),m[s].m(e,null),y(e,r),B(l,e,null),y(e,o),b&&b.m(e,null),i=!0,f||(u=re(e,"keydown",n[5]),f=!0)},p(d,[g]){let c=s;s=k(d),s===c?m[s].p($(d,s),g):(te(),S(m[c],1,1,()=>{m[c]=null}),se(),t=m[s],t?t.p($(d,s),g):(t=m[s]=p[s]($(d,s)),t.c()),E(t,1),t.m(e,r));const _={};g&128&&(_.$$scope={dirty:g,ctx:d}),l.$set(_),d[0]?b?(b.p(d,g),g&1&&E(b,1)):(b=Qe(d),b.c(),E(b,1),b.m(e,null)):b&&(te(),S(b,1,1,()=>{b=null}),se()),(!i||g&2&&a!==(a="post_"+d[1].id))&&v(e,"id",a),(!i||g&1)&&we(e,"open",d[0])},i(d){i||(E(t),E(l.$$.fragment,d),E(b),i=!0)},o(d){S(t),S(l.$$.fragment,d),S(b),i=!1},d(d){d&&h(e),m[s].d(),j(l),b&&b.d(),f=!1,u()}}}const Xe=n=>n.name==="loop";function cs(n,e,s){const t=me(),r=()=>s(0,o=!o);let{post:l}=e,{open:o=!1}=e;const a=()=>t("fullscreen"),i=f=>{f.key==="f"&&t("fullscreen")};return n.$$set=f=>{"post"in f&&s(1,l=f.post),"open"in f&&s(0,o=f.open)},[o,l,t,r,a,i]}class us extends oe{constructor(e){super(),ae(this,e,cs,is,le,{post:1,open:0})}}function xe(n){let e,s=n[0].type==="video"?"▶":"GIF",t;return{c(){e=C("span"),t=x(s),this.h()},l(r){e=I(r,"SPAN",{class:!0});var l=O(e);t=ee(l,s),l.forEach(h),this.h()},h(){v(e,"class","type svelte-14imjnt")},m(r,l){D(r,e,l),y(e,t)},p(r,l){l&1&&s!==(s=r[0].type==="video"?"▶":"GIF")&&Te(t,s)},d(r){r&&h(e)}}}function fs(n){let e,s,t,r,l,o=Le(n[0].score)+"",a,i,f,u,p,m=n[0].type!=="image"&&xe(n);return{c(){e=C("div"),s=C("img"),r=N(),l=C("span"),a=x(o),i=N(),m&&m.c(),this.h()},l(k){e=I(k,"DIV",{id:!0,class:!0,style:!0});var $=O(e);s=I($,"IMG",{src:!0,alt:!0,class:!0,tabindex:!0,loading:!0}),r=T($),l=I($,"SPAN",{class:!0});var b=O(l);a=ee(b,o),b.forEach(h),i=T($),m&&m.l($),$.forEach(h),this.h()},h(){pe(s.src,t=n[1])||v(s,"src",t),v(s,"alt","post"),v(s,"class","post-media svelte-14imjnt"),v(s,"tabindex","-1"),v(s,"loading","lazy"),v(l,"class","score svelte-14imjnt"),v(e,"id",f="post_"+n[0].id),v(e,"class","post svelte-14imjnt"),qe(e,"grid-row","span "+n[2]),we(e,"open",open)},m(k,$){D(k,e,$),y(e,s),y(e,r),y(e,l),y(l,a),y(e,i),m&&m.m(e,null),u||(p=[re(e,"click",n[3]),re(e,"keydown",n[4])],u=!0)},p(k,[$]){$&2&&!pe(s.src,t=k[1])&&v(s,"src",t),$&1&&o!==(o=Le(k[0].score)+"")&&Te(a,o),k[0].type!=="image"?m?m.p(k,$):(m=xe(k),m.c(),m.m(e,null)):m&&(m.d(1),m=null),$&1&&f!==(f="post_"+k[0].id)&&v(e,"id",f),$&0&&we(e,"open",open)},i:G,o:G,d(k){k&&h(e),m&&m.d(),u=!1,je(p)}}}function ps(n,e,s){let t,{post:r}=e,l=Math.min(Math.round(r.height/r.width*5),15);const o=f=>f.endsWith(".jpg")||f.endsWith(".jpeg")||f.endsWith(".png")||f.endsWith(".webp");function a(f){Ue.call(this,n,f)}const i=f=>{var u;(pt(f)||f.key==="f")&&((u=f.target)==null||u.click())};return n.$$set=f=>{"post"in f&&s(0,r=f.post)},n.$$.update=()=>{n.$$.dirty&1&&s(1,t=o(r.sample_url)?r.sample_url:r.preview_url)},[r,t,l,a,i]}class _s extends oe{constructor(e){super(),ae(this,e,ps,fs,le,{post:0})}}function ms(n){let e,s,t,r;const l=n[3].default,o=bt(l,n,n[2],null);return{c(){e=C("div"),o&&o.c(),this.h()},l(a){e=I(a,"DIV",{role:!0,tabindex:!0,class:!0});var i=O(e);o&&o.l(i),i.forEach(h),this.h()},h(){v(e,"role","none"),v(e,"tabindex","-1"),v(e,"class","dialog fullscreen svelte-1j44awz")},m(a,i){D(a,e,i),o&&o.m(e,null),n[5](e),s=!0,t||(r=[re(e,"keydown",n[4]),re(e,"click",kt(ds))],t=!0)},p(a,[i]){o&&o.p&&(!s||i&4)&&yt(o,l,a,a[2],s?Et(l,a[2],i,null):wt(a[2]),null)},i(a){s||(E(o,a),s=!0)},o(a){S(o,a),s=!1},d(a){a&&h(e),o&&o.d(a),n[5](null),t=!1,je(r)}}}const ds=()=>{};function gs(n,e,s){let{$$slots:t={},$$scope:r}=e;const l=me(),o=()=>l("close"),a=m=>{m.key==="Escape"&&o()};let i=()=>{document.fullscreenElement||o()},f;Fe(async()=>{f.focus(),document.addEventListener("keydown",a),document.addEventListener("fullscreenchange",i);try{await f.requestFullscreen()}catch{}}),Ve(async()=>{document.removeEventListener("keydown",a),document.removeEventListener("fullscreenchange",i);try{await document.exitFullscreen()}catch{}});const u=m=>{m.code==="Escape"&&o()};function p(m){be[m?"unshift":"push"](()=>{f=m,s(0,f)})}return n.$$set=m=>{"$$scope"in m&&s(2,r=m.$$scope)},[f,o,r,t,u,p]}class hs extends oe{constructor(e){super(),ae(this,e,gs,ms,le,{})}}function $s(n){let e,s;return e=new mt({props:{post:n[0]}}),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&1&&(l.post=t[0]),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function vs(n){let e,s;return{c(){e=C("video"),this.h()},l(t){e=I(t,"VIDEO",{class:!0,src:!0}),O(e).forEach(h),this.h()},h(){v(e,"class","post-media svelte-12glt11"),pe(e.src,s=n[0].file_url)||v(e,"src",s),e.controls=!0},m(t,r){D(t,e,r),n[5](e)},p(t,r){r&1&&!pe(e.src,s=t[0].file_url)&&v(e,"src",s)},i:G,o:G,d(t){t&&h(e),n[5](null)}}}function bs(n){let e,s,t,r,l;return{c(){e=C("img"),this.h()},l(o){e=I(o,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){v(e,"class","post-media svelte-12glt11"),pe(e.src,s=n[0].file_url)||v(e,"src",s),v(e,"alt",t="Image of Post "+n[0].id),we(e,"zoomed",n[1])},m(o,a){D(o,e,a),r||(l=re(e,"click",n[4]),r=!0)},p(o,a){a&1&&!pe(e.src,s=o[0].file_url)&&v(e,"src",s),a&1&&t!==(t="Image of Post "+o[0].id)&&v(e,"alt",t),a&2&&we(e,"zoomed",o[1])},i:G,o:G,d(o){o&&h(e),r=!1,l()}}}function ks(n){let e;return{c(){e=C("i"),this.h()},l(s){e=I(s,"I",{class:!0}),O(e).forEach(h),this.h()},h(){v(e,"class","codicon codicon-close")},m(s,t){D(s,e,t)},p:G,d(s){s&&h(e)}}}function ys(n){let e;return{c(){e=C("i"),this.h()},l(s){e=I(s,"I",{class:!0}),O(e).forEach(h),this.h()},h(){v(e,"class","codicon codicon-chevron-left")},m(s,t){D(s,e,t)},p:G,d(s){s&&h(e)}}}function ws(n){let e;return{c(){e=C("i"),this.h()},l(s){e=I(s,"I",{class:!0}),O(e).forEach(h),this.h()},h(){v(e,"class","codicon codicon-chevron-right")},m(s,t){D(s,e,t)},p:G,d(s){s&&h(e)}}}function Es(n){let e,s,t,r,l,o,a,i,f,u,p,m,k,$;const b=[bs,vs,$s],d=[];function g(c,_){return c[0].type==="image"?0:c[0].type==="video"?1:2}return s=g(n),t=d[s]=b[s](n),a=new _t({props:{post:n[0]}}),f=new Be({props:{class:"button-close",$$slots:{default:[ks]},$$scope:{ctx:n}}}),f.$on("click",n[6]),p=new Be({props:{class:"button-previous",$$slots:{default:[ys]},$$scope:{ctx:n}}}),p.$on("click",n[7]),k=new Be({props:{class:"button-next",$$slots:{default:[ws]},$$scope:{ctx:n}}}),k.$on("click",n[8]),{c(){e=C("div"),t.c(),r=N(),l=C("i"),o=N(),R(a.$$.fragment),i=N(),R(f.$$.fragment),u=N(),R(p.$$.fragment),m=N(),R(k.$$.fragment),this.h()},l(c){e=I(c,"DIV",{class:!0});var _=O(e);t.l(_),r=T(_),l=I(_,"I",{class:!0}),O(l).forEach(h),_.forEach(h),o=T(c),A(a.$$.fragment,c),i=T(c),A(f.$$.fragment,c),u=T(c),A(p.$$.fragment,c),m=T(c),A(k.$$.fragment,c),this.h()},h(){v(l,"class","codicon codicon-chevron-down svelte-12glt11"),v(e,"class","svelte-12glt11")},m(c,_){D(c,e,_),d[s].m(e,null),y(e,r),y(e,l),D(c,o,_),B(a,c,_),D(c,i,_),B(f,c,_),D(c,u,_),B(p,c,_),D(c,m,_),B(k,c,_),$=!0},p(c,_){let P=s;s=g(c),s===P?d[s].p(c,_):(te(),S(d[P],1,1,()=>{d[P]=null}),se(),t=d[s],t?t.p(c,_):(t=d[s]=b[s](c),t.c()),E(t,1),t.m(e,r));const W={};_&1&&(W.post=c[0]),a.$set(W);const Q={};_&2048&&(Q.$$scope={dirty:_,ctx:c}),f.$set(Q);const H={};_&2048&&(H.$$scope={dirty:_,ctx:c}),p.$set(H);const K={};_&2048&&(K.$$scope={dirty:_,ctx:c}),k.$set(K)},i(c){$||(E(t),E(a.$$.fragment,c),E(f.$$.fragment,c),E(p.$$.fragment,c),E(k.$$.fragment,c),$=!0)},o(c){S(t),S(a.$$.fragment,c),S(f.$$.fragment,c),S(p.$$.fragment,c),S(k.$$.fragment,c),$=!1},d(c){c&&(h(e),h(o),h(i),h(u),h(m)),d[s].d(),j(a,c),j(f,c),j(p,c),j(k,c)}}}function Ss(n){let e,s;return e=new hs({props:{$$slots:{default:[Es]},$$scope:{ctx:n}}}),e.$on("close",n[9]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,[r]){const l={};r&2055&&(l.$$scope={dirty:r,ctx:t}),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Cs(n,e,s){const t=me(),r=$=>{if($.key==="f"&&($.preventDefault(),$.stopPropagation(),t("close")),$.key==="ArrowLeft"&&($.preventDefault(),$.stopPropagation(),t("previous")),$.key==="ArrowRight"&&($.preventDefault(),$.stopPropagation(),t("next")),$.key===" "||$.key==="k"){$.preventDefault(),$.stopPropagation(),a&&(a.paused?a.play():a.pause());const b=document.querySelector(".fullscreen.circle");b&&b.click()}a&&($.key==="j"?s(2,a.currentTime=Math.max(0,a.currentTime-5),a):$.key==="l"&&s(2,a.currentTime=Math.min(a.duration,a.currentTime+5),a))};let{post:l}=e,o=l.width/l.height<.33,a;Fe(()=>{document.addEventListener("keydown",r)}),Ve(()=>document.removeEventListener("keydown",r));const i=()=>s(1,o=!o);function f($){be[$?"unshift":"push"](()=>{a=$,s(2,a)})}const u=()=>t("close"),p=()=>t("previous"),m=()=>t("next");function k($){Ue.call(this,n,$)}return n.$$set=$=>{"post"in $&&s(0,l=$.post)},[l,o,a,t,i,f,u,p,m,k]}class Is extends oe{constructor(e){super(),ae(this,e,Cs,Ss,le,{post:0})}}function et(n,e,s){const t=n.slice();return t[12]=e[s],t[14]=s,t}function tt(n,e,s){const t=n.slice();return t[12]=e[s],t[14]=s,t}function Ps(n){let e,s,t=Ee(n[2].posts),r=[];for(let o=0;o<t.length;o+=1)r[o]=st(et(n,t,o));const l=o=>S(r[o],1,1,()=>{r[o]=null});return{c(){e=C("section");for(let o=0;o<r.length;o+=1)r[o].c();this.h()},l(o){e=I(o,"SECTION",{class:!0,style:!0});var a=O(e);for(let i=0;i<r.length;i+=1)r[i].l(a);a.forEach(h),this.h()},h(){v(e,"class","multi svelte-q6spg0"),qe(e,"grid-template-columns","repeat("+n[3]+", 1fr)")},m(o,a){D(o,e,a);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null);s=!0},p(o,a){if(a&5){t=Ee(o[2].posts);let i;for(i=0;i<t.length;i+=1){const f=et(o,t,i);r[i]?(r[i].p(f,a),E(r[i],1)):(r[i]=st(f),r[i].c(),E(r[i],1),r[i].m(e,null))}for(te(),i=t.length;i<r.length;i+=1)l(i);se()}(!s||a&8)&&qe(e,"grid-template-columns","repeat("+o[3]+", 1fr)")},i(o){if(!s){for(let a=0;a<t.length;a+=1)E(r[a]);s=!0}},o(o){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);s=!1},d(o){o&&h(e),ze(r,o)}}}function Ds(n){let e,s,t=Ee(n[2].posts),r=[];for(let o=0;o<t.length;o+=1)r[o]=nt(tt(n,t,o));const l=o=>S(r[o],1,1,()=>{r[o]=null});return{c(){e=C("section");for(let o=0;o<r.length;o+=1)r[o].c();this.h()},l(o){e=I(o,"SECTION",{class:!0});var a=O(e);for(let i=0;i<r.length;i+=1)r[i].l(a);a.forEach(h),this.h()},h(){v(e,"class","single svelte-q6spg0")},m(o,a){D(o,e,a);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null);s=!0},p(o,a){if(a&5){t=Ee(o[2].posts);let i;for(i=0;i<t.length;i+=1){const f=tt(o,t,i);r[i]?(r[i].p(f,a),E(r[i],1)):(r[i]=nt(f),r[i].c(),E(r[i],1),r[i].m(e,null))}for(te(),i=t.length;i<r.length;i+=1)l(i);se()}},i(o){if(!s){for(let a=0;a<t.length;a+=1)E(r[a]);s=!0}},o(o){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);s=!1},d(o){o&&h(e),ze(r,o)}}}function st(n){let e,s;function t(){return n[7](n[12],n[14])}return e=new _s({props:{post:n[12]}}),e.$on("click",t),{c(){R(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,l){B(e,r,l),s=!0},p(r,l){n=r;const o={};l&4&&(o.post=n[12]),e.$set(o)},i(r){s||(E(e.$$.fragment,r),s=!0)},o(r){S(e.$$.fragment,r),s=!1},d(r){j(e,r)}}}function nt(n){let e,s;function t(){return n[6](n[12],n[14])}return e=new us({props:{post:n[12]}}),e.$on("fullscreen",t),{c(){R(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,l){B(e,r,l),s=!0},p(r,l){n=r;const o={};l&4&&(o.post=n[12]),e.$set(o)},i(r){s||(E(e.$$.fragment,r),s=!0)},o(r){S(e.$$.fragment,r),s=!1},d(r){j(e,r)}}}function rt(n){let e,s;return e=new Is({props:{post:n[0].post}}),e.$on("close",n[8]),e.$on("previous",n[9]),e.$on("next",n[10]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&1&&(l.post=t[0].post),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Ns(n){let e,s,t=Le(n[2].postCount)+"",r,l,o,a,i,f,u,p,m,k;a=new ss({}),a.$on("sortfilterupdate",n[5]);const $=[Ds,Ps],b=[];function d(c,_){return c[3]==="1"?0:1}f=d(n),u=b[f]=$[f](n);let g=n[1]&&n[0]!==void 0&&rt(n);return{c(){e=C("div"),s=C("span"),r=x(t),l=x(" posts"),o=N(),R(a.$$.fragment),i=N(),u.c(),p=N(),g&&g.c(),m=_e(),this.h()},l(c){e=I(c,"DIV",{class:!0});var _=O(e);s=I(_,"SPAN",{});var P=O(s);r=ee(P,t),l=ee(P," posts"),P.forEach(h),o=T(_),A(a.$$.fragment,_),_.forEach(h),i=T(c),u.l(c),p=T(c),g&&g.l(c),m=_e(),this.h()},h(){v(e,"class","svelte-q6spg0")},m(c,_){D(c,e,_),y(e,s),y(s,r),y(s,l),y(e,o),B(a,e,null),D(c,i,_),b[f].m(c,_),D(c,p,_),g&&g.m(c,_),D(c,m,_),k=!0},p(c,[_]){(!k||_&4)&&t!==(t=Le(c[2].postCount)+"")&&Te(r,t);let P=f;f=d(c),f===P?b[f].p(c,_):(te(),S(b[P],1,1,()=>{b[P]=null}),se(),u=b[f],u?u.p(c,_):(u=b[f]=$[f](c),u.c()),E(u,1),u.m(p.parentNode,p)),c[1]&&c[0]!==void 0?g?(g.p(c,_),_&3&&E(g,1)):(g=rt(c),g.c(),E(g,1),g.m(m.parentNode,m)):g&&(te(),S(g,1,1,()=>{g=null}),se())},i(c){k||(E(a.$$.fragment,c),E(u),E(g),k=!0)},o(c){S(a.$$.fragment,c),S(u),S(g),k=!1},d(c){c&&(h(e),h(i),h(p),h(m)),j(a),b[f].d(c),g&&g.d(c)}}}function Ts(n,e,s){let t,r;fe(n,Ne,b=>s(2,t=b)),fe(n,Ot,b=>s(3,r=b));const l=me(),o=()=>{s(1,i=location.hash.length>2)};let a,i=location.hash.length>2;Fe(()=>{window.addEventListener("hashchange",o)}),Ve(()=>{window.removeEventListener("hashchange",o)});function f(b){Ue.call(this,n,b)}return[a,i,t,r,l,f,(b,d)=>{s(0,a={post:b,index:d}),location.hash="fullscreen"},(b,d)=>{s(0,a={post:b,index:d}),location.hash="fullscreen"},()=>{var b,d;(b=a==null?void 0:a.post)!=null&&b.id&&((d=document.querySelector(`#post_${a.post.id} .post-media`))==null||d.focus()),s(0,a=void 0),history.back()},()=>{let b=Math.max(a.index-1,0);s(0,a={index:b,post:t.posts[b]})},()=>{let b=Math.min(a.index+1,t.posts.length);s(0,a={index:b,post:t.posts[b]}),b>t.posts.length-3&&t.posts.length!==t.postCount&&l("endreached")}]}class Os extends oe{constructor(e){super(),ae(this,e,Ts,Ns,le,{})}}function Ls(n){let e;return{c(){e=C("div")},l(s){e=I(s,"DIV",{}),O(e).forEach(h)},m(s,t){D(s,e,t),n[2](e)},p:G,i:G,o:G,d(s){s&&h(e),n[2](null)}}}function Rs(n,e,s){let{rootMargin:t}=e;const r=me(),l=new IntersectionObserver(i=>{i[0].isIntersecting&&r("intersection")},{rootMargin:t});let o;function a(i){be[i?"unshift":"push"](()=>{o=i,s(0,o)})}return n.$$set=i=>{"rootMargin"in i&&s(1,t=i.rootMargin)},n.$$.update=()=>{n.$$.dirty&1&&(l.disconnect(),o&&l.observe(o))},[o,t,a]}class As extends oe{constructor(e){super(),ae(this,e,Rs,Ls,le,{rootMargin:1})}}function Bs(n){let e,s,t,r,l="You have seen everything there is to see...";return{c(){e=C("img"),t=N(),r=C("p"),r.textContent=l,this.h()},l(o){e=I(o,"IMG",{src:!0,alt:!0,class:!0}),t=T(o),r=I(o,"P",{"data-svelte-h":!0}),ue(r)!=="svelte-1i75mtf"&&(r.textContent=l),this.h()},h(){pe(e.src,s=ut+"/assets/shironeko-x.png")||v(e,"src",s),v(e,"alt","No more results to load"),v(e,"class","svelte-1pkma0d")},m(o,a){D(o,e,a),D(o,t,a),D(o,r,a)},p:G,i:G,o:G,d(o){o&&(h(e),h(t),h(r))}}}class js extends oe{constructor(e){super(),ae(this,e,null,Bs,le,{})}}function lt(n,e,s){const t=n.slice();return t[9]=e[s],t}function ot(n){let e,s;return e=new Vt({props:{tag:n[9]}}),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&4&&(l.tag=t[9]),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Fs(n){let e;return{c(){e=x("Create supertag")},l(s){e=ee(s,"Create supertag")},m(s,t){D(s,e,t)},d(s){s&&h(e)}}}function Vs(n){let e,s,t="Create Supertag",r,l,o,a,i,f="Name",u,p,m,k,$,b="Description",d,g,c,_,P,W="Tags",Q,H,K,ie,w,U,J,Z,X=Ee(n[2]),M=[];for(let F=0;F<X.length;F+=1)M[F]=ot(lt(n,X,F));const Se=F=>S(M[F],1,1,()=>{M[F]=null});return w=new Oe({props:{title:n[3]?"Click to create supertag":"Enter a valid name to continue",disabled:!n[3],$$slots:{default:[Fs]},$$scope:{ctx:n}}}),w.$on("click",n[8]),{c(){e=C("section"),s=C("h3"),s.textContent=t,r=N(),l=C("button"),o=N(),a=C("div"),i=C("label"),i.textContent=f,u=N(),p=C("input"),m=N(),k=C("div"),$=C("label"),$.textContent=b,d=N(),g=C("input"),c=N(),_=C("div"),P=C("span"),P.textContent=W,Q=N(),H=C("ol");for(let F=0;F<M.length;F+=1)M[F].c();K=N(),ie=C("div"),R(w.$$.fragment),this.h()},l(F){e=I(F,"SECTION",{class:!0});var L=O(e);s=I(L,"H3",{"data-svelte-h":!0}),ue(s)!=="svelte-ho1cwx"&&(s.textContent=t),r=T(L),l=I(L,"BUTTON",{class:!0}),O(l).forEach(h),o=T(L),a=I(L,"DIV",{class:!0});var Y=O(a);i=I(Y,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ue(i)!=="svelte-10k8a68"&&(i.textContent=f),u=T(Y),p=I(Y,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),Y.forEach(h),m=T(L),k=I(L,"DIV",{class:!0});var q=O(k);$=I(q,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ue($)!=="svelte-14n9kp6"&&($.textContent=b),d=T(q),g=I(q,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),q.forEach(h),c=T(L),_=I(L,"DIV",{class:!0});var ne=O(_);P=I(ne,"SPAN",{class:!0,"data-svelte-h":!0}),ue(P)!=="svelte-7hjyox"&&(P.textContent=W),Q=T(ne),H=I(ne,"OL",{class:!0});var ke=O(H);for(let Ie=0;Ie<M.length;Ie+=1)M[Ie].l(ke);ke.forEach(h),ne.forEach(h),K=T(L),ie=I(L,"DIV",{class:!0});var Ce=O(ie);A(w.$$.fragment,Ce),Ce.forEach(h),L.forEach(h),this.h()},h(){v(l,"class",ct("codicon codicon-close")+" svelte-xkjm86"),v(i,"for","supertag-name"),v(i,"class","svelte-xkjm86"),v(p,"type","text"),v(p,"placeholder","Descriptive name"),v(p,"id","supertag-name"),v(p,"class","svelte-xkjm86"),v(a,"class","svelte-xkjm86"),v($,"for","supertag-description"),v($,"class","svelte-xkjm86"),v(g,"type","text"),v(g,"placeholder","Short description"),v(g,"id","supertag-description"),v(g,"class","svelte-xkjm86"),v(k,"class","svelte-xkjm86"),v(P,"class","svelte-xkjm86"),v(H,"class","svelte-xkjm86"),v(_,"class","svelte-xkjm86"),v(ie,"class","last svelte-xkjm86"),v(e,"class","svelte-xkjm86")},m(F,L){D(F,e,L),y(e,s),y(e,r),y(e,l),y(e,o),y(e,a),y(a,i),y(a,u),y(a,p),ye(p,n[0]),y(e,m),y(e,k),y(k,$),y(k,d),y(k,g),ye(g,n[1]),y(e,c),y(e,_),y(_,P),y(_,Q),y(_,H);for(let Y=0;Y<M.length;Y+=1)M[Y]&&M[Y].m(H,null);y(e,K),y(e,ie),B(w,ie,null),U=!0,J||(Z=[re(l,"click",n[5]),re(p,"input",n[6]),re(g,"input",n[7])],J=!0)},p(F,L){if(L&1&&p.value!==F[0]&&ye(p,F[0]),L&2&&g.value!==F[1]&&ye(g,F[1]),L&4){X=Ee(F[2]);let q;for(q=0;q<X.length;q+=1){const ne=lt(F,X,q);M[q]?(M[q].p(ne,L),E(M[q],1)):(M[q]=ot(ne),M[q].c(),E(M[q],1),M[q].m(H,null))}for(te(),q=X.length;q<M.length;q+=1)Se(q);se()}const Y={};L&8&&(Y.title=F[3]?"Click to create supertag":"Enter a valid name to continue"),L&8&&(Y.disabled=!F[3]),L&4096&&(Y.$$scope={dirty:L,ctx:F}),w.$set(Y)},i(F){if(!U){for(let L=0;L<X.length;L+=1)E(M[L]);E(w.$$.fragment,F),U=!0}},o(F){M=M.filter(Boolean);for(let L=0;L<M.length;L+=1)S(M[L]);S(w.$$.fragment,F),U=!1},d(F){F&&h(e),ze(M,F),j(w),J=!1,je(Z)}}}function Ms(n){let e,s;return e=new ft({props:{$$slots:{default:[Vs]},$$scope:{ctx:n}}}),e.$on("close",n[5]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,[r]){const l={};r&4111&&(l.$$scope={dirty:r,ctx:t}),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function qs(n,e,s){let t,{name:r=""}=e,{description:l=""}=e,{tags:o}=e;const a=me(),i=()=>a("close");function f(){r=this.value,s(0,r)}function u(){l=this.value,s(1,l)}const p=()=>{a("submit",{name:r,description:l,tags:o.map(({modifier:m,name:k})=>({modifier:m,name:k}))}),i()};return n.$$set=m=>{"name"in m&&s(0,r=m.name),"description"in m&&s(1,l=m.description),"tags"in m&&s(2,o=m.tags)},n.$$.update=()=>{n.$$.dirty&5&&s(3,t=typeof r=="string"&&r!==""&&o.length>1)},[r,l,o,t,a,i,f,u,p]}class Us extends oe{constructor(e){super(),ae(this,e,qs,Ms,le,{name:0,description:1,tags:2})}}function zs(n){let e,s,t,r,l,o,a,i,f,u;return{c(){e=C("div"),s=C("div"),t=C("i"),r=N(),l=C("div"),o=C("h3"),a=x(n[0]),i=N(),f=C("span"),u=x(n[2]),this.h()},l(p){e=I(p,"DIV",{class:!0});var m=O(e);s=I(m,"DIV",{class:!0});var k=O(s);t=I(k,"I",{class:!0}),O(t).forEach(h),k.forEach(h),r=T(m),l=I(m,"DIV",{});var $=O(l);o=I($,"H3",{class:!0});var b=O(o);a=ee(b,n[0]),b.forEach(h),i=T($),f=I($,"SPAN",{});var d=O(f);u=ee(d,n[2]),d.forEach(h),$.forEach(h),m.forEach(h),this.h()},h(){v(t,"class",ct(n[1])+" svelte-1tvgln1"),v(s,"class","icon svelte-1tvgln1"),v(o,"class","svelte-1tvgln1"),v(e,"class","error svelte-1tvgln1")},m(p,m){D(p,e,m),y(e,s),y(s,t),y(e,r),y(e,l),y(l,o),y(o,a),y(l,i),y(l,f),y(f,u)},p:G,i:G,o:G,d(p){p&&h(e)}}}function Gs(n,e,s){let{error:t}=e,r=t.message==="Failed to fetch"?"Connection Error":"Application Error",l=t.message==="Failed to fetch"?"codicon codicon-debug-disconnect":"codicon codicon-error",o=t.message==="Failed to fetch"?"Failed to connect to the server. Make sure you have a stable internet connection.":t.message;return n.$$set=a=>{"error"in a&&s(3,t=a.error)},[r,l,o,t]}class Ks extends oe{constructor(e){super(),ae(this,e,Gs,zs,le,{error:3})}}function Ws(n){let e;return{c(){e=x("Search")},l(s){e=ee(s,"Search")},m(s,t){D(s,e,t)},d(s){s&&h(e)}}}function Hs(n){let e,s,t,r,l,o;const a=[Js,Zs],i=[];function f(u,p){return u[2].postCount===0?0:1}return s=f(n),t=i[s]=a[s](n),l=new Mt({}),{c(){e=C("section"),t.c(),r=N(),R(l.$$.fragment),this.h()},l(u){e=I(u,"SECTION",{class:!0});var p=O(e);t.l(p),p.forEach(h),r=T(u),A(l.$$.fragment,u),this.h()},h(){v(e,"class","svelte-rk0y4a")},m(u,p){D(u,e,p),i[s].m(e,null),D(u,r,p),B(l,u,p),o=!0},p(u,p){let m=s;s=f(u),s===m?i[s].p(u,p):(te(),S(i[m],1,1,()=>{i[m]=null}),se(),t=i[s],t?t.p(u,p):(t=i[s]=a[s](u),t.c()),E(t,1),t.m(e,null))},i(u){o||(E(t),E(l.$$.fragment,u),o=!0)},o(u){S(t),S(l.$$.fragment,u),o=!1},d(u){u&&(h(e),h(r)),i[s].d(),j(l,u)}}}function Ys(n){let e,s;return e=new Ks({props:{error:n[0]}}),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&1&&(l.error=t[0]),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Zs(n){let e,s,t,r,l,o;e=new Os({}),e.$on("sortfilterupdate",n[7]),e.$on("endreached",n[8]);const a=[Xs,Qs],i=[];function f(u,p){return u[2].posts.length===u[2].postCount?0:1}return t=f(n),r=i[t]=a[t](n),{c(){R(e.$$.fragment),s=N(),r.c(),l=_e()},l(u){A(e.$$.fragment,u),s=T(u),r.l(u),l=_e()},m(u,p){B(e,u,p),D(u,s,p),i[t].m(u,p),D(u,l,p),o=!0},p(u,p){let m=t;t=f(u),t===m?i[t].p(u,p):(te(),S(i[m],1,1,()=>{i[m]=null}),se(),r=i[t],r?r.p(u,p):(r=i[t]=a[t](u),r.c()),E(r,1),r.m(l.parentNode,l))},i(u){o||(E(e.$$.fragment,u),E(r),o=!0)},o(u){S(e.$$.fragment,u),S(r),o=!1},d(u){u&&(h(s),h(l)),j(e,u),i[t].d(u)}}}function Js(n){let e,s;return e=new Kt({}),e.$on("sortfilterupdate",n[7]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p:G,i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Qs(n){let e,s;return e=new As({props:{rootMargin:"1000px"}}),e.$on("intersection",n[8]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p:G,i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Xs(n){let e,s;return e=new js({}),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p:G,i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function at(n){let e,s;return e=new Us({props:{tags:n[4]}}),e.$on("close",n[13]),e.$on("submit",n[14]),{c(){R(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const l={};r&16&&(l.tags=t[4]),e.$set(l)},i(t){s||(E(e.$$.fragment,t),s=!0)},o(t){S(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function xs(n){let e,s,t,r,l,o,a,i,f,u,p,m,k,$;s=new St({}),r=new Pt({props:{placeholder:"Search for tags",fetchSuggestions:n[6]}}),r.$on("pick",n[9]),o=new Oe({props:{title:"Search with the tags above",$$slots:{default:[Ws]},$$scope:{ctx:n}}}),o.$on("click",n[7]),i=new Ct({props:{tags:[...n[4],...n[3]]}}),i.$on("click",n[10]),i.$on("contextmenu",n[11]),i.$on("createSupertag",n[12]);const b=[Ys,Hs],d=[];function g(_,P){return _[0]?0:_[2].requested?1:-1}~(u=g(n))&&(p=d[u]=b[u](n));let c=n[1]&&at(n);return{c(){e=C("section"),R(s.$$.fragment),t=N(),R(r.$$.fragment),l=N(),R(o.$$.fragment),a=N(),R(i.$$.fragment),f=N(),p&&p.c(),m=N(),c&&c.c(),k=_e(),this.h()},l(_){e=I(_,"SECTION",{id:!0,class:!0});var P=O(e);A(s.$$.fragment,P),t=T(P),A(r.$$.fragment,P),l=T(P),A(o.$$.fragment,P),a=T(P),A(i.$$.fragment,P),P.forEach(h),f=T(_),p&&p.l(_),m=T(_),c&&c.l(_),k=_e(),this.h()},h(){v(e,"id","search"),v(e,"class","svelte-rk0y4a")},m(_,P){D(_,e,P),B(s,e,null),y(e,t),B(r,e,null),y(e,l),B(o,e,null),y(e,a),B(i,e,null),D(_,f,P),~u&&d[u].m(_,P),D(_,m,P),c&&c.m(_,P),D(_,k,P),$=!0},p(_,[P]){const W={};P&8388608&&(W.$$scope={dirty:P,ctx:_}),o.$set(W);const Q={};P&24&&(Q.tags=[..._[4],..._[3]]),i.$set(Q);let H=u;u=g(_),u===H?~u&&d[u].p(_,P):(p&&(te(),S(d[H],1,1,()=>{d[H]=null}),se()),~u?(p=d[u],p?p.p(_,P):(p=d[u]=b[u](_),p.c()),E(p,1),p.m(m.parentNode,m)):p=null),_[1]?c?(c.p(_,P),P&2&&E(c,1)):(c=at(_),c.c(),E(c,1),c.m(k.parentNode,k)):c&&(te(),S(c,1,1,()=>{c=null}),se())},i(_){$||(E(s.$$.fragment,_),E(r.$$.fragment,_),E(o.$$.fragment,_),E(i.$$.fragment,_),E(p),E(c),$=!0)},o(_){S(s.$$.fragment,_),S(r.$$.fragment,_),S(o.$$.fragment,_),S(i.$$.fragment,_),S(p),S(c),$=!1},d(_){_&&(h(e),h(f),h(m),h(k)),j(s),j(r),j(o),j(i),~u&&d[u].d(_),c&&c.d(_)}}}const en=()=>{const n=new URL(location.href),e=sn(n),s=nn(n),t=rn(n);return{tags:e,sort:s,filter:t}},tn=(n,e)=>{let s=!1;const{tags:t,sort:r,filter:l}=en();return t&&(t.forEach(o=>n.addByName(o)),s=!0),r&&(e.update({sortProperty:r.property,sortDirection:r.direction}),s=!0),l&&(e.update(l),s=!0),s},sn=n=>{if(!n.searchParams.has("tags"))return;const s=(n.searchParams.get("tags")??"").split(";");if(!(!Array.isArray(s)||s.length===0))return s},nn=n=>{try{if(!n.searchParams.has("sort"))return;const e=n.searchParams.get("sort")??"",[s,t]=e.split(":");return{property:s,direction:t}}catch{console.warn("Invalid sort provided in url");return}},rn=n=>{try{if(!n.searchParams.has("filter"))return;const s=(n.searchParams.get("filter")??"").split(";");let t={};return s.forEach(r=>{if(r.startsWith("rating:")){const[,l]=r.split(":");l!=="all"&&(t.rating=l)}if(r.startsWith("score")){const l=r.match(/score(.*)(\d+)/);if(l){const[,o,a]=l;t.scoreComparator=o;const i=Number(a);i&&(t.scoreValue=i)}}}),t}catch{console.warn("Invalid sort provided in url");return}};function ln(n,e,s){let t,r,l,o,a,i;fe(n,Ne,w=>s(2,t=w)),fe(n,Me,w=>s(3,r=w)),fe(n,ce,w=>s(17,l=w)),fe(n,Ft,w=>s(18,o=w)),fe(n,De,w=>s(4,a=w)),fe(n,Ye,w=>s(5,i=w));let f=!1,u,p=!1,m=0;const k=async w=>{const U=await Nt(w);return[...i.items.filter(({name:Z})=>Z.toLowerCase().includes(w.toLowerCase())).map(Z=>({label:Z.name,count:Z.tags.length,type:"supertag"})),...U]},$=tn(De,ce),b=()=>new It().withPid(t.pageCount).withTags(a).withBlockedContent(o).withSortProperty(l.sortProperty).withSortDirection(l.sortDirection).withScoreValue(l.scoreValue).withScoreComparator(l.scoreComparator).withRating(l.rating).withSupertags(r),d=async w=>{if(!f){s(0,u=void 0),f=!0;try{const U=t.pageCount;await w(),qt(U).catch(()=>{})}catch(U){s(0,u=U),console.warn(U)}finally{f=!1}}},g=async()=>{Ne.reset(),m=0,d(async()=>{const[w,U]=await b().getPageAndCount();console.log(w,U),Ne.addPage(w,U)})},c=async()=>{d(async()=>{const w=await b().getPage();Ne.addPage(w)})},_=w=>{var U,J;if((w.key==="/"||w.key==="s")&&(!document.activeElement||document.activeElement===document.body)&&((U=document.getElementById("searchbar"))==null||U.focus(),w.preventDefault(),w.stopPropagation()),w.ctrlKey&&w.key==="Enter"&&(w.preventDefault(),w.stopPropagation(),g()),w.ctrlKey&&w.key==="m"&&((J=document.getElementById("select-modifier"))==null||J.click()),w.ctrlKey&&w.key==="ArrowDown"){const Z=document.getElementsByClassName("post-media");Z[m].focus(),m=Math.min(m+1,Math.max(0,Z.length-1))}w.ctrlKey&&w.key==="ArrowUp"&&(document.getElementsByClassName("post-media")[m].focus(),m=Math.max(m-1,0))};return Fe(()=>{document.addEventListener("keydown",_),$&&g()}),Ve(()=>{document.removeEventListener("keydown",_)}),[u,p,t,r,a,i,k,g,c,async w=>{const U=w.detail;if(U.type==="supertag"){const J=i.items.find(Z=>Z.name===U.label);if(!J){console.log("Supertag not present.");return}Me.addOrReplace(J)}else{const J=await Tt(w.detail.label);De.addOrReplace({name:w.detail.label,modifier:w.detail.modifier,count:w.detail.count,type:J.type})}},w=>"description"in w.detail?Me.removeByName(w.detail.name):De.removeByName(w.detail.name),w=>{"description"in w.detail||(w.detail.modifier=Dt(w.detail.modifier),De.addOrReplace(w.detail))},()=>s(1,p=!0),()=>s(1,p=!1),w=>Ye.add(w.detail)]}class Cn extends oe{constructor(e){super(),ae(this,e,ln,xs,le,{})}}export{Cn as component};
