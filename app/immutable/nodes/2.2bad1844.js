import{s as le,f as I,a as O,g as D,c as R,y as ce,D as fe,j as k,i as T,d as m,E as _e,l as te,m as se,e as pe,h as j,u as y,F as re,n as Oe,C as ae,G as kt,p as we,H as Se,I as je,J as ft,K as Ae,L as Ee,v as K,k as ze,M as qe,w as wt,N as yt,z as St,A as Et,B as Ct,o as Be,O as Me,P as Ge,r as pt}from"../chunks/scheduler.88299003.js";import{S as oe,i as ie,b as F,d as A,m as B,a as S,t as E,e as M,g as x,c as ee,f as Le}from"../chunks/index.15b414ac.js";import{a as Pe}from"../chunks/posts.e3ad19e2.js";import{s as ue,f as ke,r as Te,K as It,A as Dt,a as Ue,S as Nt}from"../chunks/search-builder.294e378f.js";import{S as Pt,n as Tt,s as Je}from"../chunks/supertags-store.d9b4936e.js";import{T as Re}from"../chunks/TextButton.2f318c50.js";import{g as Ot,a as Rt}from"../chunks/tags.58927cde.js";import{b as _t}from"../chunks/paths.befef072.js";import{e as Ce}from"../chunks/each.e59479a4.js";import{D as He,r as Vt}from"../chunks/Dialog.1398ea51.js";import{i as dt,D as gt,g as jt,G as mt,V as Lt,I as Ft}from"../chunks/Details.3ea541fd.js";import{f as Ve}from"../chunks/format-tag.d6c065e3.js";import{R as At,I as Fe}from"../chunks/ModifierSelect.623aacd6.js";import{S as Qe}from"../chunks/Select.22805bc7.js";import{R as Bt}from"../chunks/RotatingTextSelect.7e32facf.js";import{b as Mt}from"../chunks/blocked-content-store.8cb9d99a.js";import{D as Ut}from"../chunks/DetailedTag.28ff9b0d.js";import{S as zt}from"../chunks/ScrollUpButton.cfa21b3f.js";import{l as qt}from"../chunks/analytics.eca95ce1.js";import{H as Gt}from"../chunks/Heading3.581258ce.js";function Ht(n){let e;return{c(){e=te("Reset Filter")},l(s){e=se(s,"Reset Filter")},m(s,t){T(s,e,t)},d(s){s&&m(e)}}}function Kt(n){let e,s,t,r,o="We couldn't find any posts matching your tags. Sorry...",l,i,a;return i=new Re({props:{title:"In case your filter caused all posts to vanish. Reset it.",$$slots:{default:[Ht]},$$scope:{ctx:n}}}),i.$on("click",n[1]),{c(){e=I("img"),t=O(),r=I("p"),r.textContent=o,l=O(),F(i.$$.fragment),this.h()},l(c){e=D(c,"IMG",{src:!0,alt:!0,class:!0}),t=R(c),r=D(c,"P",{"data-svelte-h":!0}),ce(r)!=="svelte-1utxj3w"&&(r.textContent=o),l=R(c),A(i.$$.fragment,c),this.h()},h(){fe(e.src,s=_t+"/assets/shironeko-confused.png")||k(e,"src",s),k(e,"alt","Nothing here..."),k(e,"class","svelte-1bb5e7g")},m(c,u){T(c,e,u),T(c,t,u),T(c,r,u),T(c,l,u),B(i,c,u),a=!0},p(c,[u]){const _={};u&4&&(_.$$scope={dirty:u,ctx:c}),i.$set(_)},i(c){a||(S(i.$$.fragment,c),a=!0)},o(c){E(i.$$.fragment,c),a=!1},d(c){c&&(m(e),m(t),m(r),m(l)),M(i,c)}}}function Wt(n){const e=_e();return[e,()=>{ue.reset(),ue.reset(),e("sortfilterupdate")}]}class Yt extends oe{constructor(e){super(),ie(this,e,Wt,Kt,le,{})}}function Xe(n){let e,s;return e=new He({props:{$$slots:{default:[Qt]},$$scope:{ctx:n}}}),e.$on("close",n[7]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&65543&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function Zt(n){let e;return{c(){e=te("Done")},l(s){e=se(s,"Done")},m(s,t){T(s,e,t)},d(s){s&&m(e)}}}function Jt(n){let e;return{c(){e=te("Reset")},l(s){e=se(s,"Reset")},m(s,t){T(s,e,t)},d(s){s&&m(e)}}}function Qt(n){let e,s,t="Sorting and Filtering",r,o,l,i="Sorting",a,c,u,_,d,b,h,w,v,g,f="Filtering by Score",p,N,C,L,Y,q,J,Z,ne,de="Filtering by Rating",ge,Q,$,H,V,P,W,z,X,ye,Ie;function De(U){n[10](U)}let Ke={options:es};n[1].direction!==void 0&&(Ke.value=n[1].direction),u=new At({props:Ke}),we.push(()=>Le(u,"value",De));function $t(U){n[11](U)}let We={options:xt};n[1].property!==void 0&&(We.value=n[1].property),b=new Qe({props:We}),we.push(()=>Le(b,"value",$t));function vt(U){n[12](U)}let Ye={options:ts};n[2].scoreComparator!==void 0&&(Ye.value=n[2].scoreComparator),C=new Bt({props:Ye}),we.push(()=>Le(C,"value",vt));function bt(U){n[14](U)}let Ze={options:ht};return n[2].rating!==void 0&&(Ze.value=n[2].rating),$=new Qe({props:Ze}),we.push(()=>Le($,"value",bt)),P=new Re({props:{title:"Return to searching.",$$slots:{default:[Zt]},$$scope:{ctx:n}}}),P.$on("click",n[7]),z=new Re({props:{title:"Reset sort and filter.",type:"secondary",$$slots:{default:[Jt]},$$scope:{ctx:n}}}),z.$on("click",n[9]),{c(){e=I("div"),s=I("h3"),s.textContent=t,r=O(),o=I("div"),l=I("b"),l.textContent=i,a=O(),c=I("div"),F(u.$$.fragment),d=O(),F(b.$$.fragment),w=O(),v=I("div"),g=I("b"),g.textContent=f,p=O(),N=I("div"),F(C.$$.fragment),Y=O(),q=I("input"),J=O(),Z=I("div"),ne=I("b"),ne.textContent=de,ge=O(),Q=I("div"),F($.$$.fragment),V=O(),F(P.$$.fragment),W=O(),F(z.$$.fragment),this.h()},l(U){e=D(U,"DIV",{class:!0});var G=j(e);s=D(G,"H3",{"data-svelte-h":!0}),ce(s)!=="svelte-15zouq3"&&(s.textContent=t),r=R(G),o=D(G,"DIV",{});var me=j(o);l=D(me,"B",{class:!0,"data-svelte-h":!0}),ce(l)!=="svelte-ekzpgg"&&(l.textContent=i),a=R(me),c=D(me,"DIV",{class:!0});var he=j(c);A(u.$$.fragment,he),d=R(he),A(b.$$.fragment,he),he.forEach(m),me.forEach(m),w=R(G),v=D(G,"DIV",{});var $e=j(v);g=D($e,"B",{class:!0,"data-svelte-h":!0}),ce(g)!=="svelte-1flca3"&&(g.textContent=f),p=R($e),N=D($e,"DIV",{class:!0});var ve=j(N);A(C.$$.fragment,ve),Y=R(ve),q=D(ve,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),ve.forEach(m),$e.forEach(m),J=R(G),Z=D(G,"DIV",{});var be=j(Z);ne=D(be,"B",{class:!0,"data-svelte-h":!0}),ce(ne)!=="svelte-1evbw58"&&(ne.textContent=de),ge=R(be),Q=D(be,"DIV",{class:!0});var Ne=j(Q);A($.$$.fragment,Ne),Ne.forEach(m),be.forEach(m),V=R(G),A(P.$$.fragment,G),W=R(G),A(z.$$.fragment,G),G.forEach(m),this.h()},h(){k(l,"class","svelte-gf4ubn"),k(c,"class","row svelte-gf4ubn"),k(g,"class","svelte-gf4ubn"),k(q,"type","number"),k(q,"min",0),k(q,"max",1e5),k(q,"step",1),k(q,"class","svelte-gf4ubn"),k(N,"class","row svelte-gf4ubn"),k(ne,"class","svelte-gf4ubn"),k(Q,"class","row svelte-gf4ubn"),k(e,"class","container svelte-gf4ubn")},m(U,G){T(U,e,G),y(e,s),y(e,r),y(e,o),y(o,l),y(o,a),y(o,c),B(u,c,null),y(c,d),B(b,c,null),y(e,w),y(e,v),y(v,g),y(v,p),y(v,N),B(C,N,null),y(N,Y),y(N,q),Se(q,n[0]),y(e,J),y(e,Z),y(Z,ne),y(Z,ge),y(Z,Q),B($,Q,null),y(e,V),B(P,e,null),y(e,W),B(z,e,null),X=!0,ye||(Ie=[re(q,"input",n[13]),re(q,"keyup",n[8])],ye=!0)},p(U,G){const me={};!_&&G&2&&(_=!0,me.value=U[1].direction,je(()=>_=!1)),u.$set(me);const he={};!h&&G&2&&(h=!0,he.value=U[1].property,je(()=>h=!1)),b.$set(he);const $e={};!L&&G&4&&(L=!0,$e.value=U[2].scoreComparator,je(()=>L=!1)),C.$set($e),G&1&&ft(q.value)!==U[0]&&Se(q,U[0]);const ve={};!H&&G&4&&(H=!0,ve.value=U[2].rating,je(()=>H=!1)),$.$set(ve);const be={};G&65536&&(be.$$scope={dirty:G,ctx:U}),P.$set(be);const Ne={};G&65536&&(Ne.$$scope={dirty:G,ctx:U}),z.$set(Ne)},i(U){X||(S(u.$$.fragment,U),S(b.$$.fragment,U),S(C.$$.fragment,U),S($.$$.fragment,U),S(P.$$.fragment,U),S(z.$$.fragment,U),X=!0)},o(U){E(u.$$.fragment,U),E(b.$$.fragment,U),E(C.$$.fragment,U),E($.$$.fragment,U),E(P.$$.fragment,U),E(z.$$.fragment,U),X=!1},d(U){U&&m(e),M(u),M(b),M(C),M($),M(P),M(z),ye=!1,Ae(Ie)}}}function Xt(n){let e,s,t,r,o,l,i,a,c,u,_,d,b,h,w,v=n[3]&&Xe(n);return{c(){e=I("button"),s=I("i"),t=O(),r=I("span"),o=te(n[5]),l=O(),i=I("i"),a=O(),c=I("span"),u=te(n[4]),_=O(),v&&v.c(),d=pe(),this.h()},l(g){e=D(g,"BUTTON",{class:!0});var f=j(e);s=D(f,"I",{class:!0}),j(s).forEach(m),t=R(f),r=D(f,"SPAN",{});var p=j(r);o=se(p,n[5]),p.forEach(m),l=R(f),i=D(f,"I",{class:!0}),j(i).forEach(m),a=R(f),c=D(f,"SPAN",{});var N=j(c);u=se(N,n[4]),N.forEach(m),f.forEach(m),_=R(g),v&&v.l(g),d=pe(),this.h()},h(){k(s,"class","codicon codicon-filter svelte-gf4ubn"),k(i,"class","codicon codicon-arrow-swap svelte-gf4ubn"),k(e,"class","svelte-gf4ubn")},m(g,f){T(g,e,f),y(e,s),y(e,t),y(e,r),y(r,o),y(e,l),y(e,i),y(e,a),y(e,c),y(c,u),T(g,_,f),v&&v.m(g,f),T(g,d,f),b=!0,h||(w=re(e,"click",n[6]),h=!0)},p(g,[f]){(!b||f&32)&&Oe(o,g[5]),(!b||f&16)&&Oe(u,g[4]),g[3]?v?(v.p(g,f),f&8&&S(v,1)):(v=Xe(g),v.c(),S(v,1),v.m(d.parentNode,d)):v&&(x(),E(v,1,1,()=>{v=null}),ee())},i(g){b||(S(v),b=!0)},o(g){E(v),b=!1},d(g){g&&(m(e),m(_),m(d)),v&&v.d(g),h=!1,w()}}}const xt=Object.freeze({id:"Uploaded",score:"Score",updated:"Updated"}),es=Object.freeze({desc:"codicon codicon-arrow-down",asc:"codicon codicon-arrow-up"}),ts=Object.freeze({">=":"≥","<=":"≤"}),ht=Object.freeze({all:"All",safe:"Safe",questionable:"Questionable",explicit:"Explicit"}),ss=Object.freeze({id:{asc:"Oldest",desc:"Newest"},score:{asc:"Worst",desc:"Best"},updated:{asc:"Inactive",desc:"Active"}}),ns=(n,e,s)=>{let t=n==="all"?void 0:ht[n],r=e===0&&s===">="?void 0:`Score${s}${Ve(e)}`;return[t,r].filter(o=>o!==void 0).join(",")||"All"};function rs(n,e,s){let t,r,o,l;ae(n,ue,p=>s(1,o=p)),ae(n,ke,p=>s(2,l=p));const i=_e();let a=!1;const c=()=>s(3,a=!0),u=()=>{s(3,a=!1),i("sortfilterupdate")},_=p=>{var N;return dt(p)&&((N=p.target)==null?void 0:N.blur())},d=()=>{ue.reset(),ke.reset(),s(0,b=l.scoreValue)};let b;function h(p){n.$$.not_equal(o.direction,p)&&(o.direction=p,ue.set(o))}function w(p){n.$$.not_equal(o.property,p)&&(o.property=p,ue.set(o))}function v(p){n.$$.not_equal(l.scoreComparator,p)&&(l.scoreComparator=p,ke.set(l))}function g(){b=ft(this.value),s(0,b),s(2,l)}function f(p){n.$$.not_equal(l.rating,p)&&(l.rating=p,ke.set(l))}return n.$$.update=()=>{if(n.$$.dirty&5){b===void 0&&s(0,b=l.scoreValue);let p=Number(b);isNaN(p)||kt(ke,l.scoreValue=p,l)}n.$$.dirty&4&&s(5,t=ns(l.rating,l.scoreValue,l.scoreComparator)),n.$$.dirty&2&&s(4,r=ss[o.property][o.direction])},[b,o,l,a,r,t,c,u,_,d,h,w,v,g,f]}class ls extends oe{constructor(e){super(),ie(this,e,rs,Xt,le,{})}}function os(n){const e=n.slice(),s=jt(e[1].file_url,e[1].sample_url,e[1].preview_url);return e[6]=s,e}function is(n){let e,s;return e=new mt({props:{post:n[1]}}),e.$on("click",n[3]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.post=t[1]),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function as(n){let e,s;return e=new Lt({props:{src:n[6].animated,poster:n[6].static,width:n[1].width,height:n[1].height,loop:n[1].tags.some(et)}}),e.$on("click",n[3]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.src=t[6].animated),r&2&&(o.poster=t[6].static),r&2&&(o.width=t[1].width),r&2&&(o.height=t[1].height),r&2&&(o.loop=t[1].tags.some(et)),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function cs(n){let e,s;return e=new Ft({props:{post:n[1],open:n[0]}}),e.$on("click",n[3]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.post=t[1]),r&1&&(o.open=t[0]),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function us(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),j(e).forEach(m),this.h()},h(){k(e,"class","codicon codicon-screen-full")},m(s,t){T(s,e,t)},p:K,d(s){s&&m(e)}}}function xe(n){let e,s;return e=new gt({props:{post:n[1]}}),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&2&&(o.post=t[1]),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function fs(n){let e,s,t,r,o,l,i,a,c,u;const _=[cs,as,is],d=[];function b(v,g){return v[1].type==="image"?0:v[1].type==="video"?1:2}function h(v,g){return g===1?os(v):v}s=b(n),t=d[s]=_[s](h(n,s)),o=new Fe({props:{class:"button-fullscreen","aria-label":"Enter Fullscreen mode",$$slots:{default:[us]},$$scope:{ctx:n}}}),o.$on("click",n[4]);let w=n[0]&&xe(n);return{c(){e=I("div"),t.c(),r=O(),F(o.$$.fragment),l=O(),w&&w.c(),this.h()},l(v){e=D(v,"DIV",{id:!0,class:!0});var g=j(e);t.l(g),r=R(g),A(o.$$.fragment,g),l=R(g),w&&w.l(g),g.forEach(m),this.h()},h(){k(e,"id",i="post_"+n[1].id),k(e,"class","post svelte-pwgq1f"),Ee(e,"open",n[0])},m(v,g){T(v,e,g),d[s].m(e,null),y(e,r),B(o,e,null),y(e,l),w&&w.m(e,null),a=!0,c||(u=re(e,"keydown",n[5]),c=!0)},p(v,[g]){let f=s;s=b(v),s===f?d[s].p(h(v,s),g):(x(),E(d[f],1,1,()=>{d[f]=null}),ee(),t=d[s],t?t.p(h(v,s),g):(t=d[s]=_[s](h(v,s)),t.c()),S(t,1),t.m(e,r));const p={};g&128&&(p.$$scope={dirty:g,ctx:v}),o.$set(p),v[0]?w?(w.p(v,g),g&1&&S(w,1)):(w=xe(v),w.c(),S(w,1),w.m(e,null)):w&&(x(),E(w,1,1,()=>{w=null}),ee()),(!a||g&2&&i!==(i="post_"+v[1].id))&&k(e,"id",i),(!a||g&1)&&Ee(e,"open",v[0])},i(v){a||(S(t),S(o.$$.fragment,v),S(w),a=!0)},o(v){E(t),E(o.$$.fragment,v),E(w),a=!1},d(v){v&&m(e),d[s].d(),M(o),w&&w.d(),c=!1,u()}}}const et=n=>n.name==="loop";function ps(n,e,s){const t=_e(),r=()=>s(0,l=!l);let{post:o}=e,{open:l=!1}=e;const i=()=>t("fullscreen"),a=c=>{c.key==="f"&&t("fullscreen")};return n.$$set=c=>{"post"in c&&s(1,o=c.post),"open"in c&&s(0,l=c.open)},[l,o,t,r,i,a]}class _s extends oe{constructor(e){super(),ie(this,e,ps,fs,le,{post:1,open:0})}}function tt(n){let e,s=n[0].type==="video"?"▶":"GIF",t;return{c(){e=I("span"),t=te(s),this.h()},l(r){e=D(r,"SPAN",{class:!0});var o=j(e);t=se(o,s),o.forEach(m),this.h()},h(){k(e,"class","type svelte-14imjnt")},m(r,o){T(r,e,o),y(e,t)},p(r,o){o&1&&s!==(s=r[0].type==="video"?"▶":"GIF")&&Oe(t,s)},d(r){r&&m(e)}}}function ds(n){let e,s,t,r,o,l=Ve(n[0].score)+"",i,a,c,u,_,d=n[0].type!=="image"&&tt(n);return{c(){e=I("div"),s=I("img"),r=O(),o=I("span"),i=te(l),a=O(),d&&d.c(),this.h()},l(b){e=D(b,"DIV",{id:!0,class:!0,style:!0});var h=j(e);s=D(h,"IMG",{src:!0,alt:!0,class:!0,tabindex:!0,loading:!0}),r=R(h),o=D(h,"SPAN",{class:!0});var w=j(o);i=se(w,l),w.forEach(m),a=R(h),d&&d.l(h),h.forEach(m),this.h()},h(){fe(s.src,t=n[1])||k(s,"src",t),k(s,"alt","post"),k(s,"class","post-media svelte-14imjnt"),k(s,"tabindex","-1"),k(s,"loading","lazy"),k(o,"class","score svelte-14imjnt"),k(e,"id",c="post_"+n[0].id),k(e,"class","post svelte-14imjnt"),ze(e,"grid-row","span "+n[2]),Ee(e,"open",open)},m(b,h){T(b,e,h),y(e,s),y(e,r),y(e,o),y(o,i),y(e,a),d&&d.m(e,null),u||(_=[re(e,"click",n[3]),re(e,"keydown",n[4])],u=!0)},p(b,[h]){h&2&&!fe(s.src,t=b[1])&&k(s,"src",t),h&1&&l!==(l=Ve(b[0].score)+"")&&Oe(i,l),b[0].type!=="image"?d?d.p(b,h):(d=tt(b),d.c(),d.m(e,null)):d&&(d.d(1),d=null),h&1&&c!==(c="post_"+b[0].id)&&k(e,"id",c),h&0&&Ee(e,"open",open)},i:K,o:K,d(b){b&&m(e),d&&d.d(),u=!1,Ae(_)}}}function gs(n,e,s){let t,{post:r}=e,o=Math.min(Math.round(r.height/r.width*5),15);const l=c=>c.endsWith(".jpg")||c.endsWith(".jpeg")||c.endsWith(".png")||c.endsWith(".webp");function i(c){qe.call(this,n,c)}const a=c=>{var u;(dt(c)||c.key==="f")&&((u=c.target)==null||u.click())};return n.$$set=c=>{"post"in c&&s(0,r=c.post)},n.$$.update=()=>{n.$$.dirty&1&&s(1,t=l(r.sample_url)?r.sample_url:r.preview_url)},[r,t,o,i,a]}class ms extends oe{constructor(e){super(),ie(this,e,gs,ds,le,{post:0})}}function hs(n){let e,s,t,r;const o=n[3].default,l=wt(o,n,n[2],null);return{c(){e=I("div"),l&&l.c(),this.h()},l(i){e=D(i,"DIV",{role:!0,tabindex:!0,class:!0});var a=j(e);l&&l.l(a),a.forEach(m),this.h()},h(){k(e,"role","none"),k(e,"tabindex","-1"),k(e,"class","dialog fullscreen svelte-1j44awz")},m(i,a){T(i,e,a),l&&l.m(e,null),n[5](e),s=!0,t||(r=[re(e,"keydown",n[4]),re(e,"click",yt($s))],t=!0)},p(i,[a]){l&&l.p&&(!s||a&4)&&St(l,o,i,i[2],s?Ct(o,i[2],a,null):Et(i[2]),null)},i(i){s||(S(l,i),s=!0)},o(i){E(l,i),s=!1},d(i){i&&m(e),l&&l.d(i),n[5](null),t=!1,Ae(r)}}}const $s=()=>{};function vs(n,e,s){let{$$slots:t={},$$scope:r}=e;const o=_e(),l=()=>o("close"),i=d=>{d.key==="Escape"&&l()};let a=()=>{document.fullscreenElement||l()},c;Be(async()=>{c.focus(),document.addEventListener("keydown",i),document.addEventListener("fullscreenchange",a);try{await c.requestFullscreen()}catch{}}),Me(async()=>{document.removeEventListener("keydown",i),document.removeEventListener("fullscreenchange",a);try{await document.exitFullscreen()}catch{}});const u=d=>{d.code==="Escape"&&l()};function _(d){we[d?"unshift":"push"](()=>{c=d,s(0,c)})}return n.$$set=d=>{"$$scope"in d&&s(2,r=d.$$scope)},[c,l,r,t,u,_]}class bs extends oe{constructor(e){super(),ie(this,e,vs,hs,le,{})}}function ks(n){let e,s;return e=new mt({props:{post:n[0]}}),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&1&&(o.post=t[0]),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function ws(n){let e,s;return{c(){e=I("video"),this.h()},l(t){e=D(t,"VIDEO",{class:!0,src:!0}),j(e).forEach(m),this.h()},h(){k(e,"class","post-media svelte-12glt11"),fe(e.src,s=n[0].file_url)||k(e,"src",s),e.controls=!0},m(t,r){T(t,e,r),n[5](e)},p(t,r){r&1&&!fe(e.src,s=t[0].file_url)&&k(e,"src",s)},i:K,o:K,d(t){t&&m(e),n[5](null)}}}function ys(n){let e,s,t,r,o;return{c(){e=I("img"),this.h()},l(l){e=D(l,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){k(e,"class","post-media svelte-12glt11"),fe(e.src,s=n[0].file_url)||k(e,"src",s),k(e,"alt",t="Image of Post "+n[0].id),Ee(e,"zoomed",n[1])},m(l,i){T(l,e,i),r||(o=re(e,"click",n[4]),r=!0)},p(l,i){i&1&&!fe(e.src,s=l[0].file_url)&&k(e,"src",s),i&1&&t!==(t="Image of Post "+l[0].id)&&k(e,"alt",t),i&2&&Ee(e,"zoomed",l[1])},i:K,o:K,d(l){l&&m(e),r=!1,o()}}}function Ss(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),j(e).forEach(m),this.h()},h(){k(e,"class","codicon codicon-close")},m(s,t){T(s,e,t)},p:K,d(s){s&&m(e)}}}function Es(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),j(e).forEach(m),this.h()},h(){k(e,"class","codicon codicon-chevron-left")},m(s,t){T(s,e,t)},p:K,d(s){s&&m(e)}}}function Cs(n){let e;return{c(){e=I("i"),this.h()},l(s){e=D(s,"I",{class:!0}),j(e).forEach(m),this.h()},h(){k(e,"class","codicon codicon-chevron-right")},m(s,t){T(s,e,t)},p:K,d(s){s&&m(e)}}}function Is(n){let e,s,t,r,o,l,i,a,c,u,_,d,b,h;const w=[ys,ws,ks],v=[];function g(f,p){return f[0].type==="image"?0:f[0].type==="video"?1:2}return s=g(n),t=v[s]=w[s](n),i=new gt({props:{post:n[0]}}),c=new Fe({props:{class:"button-close",$$slots:{default:[Ss]},$$scope:{ctx:n}}}),c.$on("click",n[6]),_=new Fe({props:{class:"button-previous",$$slots:{default:[Es]},$$scope:{ctx:n}}}),_.$on("click",n[7]),b=new Fe({props:{class:"button-next",$$slots:{default:[Cs]},$$scope:{ctx:n}}}),b.$on("click",n[8]),{c(){e=I("div"),t.c(),r=O(),o=I("i"),l=O(),F(i.$$.fragment),a=O(),F(c.$$.fragment),u=O(),F(_.$$.fragment),d=O(),F(b.$$.fragment),this.h()},l(f){e=D(f,"DIV",{class:!0});var p=j(e);t.l(p),r=R(p),o=D(p,"I",{class:!0}),j(o).forEach(m),p.forEach(m),l=R(f),A(i.$$.fragment,f),a=R(f),A(c.$$.fragment,f),u=R(f),A(_.$$.fragment,f),d=R(f),A(b.$$.fragment,f),this.h()},h(){k(o,"class","codicon codicon-chevron-down svelte-12glt11"),k(e,"class","svelte-12glt11")},m(f,p){T(f,e,p),v[s].m(e,null),y(e,r),y(e,o),T(f,l,p),B(i,f,p),T(f,a,p),B(c,f,p),T(f,u,p),B(_,f,p),T(f,d,p),B(b,f,p),h=!0},p(f,p){let N=s;s=g(f),s===N?v[s].p(f,p):(x(),E(v[N],1,1,()=>{v[N]=null}),ee(),t=v[s],t?t.p(f,p):(t=v[s]=w[s](f),t.c()),S(t,1),t.m(e,r));const C={};p&1&&(C.post=f[0]),i.$set(C);const L={};p&2048&&(L.$$scope={dirty:p,ctx:f}),c.$set(L);const Y={};p&2048&&(Y.$$scope={dirty:p,ctx:f}),_.$set(Y);const q={};p&2048&&(q.$$scope={dirty:p,ctx:f}),b.$set(q)},i(f){h||(S(t),S(i.$$.fragment,f),S(c.$$.fragment,f),S(_.$$.fragment,f),S(b.$$.fragment,f),h=!0)},o(f){E(t),E(i.$$.fragment,f),E(c.$$.fragment,f),E(_.$$.fragment,f),E(b.$$.fragment,f),h=!1},d(f){f&&(m(e),m(l),m(a),m(u),m(d)),v[s].d(),M(i,f),M(c,f),M(_,f),M(b,f)}}}function Ds(n){let e,s;return e=new bs({props:{$$slots:{default:[Is]},$$scope:{ctx:n}}}),e.$on("close",n[9]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,[r]){const o={};r&2055&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function Ns(n,e,s){const t=_e(),r=h=>{if(h.key==="f"&&(h.preventDefault(),h.stopPropagation(),t("close")),h.key==="ArrowLeft"&&(h.preventDefault(),h.stopPropagation(),t("previous")),h.key==="ArrowRight"&&(h.preventDefault(),h.stopPropagation(),t("next")),h.key===" "||h.key==="k"){h.preventDefault(),h.stopPropagation(),i&&(i.paused?i.play():i.pause());const w=document.querySelector(".fullscreen.circle");w&&w.click()}i&&(h.key==="j"?s(2,i.currentTime=Math.max(0,i.currentTime-5),i):h.key==="l"&&s(2,i.currentTime=Math.min(i.duration,i.currentTime+5),i))};let{post:o}=e,l=o.width/o.height<.33,i;Be(()=>{document.addEventListener("keydown",r)}),Me(()=>document.removeEventListener("keydown",r));const a=()=>s(1,l=!l);function c(h){we[h?"unshift":"push"](()=>{i=h,s(2,i)})}const u=()=>t("close"),_=()=>t("previous"),d=()=>t("next");function b(h){qe.call(this,n,h)}return n.$$set=h=>{"post"in h&&s(0,o=h.post)},[o,l,i,t,a,c,u,_,d,b]}class Ps extends oe{constructor(e){super(),ie(this,e,Ns,Ds,le,{post:0})}}function st(n,e,s){const t=n.slice();return t[12]=e[s],t[14]=s,t}function nt(n,e,s){const t=n.slice();return t[12]=e[s],t[14]=s,t}function Ts(n){let e,s,t=Ce(n[2].posts),r=[];for(let l=0;l<t.length;l+=1)r[l]=rt(st(n,t,l));const o=l=>E(r[l],1,1,()=>{r[l]=null});return{c(){e=I("section");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){e=D(l,"SECTION",{class:!0,style:!0});var i=j(e);for(let a=0;a<r.length;a+=1)r[a].l(i);i.forEach(m),this.h()},h(){k(e,"class","multi svelte-q6spg0"),ze(e,"grid-template-columns","repeat("+n[3]+", 1fr)")},m(l,i){T(l,e,i);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);s=!0},p(l,i){if(i&5){t=Ce(l[2].posts);let a;for(a=0;a<t.length;a+=1){const c=st(l,t,a);r[a]?(r[a].p(c,i),S(r[a],1)):(r[a]=rt(c),r[a].c(),S(r[a],1),r[a].m(e,null))}for(x(),a=t.length;a<r.length;a+=1)o(a);ee()}(!s||i&8)&&ze(e,"grid-template-columns","repeat("+l[3]+", 1fr)")},i(l){if(!s){for(let i=0;i<t.length;i+=1)S(r[i]);s=!0}},o(l){r=r.filter(Boolean);for(let i=0;i<r.length;i+=1)E(r[i]);s=!1},d(l){l&&m(e),Ge(r,l)}}}function Os(n){let e,s,t=Ce(n[2].posts),r=[];for(let l=0;l<t.length;l+=1)r[l]=lt(nt(n,t,l));const o=l=>E(r[l],1,1,()=>{r[l]=null});return{c(){e=I("section");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){e=D(l,"SECTION",{class:!0});var i=j(e);for(let a=0;a<r.length;a+=1)r[a].l(i);i.forEach(m),this.h()},h(){k(e,"class","single svelte-q6spg0")},m(l,i){T(l,e,i);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);s=!0},p(l,i){if(i&5){t=Ce(l[2].posts);let a;for(a=0;a<t.length;a+=1){const c=nt(l,t,a);r[a]?(r[a].p(c,i),S(r[a],1)):(r[a]=lt(c),r[a].c(),S(r[a],1),r[a].m(e,null))}for(x(),a=t.length;a<r.length;a+=1)o(a);ee()}},i(l){if(!s){for(let i=0;i<t.length;i+=1)S(r[i]);s=!0}},o(l){r=r.filter(Boolean);for(let i=0;i<r.length;i+=1)E(r[i]);s=!1},d(l){l&&m(e),Ge(r,l)}}}function rt(n){let e,s;function t(){return n[7](n[12],n[14])}return e=new ms({props:{post:n[12]}}),e.$on("click",t),{c(){F(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,o){B(e,r,o),s=!0},p(r,o){n=r;const l={};o&4&&(l.post=n[12]),e.$set(l)},i(r){s||(S(e.$$.fragment,r),s=!0)},o(r){E(e.$$.fragment,r),s=!1},d(r){M(e,r)}}}function lt(n){let e,s;function t(){return n[6](n[12],n[14])}return e=new _s({props:{post:n[12]}}),e.$on("fullscreen",t),{c(){F(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,o){B(e,r,o),s=!0},p(r,o){n=r;const l={};o&4&&(l.post=n[12]),e.$set(l)},i(r){s||(S(e.$$.fragment,r),s=!0)},o(r){E(e.$$.fragment,r),s=!1},d(r){M(e,r)}}}function ot(n){let e,s;return e=new Ps({props:{post:n[0].post}}),e.$on("close",n[8]),e.$on("previous",n[9]),e.$on("next",n[10]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&1&&(o.post=t[0].post),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function Rs(n){let e,s,t=Ve(n[2].postCount)+"",r,o,l,i,a,c,u,_,d,b;i=new ls({}),i.$on("sortfilterupdate",n[5]);const h=[Os,Ts],w=[];function v(f,p){return f[3]==="1"?0:1}c=v(n),u=w[c]=h[c](n);let g=n[1]&&n[0]!==void 0&&ot(n);return{c(){e=I("div"),s=I("span"),r=te(t),o=te(" posts"),l=O(),F(i.$$.fragment),a=O(),u.c(),_=O(),g&&g.c(),d=pe(),this.h()},l(f){e=D(f,"DIV",{class:!0});var p=j(e);s=D(p,"SPAN",{});var N=j(s);r=se(N,t),o=se(N," posts"),N.forEach(m),l=R(p),A(i.$$.fragment,p),p.forEach(m),a=R(f),u.l(f),_=R(f),g&&g.l(f),d=pe(),this.h()},h(){k(e,"class","svelte-q6spg0")},m(f,p){T(f,e,p),y(e,s),y(s,r),y(s,o),y(e,l),B(i,e,null),T(f,a,p),w[c].m(f,p),T(f,_,p),g&&g.m(f,p),T(f,d,p),b=!0},p(f,[p]){(!b||p&4)&&t!==(t=Ve(f[2].postCount)+"")&&Oe(r,t);let N=c;c=v(f),c===N?w[c].p(f,p):(x(),E(w[N],1,1,()=>{w[N]=null}),ee(),u=w[c],u?u.p(f,p):(u=w[c]=h[c](f),u.c()),S(u,1),u.m(_.parentNode,_)),f[1]&&f[0]!==void 0?g?(g.p(f,p),p&3&&S(g,1)):(g=ot(f),g.c(),S(g,1),g.m(d.parentNode,d)):g&&(x(),E(g,1,1,()=>{g=null}),ee())},i(f){b||(S(i.$$.fragment,f),S(u),S(g),b=!0)},o(f){E(i.$$.fragment,f),E(u),E(g),b=!1},d(f){f&&(m(e),m(a),m(_),m(d)),M(i),w[c].d(f),g&&g.d(f)}}}function Vs(n,e,s){let t,r;ae(n,Te,w=>s(2,t=w)),ae(n,Vt,w=>s(3,r=w));const o=_e(),l=()=>{s(1,a=location.hash.length>2)};let i,a=location.hash.length>2;Be(()=>{window.addEventListener("hashchange",l)}),Me(()=>{window.removeEventListener("hashchange",l)});function c(w){qe.call(this,n,w)}return[i,a,t,r,o,c,(w,v)=>{s(0,i={post:w,index:v}),location.hash="fullscreen"},(w,v)=>{s(0,i={post:w,index:v}),location.hash="fullscreen"},()=>{var w,v;(w=i==null?void 0:i.post)!=null&&w.id&&((v=document.querySelector(`#post_${i.post.id} .post-media`))==null||v.focus()),s(0,i=void 0),history.back()},()=>{let w=Math.max(i.index-1,0);s(0,i={index:w,post:t.posts[w]})},()=>{let w=Math.min(i.index+1,t.posts.length);s(0,i={index:w,post:t.posts[w]}),w>t.posts.length-3&&t.posts.length!==t.postCount&&o("endreached")}]}class js extends oe{constructor(e){super(),ie(this,e,Vs,Rs,le,{})}}function Ls(n){let e;return{c(){e=I("div")},l(s){e=D(s,"DIV",{}),j(e).forEach(m)},m(s,t){T(s,e,t),n[2](e)},p:K,i:K,o:K,d(s){s&&m(e),n[2](null)}}}function Fs(n,e,s){let{rootMargin:t}=e;const r=_e(),o=new IntersectionObserver(a=>{a[0].isIntersecting&&r("intersection")},{rootMargin:t});let l;function i(a){we[a?"unshift":"push"](()=>{l=a,s(0,l)})}return n.$$set=a=>{"rootMargin"in a&&s(1,t=a.rootMargin)},n.$$.update=()=>{n.$$.dirty&1&&(o.disconnect(),l&&o.observe(l))},[l,t,i]}class As extends oe{constructor(e){super(),ie(this,e,Fs,Ls,le,{rootMargin:1})}}function Bs(n){let e,s,t,r,o="You have seen everything there is to see...";return{c(){e=I("img"),t=O(),r=I("p"),r.textContent=o,this.h()},l(l){e=D(l,"IMG",{src:!0,alt:!0,class:!0}),t=R(l),r=D(l,"P",{"data-svelte-h":!0}),ce(r)!=="svelte-1i75mtf"&&(r.textContent=o),this.h()},h(){fe(e.src,s=_t+"/assets/shironeko-x.png")||k(e,"src",s),k(e,"alt","No more results to load"),k(e,"class","svelte-1pkma0d")},m(l,i){T(l,e,i),T(l,t,i),T(l,r,i)},p:K,i:K,o:K,d(l){l&&(m(e),m(t),m(r))}}}class Ms extends oe{constructor(e){super(),ie(this,e,null,Bs,le,{})}}function it(n,e,s){const t=n.slice();return t[9]=e[s],t}function at(n){let e,s;return e=new Ut({props:{tag:n[9]}}),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&4&&(o.tag=t[9]),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function Us(n){let e;return{c(){e=te("Create supertag")},l(s){e=se(s,"Create supertag")},m(s,t){T(s,e,t)},d(s){s&&m(e)}}}function zs(n){let e,s,t="Create Supertag",r,o,l,i,a,c="Name",u,_,d,b,h,w="Description",v,g,f,p,N,C="Tags",L,Y,q,J,Z,ne,de,ge,Q=Ce(n[2]),$=[];for(let V=0;V<Q.length;V+=1)$[V]=at(it(n,Q,V));const H=V=>E($[V],1,1,()=>{$[V]=null});return Z=new Re({props:{title:n[3]?"Click to create supertag":"Enter a valid name to continue",disabled:!n[3],$$slots:{default:[Us]},$$scope:{ctx:n}}}),Z.$on("click",n[8]),{c(){e=I("section"),s=I("h3"),s.textContent=t,r=O(),o=I("button"),l=O(),i=I("div"),a=I("label"),a.textContent=c,u=O(),_=I("input"),d=O(),b=I("div"),h=I("label"),h.textContent=w,v=O(),g=I("input"),f=O(),p=I("div"),N=I("span"),N.textContent=C,L=O(),Y=I("ol");for(let V=0;V<$.length;V+=1)$[V].c();q=O(),J=I("div"),F(Z.$$.fragment),this.h()},l(V){e=D(V,"SECTION",{class:!0});var P=j(e);s=D(P,"H3",{"data-svelte-h":!0}),ce(s)!=="svelte-ho1cwx"&&(s.textContent=t),r=R(P),o=D(P,"BUTTON",{class:!0}),j(o).forEach(m),l=R(P),i=D(P,"DIV",{class:!0});var W=j(i);a=D(W,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ce(a)!=="svelte-10k8a68"&&(a.textContent=c),u=R(W),_=D(W,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),W.forEach(m),d=R(P),b=D(P,"DIV",{class:!0});var z=j(b);h=D(z,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ce(h)!=="svelte-14n9kp6"&&(h.textContent=w),v=R(z),g=D(z,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),z.forEach(m),f=R(P),p=D(P,"DIV",{class:!0});var X=j(p);N=D(X,"SPAN",{class:!0,"data-svelte-h":!0}),ce(N)!=="svelte-7hjyox"&&(N.textContent=C),L=R(X),Y=D(X,"OL",{class:!0});var ye=j(Y);for(let De=0;De<$.length;De+=1)$[De].l(ye);ye.forEach(m),X.forEach(m),q=R(P),J=D(P,"DIV",{class:!0});var Ie=j(J);A(Z.$$.fragment,Ie),Ie.forEach(m),P.forEach(m),this.h()},h(){k(o,"class",pt("codicon codicon-close")+" svelte-xkjm86"),k(a,"for","supertag-name"),k(a,"class","svelte-xkjm86"),k(_,"type","text"),k(_,"placeholder","Descriptive name"),k(_,"id","supertag-name"),k(_,"class","svelte-xkjm86"),k(i,"class","svelte-xkjm86"),k(h,"for","supertag-description"),k(h,"class","svelte-xkjm86"),k(g,"type","text"),k(g,"placeholder","Short description"),k(g,"id","supertag-description"),k(g,"class","svelte-xkjm86"),k(b,"class","svelte-xkjm86"),k(N,"class","svelte-xkjm86"),k(Y,"class","svelte-xkjm86"),k(p,"class","svelte-xkjm86"),k(J,"class","last svelte-xkjm86"),k(e,"class","svelte-xkjm86")},m(V,P){T(V,e,P),y(e,s),y(e,r),y(e,o),y(e,l),y(e,i),y(i,a),y(i,u),y(i,_),Se(_,n[0]),y(e,d),y(e,b),y(b,h),y(b,v),y(b,g),Se(g,n[1]),y(e,f),y(e,p),y(p,N),y(p,L),y(p,Y);for(let W=0;W<$.length;W+=1)$[W]&&$[W].m(Y,null);y(e,q),y(e,J),B(Z,J,null),ne=!0,de||(ge=[re(o,"click",n[5]),re(_,"input",n[6]),re(g,"input",n[7])],de=!0)},p(V,P){if(P&1&&_.value!==V[0]&&Se(_,V[0]),P&2&&g.value!==V[1]&&Se(g,V[1]),P&4){Q=Ce(V[2]);let z;for(z=0;z<Q.length;z+=1){const X=it(V,Q,z);$[z]?($[z].p(X,P),S($[z],1)):($[z]=at(X),$[z].c(),S($[z],1),$[z].m(Y,null))}for(x(),z=Q.length;z<$.length;z+=1)H(z);ee()}const W={};P&8&&(W.title=V[3]?"Click to create supertag":"Enter a valid name to continue"),P&8&&(W.disabled=!V[3]),P&4096&&(W.$$scope={dirty:P,ctx:V}),Z.$set(W)},i(V){if(!ne){for(let P=0;P<Q.length;P+=1)S($[P]);S(Z.$$.fragment,V),ne=!0}},o(V){$=$.filter(Boolean);for(let P=0;P<$.length;P+=1)E($[P]);E(Z.$$.fragment,V),ne=!1},d(V){V&&m(e),Ge($,V),M(Z),de=!1,Ae(ge)}}}function qs(n){let e,s;return e=new He({props:{$$slots:{default:[zs]},$$scope:{ctx:n}}}),e.$on("close",n[5]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,[r]){const o={};r&4111&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function Gs(n,e,s){let t,{name:r=""}=e,{description:o=""}=e,{tags:l}=e;const i=_e(),a=()=>i("close");function c(){r=this.value,s(0,r)}function u(){o=this.value,s(1,o)}const _=()=>{i("submit",{name:r,description:o,tags:l.map(({modifier:d,name:b})=>({modifier:d,name:b}))}),a()};return n.$$set=d=>{"name"in d&&s(0,r=d.name),"description"in d&&s(1,o=d.description),"tags"in d&&s(2,l=d.tags)},n.$$.update=()=>{n.$$.dirty&5&&s(3,t=typeof r=="string"&&r!==""&&l.length>1)},[r,o,l,t,i,a,c,u,_]}class Hs extends oe{constructor(e){super(),ie(this,e,Gs,qs,le,{name:0,description:1,tags:2})}}function Ks(n){let e,s,t,r,o,l,i,a,c,u;return{c(){e=I("div"),s=I("div"),t=I("i"),r=O(),o=I("div"),l=I("h3"),i=te(n[0]),a=O(),c=I("span"),u=te(n[2]),this.h()},l(_){e=D(_,"DIV",{class:!0});var d=j(e);s=D(d,"DIV",{class:!0});var b=j(s);t=D(b,"I",{class:!0}),j(t).forEach(m),b.forEach(m),r=R(d),o=D(d,"DIV",{});var h=j(o);l=D(h,"H3",{class:!0});var w=j(l);i=se(w,n[0]),w.forEach(m),a=R(h),c=D(h,"SPAN",{});var v=j(c);u=se(v,n[2]),v.forEach(m),h.forEach(m),d.forEach(m),this.h()},h(){k(t,"class",pt(n[1])+" svelte-1tvgln1"),k(s,"class","icon svelte-1tvgln1"),k(l,"class","svelte-1tvgln1"),k(e,"class","error svelte-1tvgln1")},m(_,d){T(_,e,d),y(e,s),y(s,t),y(e,r),y(e,o),y(o,l),y(l,i),y(o,a),y(o,c),y(c,u)},p:K,i:K,o:K,d(_){_&&m(e)}}}function Ws(n,e,s){let{error:t}=e,r=t.message==="Failed to fetch"?"Connection Error":"Application Error",o=t.message==="Failed to fetch"?"codicon codicon-debug-disconnect":"codicon codicon-error",l=t.message==="Failed to fetch"?"Failed to connect to the server. Make sure you have a stable internet connection.":t.message;return n.$$set=i=>{"error"in i&&s(3,t=i.error)},[r,o,l,t]}class Ys extends oe{constructor(e){super(),ie(this,e,Ws,Ks,le,{error:3})}}const Zs=n=>({tags:en(n),sort:tn(n),filter:sn(n)}),Js=n=>{const e=new URLSearchParams,{tags:s,sort:t,filter:r}=n;return s&&s.length>0&&e.append("tags",Qs(s)),t&&(t.property!=="id"||(t==null?void 0:t.direction)!=="desc")&&e.append("sort",Xs(t)),r&&(r.rating!=="all"||r.scoreComparator!==">="||r.scoreValue!==0)&&e.append("filter",xs(r)),e},Qs=n=>n.join(";"),Xs=n=>n.property+":"+n.direction,xs=n=>{const e=[];if(n.rating!=="all"){const s="rating:"+n.rating;e.push(s)}if(n.scoreComparator!==">="||n.scoreValue!==0){const s="score"+n.scoreComparator+n.scoreValue;e.push(s)}return e.join(";")},en=n=>{if(!n.has("tags"))return[];const s=(n.get("tags")??"").split(";");return!Array.isArray(s)||s.length===0?[]:s},tn=n=>{try{if(!n.has("sort"))return;const e=n.get("sort")??"",[s,t]=e.split(":");return{property:s,direction:t}}catch{console.warn("Invalid sort provided in url");return}},sn=n=>{try{if(!n.has("filter"))return;const s=(n.get("filter")??"").split(";");let t={};return s.forEach(r=>{if(r.startsWith("rating:")){const[,o]=r.split(":");o!=="all"&&(t.rating=o)}if(r.startsWith("score")){const o=r.match(/score(..)(\d+)/);if(o){const[,l,i]=o;t.scoreComparator=l;const a=Number(i);a&&(t.scoreValue=a)}}}),t}catch{console.warn("Invalid sort provided in url");return}};function nn(n){let e;return{c(){e=te("Search")},l(s){e=se(s,"Search")},m(s,t){T(s,e,t)},d(s){s&&m(e)}}}function rn(n){let e,s,t,r,o,l;const i=[an,on],a=[];function c(u,_){return u[3].postCount===0?0:1}return s=c(n),t=a[s]=i[s](n),o=new zt({}),{c(){e=I("section"),t.c(),r=O(),F(o.$$.fragment),this.h()},l(u){e=D(u,"SECTION",{class:!0});var _=j(e);t.l(_),_.forEach(m),r=R(u),A(o.$$.fragment,u),this.h()},h(){k(e,"class","svelte-xbsifd")},m(u,_){T(u,e,_),a[s].m(e,null),T(u,r,_),B(o,u,_),l=!0},p(u,_){let d=s;s=c(u),s===d?a[s].p(u,_):(x(),E(a[d],1,1,()=>{a[d]=null}),ee(),t=a[s],t?t.p(u,_):(t=a[s]=i[s](u),t.c()),S(t,1),t.m(e,null))},i(u){l||(S(t),S(o.$$.fragment,u),l=!0)},o(u){E(t),E(o.$$.fragment,u),l=!1},d(u){u&&(m(e),m(r)),a[s].d(),M(o,u)}}}function ln(n){let e,s;return e=new Ys({props:{error:n[0]}}),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&1&&(o.error=t[0]),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function on(n){let e,s,t,r,o,l;e=new js({}),e.$on("sortfilterupdate",n[11]),e.$on("endreached",n[12]);const i=[un,cn],a=[];function c(u,_){return u[3].posts.length===u[3].postCount?0:1}return t=c(n),r=a[t]=i[t](n),{c(){F(e.$$.fragment),s=O(),r.c(),o=pe()},l(u){A(e.$$.fragment,u),s=R(u),r.l(u),o=pe()},m(u,_){B(e,u,_),T(u,s,_),a[t].m(u,_),T(u,o,_),l=!0},p(u,_){let d=t;t=c(u),t===d?a[t].p(u,_):(x(),E(a[d],1,1,()=>{a[d]=null}),ee(),r=a[t],r?r.p(u,_):(r=a[t]=i[t](u),r.c()),S(r,1),r.m(o.parentNode,o))},i(u){l||(S(e.$$.fragment,u),S(r),l=!0)},o(u){E(e.$$.fragment,u),E(r),l=!1},d(u){u&&(m(s),m(o)),M(e,u),a[t].d(u)}}}function an(n){let e,s;return e=new Yt({}),e.$on("sortfilterupdate",n[11]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p:K,i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function cn(n){let e,s;return e=new As({props:{rootMargin:"1000px"}}),e.$on("intersection",n[12]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p:K,i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function un(n){let e,s;return e=new Ms({}),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p:K,i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function ct(n){let e,s;return e=new Hs({props:{tags:n[7]}}),e.$on("close",n[18]),e.$on("submit",n[19]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&128&&(o.tags=t[7]),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function ut(n){let e,s;return e=new He({props:{$$slots:{default:[pn]},$$scope:{ctx:n}}}),e.$on("close",n[20]),{c(){F(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,r){B(e,t,r),s=!0},p(t,r){const o={};r&268435680&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){s||(S(e.$$.fragment,t),s=!0)},o(t){E(e.$$.fragment,t),s=!1},d(t){M(e,t)}}}function fn(n){let e;return{c(){e=te("Share this search")},l(s){e=se(s,"Share this search")},m(s,t){T(s,e,t)},d(s){s&&m(e)}}}function pn(n){let e,s,t,r,o,l;return s=new Gt({props:{$$slots:{default:[fn]},$$scope:{ctx:n}}}),{c(){e=I("div"),F(s.$$.fragment),t=O(),r=I("input"),this.h()},l(i){e=D(i,"DIV",{});var a=j(e);A(s.$$.fragment,a),t=R(a),r=D(a,"INPUT",{type:!0,class:!0}),a.forEach(m),this.h()},h(){k(r,"type","text"),r.value=o=n[9](n[7],n[6],n[5]),k(r,"class","svelte-xbsifd")},m(i,a){T(i,e,a),B(s,e,null),y(e,t),y(e,r),l=!0},p(i,a){const c={};a&268435456&&(c.$$scope={dirty:a,ctx:i}),s.$set(c),(!l||a&224&&o!==(o=i[9](i[7],i[6],i[5]))&&r.value!==o)&&(r.value=o)},i(i){l||(S(s.$$.fragment,i),l=!0)},o(i){E(s.$$.fragment,i),l=!1},d(i){i&&m(e),M(s)}}}function _n(n){let e,s,t,r,o,l,i,a,c,u,_,d,b,h,w;s=new It({}),r=new Pt({props:{placeholder:"Search for tags",fetchSuggestions:n[10]}}),r.$on("pick",n[13]),l=new Re({props:{title:"Search with the tags above",$$slots:{default:[nn]},$$scope:{ctx:n}}}),l.$on("click",n[11]),a=new Dt({props:{tags:[...n[7],...n[4]]}}),a.$on("click",n[14]),a.$on("contextmenu",n[15]),a.$on("createSupertag",n[16]),a.$on("copy",n[17]);const v=[ln,rn],g=[];function f(C,L){return C[0]?0:C[3].requested?1:-1}~(u=f(n))&&(_=g[u]=v[u](n));let p=n[1]&&ct(n),N=n[2]&&ut(n);return{c(){e=I("section"),F(s.$$.fragment),t=O(),F(r.$$.fragment),o=O(),F(l.$$.fragment),i=O(),F(a.$$.fragment),c=O(),_&&_.c(),d=O(),p&&p.c(),b=O(),N&&N.c(),h=pe(),this.h()},l(C){e=D(C,"SECTION",{id:!0,class:!0});var L=j(e);A(s.$$.fragment,L),t=R(L),A(r.$$.fragment,L),o=R(L),A(l.$$.fragment,L),i=R(L),A(a.$$.fragment,L),L.forEach(m),c=R(C),_&&_.l(C),d=R(C),p&&p.l(C),b=R(C),N&&N.l(C),h=pe(),this.h()},h(){k(e,"id","search"),k(e,"class","svelte-xbsifd")},m(C,L){T(C,e,L),B(s,e,null),y(e,t),B(r,e,null),y(e,o),B(l,e,null),y(e,i),B(a,e,null),T(C,c,L),~u&&g[u].m(C,L),T(C,d,L),p&&p.m(C,L),T(C,b,L),N&&N.m(C,L),T(C,h,L),w=!0},p(C,[L]){const Y={};L&268435456&&(Y.$$scope={dirty:L,ctx:C}),l.$set(Y);const q={};L&144&&(q.tags=[...C[7],...C[4]]),a.$set(q);let J=u;u=f(C),u===J?~u&&g[u].p(C,L):(_&&(x(),E(g[J],1,1,()=>{g[J]=null}),ee()),~u?(_=g[u],_?_.p(C,L):(_=g[u]=v[u](C),_.c()),S(_,1),_.m(d.parentNode,d)):_=null),C[1]?p?(p.p(C,L),L&2&&S(p,1)):(p=ct(C),p.c(),S(p,1),p.m(b.parentNode,b)):p&&(x(),E(p,1,1,()=>{p=null}),ee()),C[2]?N?(N.p(C,L),L&4&&S(N,1)):(N=ut(C),N.c(),S(N,1),N.m(h.parentNode,h)):N&&(x(),E(N,1,1,()=>{N=null}),ee())},i(C){w||(S(s.$$.fragment,C),S(r.$$.fragment,C),S(l.$$.fragment,C),S(a.$$.fragment,C),S(_),S(p),S(N),w=!0)},o(C){E(s.$$.fragment,C),E(r.$$.fragment,C),E(l.$$.fragment,C),E(a.$$.fragment,C),E(_),E(p),E(N),w=!1},d(C){C&&(m(e),m(c),m(d),m(b),m(h)),M(s),M(r),M(l),M(a),~u&&g[u].d(C),p&&p.d(C),N&&N.d(C)}}}const dn=(n,e,s)=>{let t=!1;const{tags:r,sort:o,filter:l}=Zs(new URL(location.href).searchParams);return r&&(n.reset(),r.forEach(i=>n.addByName(i)),t=!0),o&&(e.update(o),t=!0),l&&(s.update(l),t=!0),t};function gn(n,e,s){let t,r,o,l,i,a,c;ae(n,Te,$=>s(3,t=$)),ae(n,Ue,$=>s(4,r=$)),ae(n,ke,$=>s(5,o=$)),ae(n,ue,$=>s(6,l=$)),ae(n,Mt,$=>s(23,i=$)),ae(n,Pe,$=>s(7,a=$)),ae(n,Je,$=>s(8,c=$));let u=!1,_,d=!1,b=!1,h=0;const w=($,H,V)=>{const P=new URL(location.protocol+"//"+location.host+location.pathname);return Js({tags:$.map(z=>z.name),sort:H,filter:V}).forEach((z,X)=>{P.searchParams.set(X,z)}),P},v=async $=>{const H=await Ot($);return[...c.items.filter(({name:P})=>P.toLowerCase().includes($.toLowerCase())).map(P=>({label:P.name,count:P.tags.length,type:"supertag"})),...H]},g=dn(Pe,ue,ke),f=()=>new Nt().withPid(t.pageCount).withTags(a).withBlockedContent(i).withSortProperty(l.property).withSortDirection(l.direction).withScoreValue(o.scoreValue).withScoreComparator(o.scoreComparator).withRating(o.rating).withSupertags(r),p=async $=>{if(!u){s(0,_=void 0),u=!0;try{const H=t.pageCount;await $(),qt(H).catch(()=>{})}catch(H){s(0,_=H),console.warn(H)}finally{u=!1}}},N=async()=>{Te.reset(),h=0,p(async()=>{const[$,H]=await f().getPageAndCount();Te.addPage($,H)})},C=async()=>{p(async()=>{const $=await f().getPage();Te.addPage($)})},L=$=>{var H,V;if(($.key==="/"||$.key==="s")&&(!document.activeElement||document.activeElement===document.body)&&((H=document.getElementById("searchbar"))==null||H.focus(),$.preventDefault(),$.stopPropagation()),$.ctrlKey&&$.key==="Enter"&&($.preventDefault(),$.stopPropagation(),N()),$.ctrlKey&&$.key==="m"&&((V=document.getElementById("select-modifier"))==null||V.click()),$.ctrlKey&&$.key==="ArrowDown"){const P=document.getElementsByClassName("post-media");P[h].focus(),h=Math.min(h+1,Math.max(0,P.length-1))}$.ctrlKey&&$.key==="ArrowUp"&&(document.getElementsByClassName("post-media")[h].focus(),h=Math.max(h-1,0))};return Be(()=>{document.addEventListener("keydown",L),g&&N()}),Me(()=>{document.removeEventListener("keydown",L)}),[_,d,b,t,r,o,l,a,c,w,v,N,C,async $=>{const H=$.detail;if(H.type==="supertag"){const V=c.items.find(P=>P.name===H.label);if(!V){console.warn("Supertag not present.");return}Ue.addOrReplace(V)}else{const V=await Rt($.detail.label);Pe.addOrReplace({name:$.detail.label,modifier:$.detail.modifier,count:$.detail.count,type:V.type})}},$=>"description"in $.detail?Ue.removeByName($.detail.name):Pe.removeByName($.detail.name),$=>{"description"in $.detail||($.detail.modifier=Tt($.detail.modifier),Pe.addOrReplace($.detail))},()=>s(1,d=!0),()=>s(2,b=!0),()=>s(1,d=!1),$=>Je.add($.detail),()=>s(2,b=!1)]}class Ln extends oe{constructor(e){super(),ie(this,e,gn,_n,le,{})}}export{Ln as component};
