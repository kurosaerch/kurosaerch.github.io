import{B as m}from"./blocking-group-data.358160cd.js";import{c as S}from"./tag-utils.3f2ca96e.js";const T=r=>r==="-"?"-":"",u=r=>r.replaceAll(" ","_"),z=r=>`${T(r.modifier)}${u(r.name)}`,h=r=>{const t=U(r);let s=[...f([...t["+"],...t["-"]])];return t["~"].length>0&&s.push(`( ${f(t["~"]).join(" ~ ")} )`),s.join("+")},B=(r,t,s,e,o,i,n,c)=>{const a=[`sort:${t}:${s}`];if((e!==0||i!==">=")&&a.push(`score:${i}${e}`),o!=="all"&&a.push(`rating:${o}`),r.length>0&&a.push(h(r)),c.length>0){const l=c.map(p=>h(p.tags)).join("+");a.push(l)}if(n.length>0){const l=n.flatMap(g=>m[g]).map(g=>({modifier:"-",name:g})),p=h(l);a.push(p)}return a.join("+")},f=r=>r.map(z),U=r=>{const t={"+":[],"-":[],"~":[]};return r.forEach(s=>t[s.modifier].push(s)),t},d=";",$=r=>r.replaceAll(" ","+").split(d).map(t=>t.trim()).map(t=>S(t.charAt(0),t.substring(1))),v=r=>r.map(t=>`${t.modifier}${u(t.name)}`).join(d),L=r=>({tags:$(r.get("tags")??""),sort:E(r),filter:I(r)}),b=r=>{const t=new URLSearchParams,{tags:s,sort:e,filter:o}=r;return s&&s.length>0&&t.append("tags",v(s)),e&&(e.property!=="id"||(e==null?void 0:e.direction)!=="desc")&&t.append("sort",y(e)),o&&(o.rating!=="all"||o.scoreComparator!==">="||o.scoreValue!==0)&&t.append("filter",j(o)),t},y=r=>r.property+":"+r.direction,j=r=>{const t=[];if(r.rating!=="all"){const s="rating:"+r.rating;t.push(s)}if(r.scoreComparator!==">="||r.scoreValue!==0){const s="score"+r.scoreComparator+r.scoreValue;t.push(s)}return t.join(";")},E=r=>{try{if(!r.has("sort"))return;const t=r.get("sort")??"",[s,e]=t.split(":");return{property:s,direction:e}}catch{console.warn("Invalid sort provided in url");return}},I=r=>{try{if(!r.has("filter"))return;const s=(r.get("filter")??"").split(";");let e={};return s.forEach(o=>{if(o.startsWith("rating:")){const[,i]=o.split(":");i!=="all"&&(e.rating=i)}if(o.startsWith("score")){const i=o.match(/score(..)(\d+)/);if(i){const[,n,c]=i;e.scoreComparator=n;const a=Number(c);a&&(e.scoreValue=a)}}}),e}catch{console.warn("Invalid sort provided in url");return}},N=(r,t,s)=>{const e=new URL(location.protocol+"//"+location.host+"/share");return b({tags:r,sort:t,filter:s}).forEach((i,n)=>{e.searchParams.set(n,i)}),e};export{N as g,L as p,B as s};
