import{s as ee,f as E,a as P,l as j,g as I,h as y,d as p,c as T,m as B,j as m,L as V,i as C,u as k,F as N,n as H,v as K,E as te,p as ue,H as W,I as fe,K as he,r as me,e as z,P as ge}from"./scheduler.88299003.js";import{h as G,u as de}from"./await_block.7017edd9.js";import{e as J}from"./each.e59479a4.js";import{S as se,i as le,f as pe,b as O,d as q,m as F,a as w,t as D,e as R,g as ne,c as ae}from"./index.15b414ac.js";import{b as _e}from"./paths.20282e89.js";import{M as be}from"./ModifierSelect.623aacd6.js";import{L as ke}from"./LoadingAnimation.bc4b1a41.js";import{C as ve}from"./CodiconLink.436cc2cd.js";import{a as Q,f as X}from"./format-tag.d6c065e3.js";import{a as Se}from"./tags.58927cde.js";import{p as Ee,S as Ie}from"./store-keys.3fb7abd8.js";function ye(a){let e,n,r,t,s,l=Q(a[0].label)+"",o,i,c,v=X(a[0].count)+"",_,S,b,L;return{c(){e=E("li"),n=E("i"),t=P(),s=E("span"),o=j(l),i=P(),c=E("span"),_=j(v),this.h()},l(d){e=I(d,"LI",{role:!0,tabindex:!0,title:!0,class:!0});var u=y(e);n=I(u,"I",{class:!0}),y(n).forEach(p),t=T(u),s=I(u,"SPAN",{class:!0});var g=y(s);o=B(g,l),g.forEach(p),i=T(u),c=I(u,"SPAN",{class:!0});var f=y(c);_=B(f,v),f.forEach(p),u.forEach(p),this.h()},h(){m(n,"class",r=a[0].type==="supertag"?"codicon codicon-star-full":"codicon codicon-tag"),m(s,"class","tag-name svelte-1d1xyf4"),m(c,"class","tag-count"),m(e,"role","button"),m(e,"tabindex","0"),m(e,"title",S=a[0].label),m(e,"class","svelte-1d1xyf4"),V(e,"selected",a[1])},m(d,u){C(d,e,u),k(e,n),k(e,t),k(e,s),k(s,o),k(e,i),k(e,c),k(c,_),b||(L=N(e,"click",a[3]),b=!0)},p(d,[u]){u&1&&r!==(r=d[0].type==="supertag"?"codicon codicon-star-full":"codicon codicon-tag")&&m(n,"class",r),u&1&&l!==(l=Q(d[0].label)+"")&&H(o,l),u&1&&v!==(v=X(d[0].count)+"")&&H(_,v),u&1&&S!==(S=d[0].label)&&m(e,"title",S),u&2&&V(e,"selected",d[1])},i:K,o:K,d(d){d&&p(e),b=!1,L()}}}function we(a,e,n){const r=te();let{suggestion:t}=e,{selected:s=!1}=e;const l=()=>r("click",t);return a.$$set=o=>{"suggestion"in o&&n(0,t=o.suggestion),"selected"in o&&n(1,s=o.selected)},[t,s,r,l]}class Ae extends se{constructor(e){super(),le(this,e,we,ye,ee,{suggestion:0,selected:1})}}function Y(a,e,n){const r=a.slice();return r[21]=e[n],r[23]=n,r}function De(a){let e,n,r,t,s=a[24].message+"",l;return{c(){e=E("div"),n=E("i"),r=P(),t=E("span"),l=j(s),this.h()},l(o){e=I(o,"DIV",{class:!0});var i=y(e);n=I(i,"I",{class:!0}),y(n).forEach(p),r=T(i),t=I(i,"SPAN",{});var c=y(t);l=B(c,s),c.forEach(p),i.forEach(p),this.h()},h(){m(n,"class",me("codicon codicon-error")+" svelte-un3hla"),m(e,"class","suggestion-footer svelte-un3hla")},m(o,i){C(o,e,i),k(e,n),k(e,r),k(e,t),k(t,l)},p(o,i){i&4&&s!==(s=o[24].message+"")&&H(l,s)},i:K,o:K,d(o){o&&p(e)}}}function Ne(a){let e=Array.isArray(a[20]),n,r,t,s=e&&Z(a);return{c(){s&&s.c(),n=P(),r=E("div"),this.h()},l(l){s&&s.l(l),n=T(l),r=I(l,"DIV",{class:!0}),y(r).forEach(p),this.h()},h(){m(r,"class","suggestion-footer svelte-un3hla")},m(l,o){s&&s.m(l,o),C(l,n,o),C(l,r,o),t=!0},p(l,o){o&4&&(e=Array.isArray(l[20])),e?s?(s.p(l,o),o&4&&w(s,1)):(s=Z(l),s.c(),w(s,1),s.m(n.parentNode,n)):s&&(ne(),D(s,1,1,()=>{s=null}),ae())},i(l){t||(w(s),t=!0)},o(l){D(s),t=!1},d(l){l&&(p(n),p(r)),s&&s.d(l)}}}function Z(a){let e,n,r=J(a[20]),t=[];for(let l=0;l<r.length;l+=1)t[l]=$(Y(a,r,l));const s=l=>D(t[l],1,1,()=>{t[l]=null});return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=z()},l(l){for(let o=0;o<t.length;o+=1)t[o].l(l);e=z()},m(l,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(l,o);C(l,e,o),n=!0},p(l,o){if(o&268){r=J(l[20]);let i;for(i=0;i<r.length;i+=1){const c=Y(l,r,i);t[i]?(t[i].p(c,o),w(t[i],1)):(t[i]=$(c),t[i].c(),w(t[i],1),t[i].m(e.parentNode,e))}for(ne(),i=r.length;i<t.length;i+=1)s(i);ae()}},i(l){if(!n){for(let o=0;o<r.length;o+=1)w(t[o]);n=!0}},o(l){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)D(t[o]);n=!1},d(l){l&&p(e),ge(t,l)}}}function $(a){let e,n;function r(){return a[16](a[21])}return e=new Ae({props:{suggestion:a[21],selected:a[23]===a[3]}}),e.$on("click",r),{c(){O(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,s){a=t;const l={};s&4&&(l.suggestion=a[21]),s&8&&(l.selected=a[23]===a[3]),e.$set(l)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function Pe(a){let e,n,r;return n=new ke({}),{c(){e=E("div"),O(n.$$.fragment),this.h()},l(t){e=I(t,"DIV",{class:!0});var s=y(e);q(n.$$.fragment,s),s.forEach(p),this.h()},h(){m(e,"class","suggestion-footer svelte-un3hla")},m(t,s){C(t,e,s),F(n,e,null),r=!0},p:K,i(t){r||(w(n.$$.fragment,t),r=!0)},o(t){D(n.$$.fragment,t),r=!1},d(t){t&&p(e),R(n)}}}function Te(a){let e,n,r,t,s,l,o,i,c,v,_,S,b;function L(g){a[14](g)}let d={};a[4]!==void 0&&(d.modifier=a[4]),n=new be({props:d}),ue.push(()=>pe(n,"modifier",L)),o=new ve({props:{title:"More information on tags.",href:_e+"/help#tags",icon:"codicon codicon-question"}});let u={ctx:a,current:null,token:null,hasCatch:!0,pending:Pe,then:Ne,catch:De,value:20,error:24,blocks:[,,,]};return G(v=a[2],u),{c(){e=E("div"),O(n.$$.fragment),t=P(),s=E("input"),l=P(),O(o.$$.fragment),i=P(),c=E("ol"),u.block.c(),this.h()},l(g){e=I(g,"DIV",{class:!0});var f=y(e);q(n.$$.fragment,f),t=T(f),s=I(f,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,autocomplete:!0,"aria-label":!0,class:!0}),l=T(f),q(o.$$.fragment,f),i=T(f),c=I(f,"OL",{class:!0});var A=y(c);u.block.l(A),A.forEach(p),f.forEach(p),this.h()},h(){m(s,"type","text"),m(s,"name","searchbar"),m(s,"id","searchbar"),m(s,"placeholder",a[0]),m(s,"autocomplete","off"),m(s,"aria-label","Search for tags."),m(s,"class","svelte-un3hla"),m(c,"class","svelte-un3hla"),V(c,"open",a[5]&&a[6]),m(e,"class","searchbar svelte-un3hla"),V(e,"open",a[5]&&a[6])},m(g,f){C(g,e,f),F(n,e,null),k(e,t),k(e,s),W(s,a[1]),k(e,l),F(o,e,null),k(e,i),k(e,c),u.block.m(c,u.anchor=null),u.mount=()=>c,u.anchor=null,_=!0,S||(b=[N(s,"input",a[15]),N(s,"focus",a[11]),N(s,"blur",a[10]),N(s,"keydown",a[12]),N(s,"keyup",a[7]),N(e,"blur",a[9])],S=!0)},p(g,[f]){a=g;const A={};!r&&f&16&&(r=!0,A.modifier=a[4],fe(()=>r=!1)),n.$set(A),(!_||f&1)&&m(s,"placeholder",a[0]),f&2&&s.value!==a[1]&&W(s,a[1]),u.ctx=a,f&4&&v!==(v=a[2])&&G(v,u)||de(u,a,f),(!_||f&96)&&V(c,"open",a[5]&&a[6]),(!_||f&96)&&V(e,"open",a[5]&&a[6])},i(g){_||(w(n.$$.fragment,g),w(o.$$.fragment,g),w(u.block),_=!0)},o(g){D(n.$$.fragment,g),D(o.$$.fragment,g);for(let f=0;f<3;f+=1){const A=u.blocks[f];D(A)}_=!1},d(g){g&&p(e),R(n),R(o),u.block.d(),u.token=null,u=null,S=!1,he(b)}}}function Ce(a,e,n){const r=te();let{placeholder:t}=e,{fetchSuggestions:s}=e,l="",o="",i,c=0,v="+",_=!1,S=!1,b=[];const L=()=>{l!==""&&l!==o&&(n(3,c=0),o=l,n(6,S=!0),n(2,i=s(l)),i.then(h=>b=h).catch(()=>b=[]))},d=h=>{r("pick",{modifier:v,...h}),n(1,l=""),n(3,c=0),n(6,S=!1)},u=()=>{n(5,_=!1)},g=h=>{(!h.relatedTarget||!h.target.parentNode.contains(h.relatedTarget))&&n(5,_=!1)},f=h=>{n(5,_=!0),h.target.scrollIntoView({block:"center",behavior:"smooth"})},A=async h=>{if(!h.ctrlKey&&h.key==="Enter"&&l!=="")if(b.length>c)d(b[c]);else{const ce=l.split(";").map(M=>M.trim().replaceAll(" ","_"));(await Promise.all(ce.map(Se))).map(M=>({type:"tag",label:M.name,count:M.count})).forEach(d)}else h.code==="Escape"?h.target.blur():h.code==="ArrowUp"&&b.length>0?n(3,c=(c+b.length-1)%b.length):h.code==="ArrowDown"&&b.length>0&&n(3,c=(c+1)%b.length)};function oe(h){v=h,n(4,v)}function re(){l=this.value,n(1,l)}const ie=h=>d(h);return a.$$set=h=>{"placeholder"in h&&n(0,t=h.placeholder),"fetchSuggestions"in h&&n(13,s=h.fetchSuggestions)},[t,l,i,c,v,_,S,L,d,u,g,f,A,s,oe,re,ie]}class ze extends se{constructor(e){super(),le(this,e,Ce,Te,ee,{placeholder:0,fetchSuggestions:13})}}const U=["+","-","~"],Ge=a=>{const n=((U.indexOf(a)??2)+1)%U.length;return U[n]},x=()=>({last_sync:0,items:[]}),Le=()=>{const{subscribe:a,set:e,update:n}=Ee(Ie.Supertags,x());return{subscribe:a,set:e,add(r){n(t=>(t.items.push(r),t))},remove(r){n(t=>(t.items=t.items.filter(s=>s.name!==r.name),t))},update(r,t){n(s=>{const l=s.items.findIndex(o=>o.name===r);return l!==-1&&(s.items[l]=t),s})},reset(){e(x())}}},Je=Le();export{ze as S,Ge as n,Je as s};
