var Q=Object.defineProperty;var W=(s,t,r)=>t in s?Q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var f=(s,t,r)=>(W(s,typeof t!="symbol"?t+"":t,r),r);import{s as N,f as C,U as X,g as S,h as $,V as Y,d as p,j as d,r as V,i as b,v as _,u as Z,F as x,M as tt,E as et,a as st,e as y,c as rt,P as nt}from"./scheduler.88299003.js";import{S as j,i as A,a as h,g as P,t as g,c as T,b as E,d as M,m as q,e as z}from"./index.15b414ac.js";import{e as I}from"./each.e59479a4.js";import{D as J}from"./DetailedTag.8c9e45d9.js";import{s as w,b as it,c as ot,d as at}from"./posts.779cfae3.js";import{S as v}from"./store-keys.5b62d166.js";import{B as lt}from"./blocked-content-store.8cb9d99a.js";function ct(s){let t,r;return{c(){t=C("h1"),r=new X(!1),this.h()},l(e){t=S(e,"H1",{class:!0});var i=$(t);r=Y(i,!1),i.forEach(p),this.h()},h(){r.a=null,d(t,"class",V(s[1])+" svelte-1jtyohl")},m(e,i){b(e,t,i),r.m(s[0],t)},p:_,i:_,o:_,d(e){e&&p(t)}}}function ut(s){const t=new Date,r=a=>{const l=`${a.getDate()}-${a.getMonth()}`;return l==="24-12"||l==="25-12"?"kurðŸŽ…search":"kurosearch"},e=a=>a.getMonth()===5?"pride":"default",i=r(t),n=e(t);return[i,n]}class qt extends j{constructor(t){super(),A(this,t,ut,ct,N,{})}}function ht(s){let t,r,e,i,n;return{c(){t=C("button"),r=C("i"),this.h()},l(a){t=S(a,"BUTTON",{title:!0,class:!0});var l=$(t);r=S(l,"I",{class:!0}),$(r).forEach(p),l.forEach(p),this.h()},h(){d(r,"class",e=V(s[1])+" svelte-c0182g"),d(t,"title",s[0]),d(t,"class","svelte-c0182g")},m(a,l){b(a,t,l),Z(t,r),i||(n=x(t,"click",s[2]),i=!0)},p(a,[l]){l&2&&e!==(e=V(a[1])+" svelte-c0182g")&&d(r,"class",e),l&1&&d(t,"title",a[0])},i:_,o:_,d(a){a&&p(t),i=!1,n()}}}function ft(s,t,r){let{title:e}=t,{icon:i}=t;function n(a){tt.call(this,s,a)}return s.$$set=a=>{"title"in a&&r(0,e=a.title),"icon"in a&&r(1,i=a.icon)},[e,i,n]}class gt extends j{constructor(t){super(),A(this,t,ft,ht,N,{title:0,icon:1})}}function O(s,t,r){const e=s.slice();return e[7]=t[r],e}function R(s){let t,r,e,i=I(s[0]),n=[];for(let o=0;o<i.length;o+=1)n[o]=K(O(s,i,o));const a=o=>g(n[o],1,1,()=>{n[o]=null});let l=s[0].length>1&&U(s);return{c(){for(let o=0;o<n.length;o+=1)n[o].c();t=st(),l&&l.c(),r=y()},l(o){for(let u=0;u<n.length;u+=1)n[u].l(o);t=rt(o),l&&l.l(o),r=y()},m(o,u){for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(o,u);b(o,t,u),l&&l.m(o,u),b(o,r,u),e=!0},p(o,u){if(u&3){i=I(o[0]);let c;for(c=0;c<i.length;c+=1){const m=O(o,i,c);n[c]?(n[c].p(m,u),h(n[c],1)):(n[c]=K(m),n[c].c(),h(n[c],1),n[c].m(t.parentNode,t))}for(P(),c=i.length;c<n.length;c+=1)a(c);T()}o[0].length>1?l?(l.p(o,u),u&1&&h(l,1)):(l=U(o),l.c(),h(l,1),l.m(r.parentNode,r)):l&&(P(),g(l,1,1,()=>{l=null}),T())},i(o){if(!e){for(let u=0;u<i.length;u+=1)h(n[u]);h(l),e=!0}},o(o){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)g(n[u]);g(l),e=!1},d(o){o&&(p(t),p(r)),nt(n,o),l&&l.d(o)}}}function pt(s){let t,r;function e(){return s[4](s[7])}function i(){return s[5](s[7])}return t=new J({props:{tag:s[7],active:!0}}),t.$on("click",e),t.$on("contextmenu",i),{c(){E(t.$$.fragment)},l(n){M(t.$$.fragment,n)},m(n,a){q(t,n,a),r=!0},p(n,a){s=n;const l={};a&1&&(l.tag=s[7]),t.$set(l)},i(n){r||(h(t.$$.fragment,n),r=!0)},o(n){g(t.$$.fragment,n),r=!1},d(n){z(t,n)}}}function dt(s){let t,r;function e(){return s[2](s[7])}function i(){return s[3](s[7])}return t=new J({props:{tag:{name:s[7].name,type:"supertag",modifier:"+",count:s[7].tags.length},active:!0}}),t.$on("click",e),t.$on("contextmenu",i),{c(){E(t.$$.fragment)},l(n){M(t.$$.fragment,n)},m(n,a){q(t,n,a),r=!0},p(n,a){s=n;const l={};a&1&&(l.tag={name:s[7].name,type:"supertag",modifier:"+",count:s[7].tags.length}),t.$set(l)},i(n){r||(h(t.$$.fragment,n),r=!0)},o(n){g(t.$$.fragment,n),r=!1},d(n){z(t,n)}}}function K(s){let t,r,e,i;const n=[dt,pt],a=[];function l(o,u){return"description"in o[7]?0:1}return t=l(s),r=a[t]=n[t](s),{c(){r.c(),e=y()},l(o){r.l(o),e=y()},m(o,u){a[t].m(o,u),b(o,e,u),i=!0},p(o,u){let c=t;t=l(o),t===c?a[t].p(o,u):(P(),g(a[c],1,1,()=>{a[c]=null}),T(),r=a[t],r?r.p(o,u):(r=a[t]=n[t](o),r.c()),h(r,1),r.m(e.parentNode,e))},i(o){i||(h(r),i=!0)},o(o){g(r),i=!1},d(o){o&&p(e),a[t].d(o)}}}function U(s){let t,r;return t=new gt({props:{icon:"codicon codicon-star-full",title:"Create a supertag from the current selection."}}),t.$on("click",s[6]),{c(){E(t.$$.fragment)},l(e){M(t.$$.fragment,e)},m(e,i){q(t,e,i),r=!0},p:_,i(e){r||(h(t.$$.fragment,e),r=!0)},o(e){g(t.$$.fragment,e),r=!1},d(e){z(t,e)}}}function mt(s){let t,r,e=s[0].length>0&&R(s);return{c(){t=C("ul"),e&&e.c(),this.h()},l(i){t=S(i,"UL",{class:!0});var n=$(t);e&&e.l(n),n.forEach(p),this.h()},h(){d(t,"class","svelte-11k0uwj")},m(i,n){b(i,t,n),e&&e.m(t,null),r=!0},p(i,[n]){i[0].length>0?e?(e.p(i,n),n&1&&h(e,1)):(e=R(i),e.c(),h(e,1),e.m(t,null)):e&&(P(),g(e,1,1,()=>{e=null}),T())},i(i){r||(h(e),r=!0)},o(i){g(e),r=!1},d(i){i&&p(t),e&&e.d()}}}function _t(s,t,r){const e=et();let{tags:i}=t;const n=c=>e("click",c),a=c=>e("contextmenu",c),l=c=>e("click",c),o=c=>e("contextmenu",c),u=()=>e("createSupertag",i);return s.$$set=c=>{"tags"in c&&r(0,i=c.tags)},[i,e,n,a,l,o,u]}class zt extends j{constructor(t){super(),A(this,t,_t,mt,N,{tags:0})}}const F=()=>({posts:[],pageCount:0,ids:new Set,postCount:0,requested:!1}),bt=s=>JSON.stringify({posts:s.posts,pageCount:s.pageCount,ids:[...s.ids.values()],postCount:s.postCount,requested:s.requested}),kt=s=>{const t=JSON.parse(s);return{posts:t.posts,pageCount:t.pageCount,ids:new Set(t.ids),postCount:t.postCount,requested:t.requested}},Ct=()=>{const{subscribe:s,update:t,set:r}=w(v.Results,F(),bt,kt);return{subscribe:s,addPage(e,i=void 0){t(n=>{const a=e.filter(l=>!n.ids.has(l.id));return a.forEach(l=>n.ids.add(l.id)),{posts:[...n.posts,...a],pageCount:n.pageCount+1,ids:n.ids,postCount:i??n.postCount,requested:!0}})},reset(){r(F())}}},It=Ct(),L=()=>({property:"id",direction:"desc"}),St=()=>{const{subscribe:s,set:t,update:r}=w(v.Sort,L());return{subscribe:s,set:t,update(e){r(i=>({...i,...e}))},reset(){t(L())}}},Ot=St(),G=()=>({scoreValue:0,scoreComparator:">=",rating:"all"}),$t=()=>{const{subscribe:s,set:t,update:r}=w(v.Filter,G());return{subscribe:s,set(e){t({...e,scoreValue:e.scoreValue??0})},update(e){r(i=>({...i,...e}))},reset(){t(G())}}},Rt=$t(),yt=()=>{const{subscribe:s,update:t,set:r}=w(v.ActiveSupertags,[]);return{subscribe:s,set:r,addOrReplace:e=>t(i=>{const n=i.findIndex(a=>a.name===e.name);return n===-1?i.push(e):i[n]=e,i}),removeByName:e=>t(i=>{const n=i.findIndex(a=>a.name===e);return i.splice(n,1),i}),reset:()=>r([])}},Kt=yt(),Pt=s=>s==="-"?"-":"",Tt=s=>s.replaceAll(" ","_"),wt=s=>`${Pt(s.modifier)}${Tt(s.name)}`,B=s=>{const t=vt(s);let r=[...H([...t["+"],...t["-"]])];return t["~"].length>0&&r.push(`( ${H(t["~"]).join(" ~ ")} )`),r.join("+")},k=(s,t,r,e,i,n,a,l)=>{const o=[`sort:${t}:${r}`];if((e!==0||n!==">=")&&o.push(`score:${n}${e}`),i!=="all"&&o.push(`rating:${i}`),s.length>0&&o.push(B(s)),l.length>0){const c=l.map(m=>B(m.tags)).join("+");o.push(c)}if(a.length>0){const c=a.flatMap(D=>lt[D]).map(D=>({modifier:"-",name:D})),m=B(c);o.push(m)}return o.join("+")},H=s=>s.map(wt),vt=s=>{const t={"+":[],"-":[],"~":[]};return s.forEach(r=>t[r.modifier].push(r)),t};class Ut{constructor(){f(this,"pid");f(this,"tags");f(this,"supertags");f(this,"blockedContent");f(this,"sortProperty");f(this,"sortDirection");f(this,"scoreValue");f(this,"rating");f(this,"scoreComparator");f(this,"tagString");this.pid=0,this.tags=[],this.supertags=[],this.blockedContent=[],this.sortProperty="id",this.sortDirection="desc",this.scoreValue=0,this.rating="all",this.scoreComparator=">="}withPid(t){return this.pid=t,this}withTags(t){return this.tags=t,this}withSupertags(t){return this.supertags=t,this}withSortProperty(t){return this.sortProperty=t,this}withSortDirection(t){return this.sortDirection=t,this}withScoreValue(t){return this.scoreValue=t,this}withScoreComparator(t){return this.scoreComparator=t,this}withRating(t){return this.rating=t,this}withBlockedContent(t){return this.blockedContent=Object.entries(t).filter(([r,e])=>e).map(([r,e])=>r),this}async getPageAndCount(){return this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags),Promise.all([this.getPage(),this.getCount()])}async getPage(){return this.tagString||(this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),it(this.pid,this.tagString)}async getCount(){return this.tagString||(this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),ot(this.tagString)}getQuery(){return this.tagString||(this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),at(0,this.tagString)}}export{zt as A,qt as K,Ut as S,Kt as a,Rt as f,It as r,Ot as s};
