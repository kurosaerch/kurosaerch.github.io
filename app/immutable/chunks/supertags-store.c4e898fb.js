import{s as le,f as y,a as T,l as G,g as E,h as I,d,c as C,m as H,j as m,M as V,i as P,u as k,F as N,n as W,v as K,D as ne,p as me,E as J,K as ge,H as pe,r as de,e as Q,G as _e}from"./scheduler.0a29c992.js";import{h as X,u as be}from"./await_block.f127d874.js";import{e as Y}from"./each.e59479a4.js";import{S as oe,i as ae,f as ke,b as q,d as F,m as R,a as w,t as D,e as U,g as re,c as ie}from"./index.6d8df040.js";import{b as ve}from"./paths.e903196b.js";import{M as Se}from"./ModifierSelect.51f2ca82.js";import{L as ye}from"./LoadingAnimation.91c05c4c.js";import{C as Ee}from"./CodiconLink.3ba43c6c.js";import{a as Z,f as $}from"./format-tag.7e313273.js";import{a as Ie}from"./tags.49324235.js";import{p as we,S as Ae}from"./store-keys.19bfcc67.js";function De(o){let e,n,r,t,s,l=Z(o[0].label)+"",a,i,c,v=$(o[0].count)+"",_,S,b,L;return{c(){e=y("li"),n=y("i"),t=T(),s=y("span"),a=G(l),i=T(),c=y("span"),_=G(v),this.h()},l(p){e=E(p,"LI",{role:!0,tabindex:!0,title:!0,class:!0});var u=I(e);n=E(u,"I",{class:!0}),I(n).forEach(d),t=C(u),s=E(u,"SPAN",{class:!0});var g=I(s);a=H(g,l),g.forEach(d),i=C(u),c=E(u,"SPAN",{class:!0});var f=I(c);_=H(f,v),f.forEach(d),u.forEach(d),this.h()},h(){m(n,"class",r=o[0].type==="supertag"?"codicon codicon-star-full":"codicon codicon-tag"),m(s,"class","tag-name svelte-1d1xyf4"),m(c,"class","tag-count"),m(e,"role","button"),m(e,"tabindex","0"),m(e,"title",S=o[0].label),m(e,"class","svelte-1d1xyf4"),V(e,"selected",o[1])},m(p,u){P(p,e,u),k(e,n),k(e,t),k(e,s),k(s,a),k(e,i),k(e,c),k(c,_),b||(L=N(e,"click",o[3]),b=!0)},p(p,[u]){u&1&&r!==(r=p[0].type==="supertag"?"codicon codicon-star-full":"codicon codicon-tag")&&m(n,"class",r),u&1&&l!==(l=Z(p[0].label)+"")&&W(a,l),u&1&&v!==(v=$(p[0].count)+"")&&W(_,v),u&1&&S!==(S=p[0].label)&&m(e,"title",S),u&2&&V(e,"selected",p[1])},i:K,o:K,d(p){p&&d(e),b=!1,L()}}}function Ne(o,e,n){const r=ne();let{suggestion:t}=e,{selected:s=!1}=e;const l=()=>r("click",t);return o.$$set=a=>{"suggestion"in a&&n(0,t=a.suggestion),"selected"in a&&n(1,s=a.selected)},[t,s,r,l]}class Te extends oe{constructor(e){super(),ae(this,e,Ne,De,le,{suggestion:0,selected:1})}}function x(o,e,n){const r=o.slice();return r[21]=e[n],r[23]=n,r}function Ce(o){let e,n,r,t,s=o[24].message+"",l;return{c(){e=y("div"),n=y("i"),r=T(),t=y("span"),l=G(s),this.h()},l(a){e=E(a,"DIV",{class:!0});var i=I(e);n=E(i,"I",{class:!0}),I(n).forEach(d),r=C(i),t=E(i,"SPAN",{});var c=I(t);l=H(c,s),c.forEach(d),i.forEach(d),this.h()},h(){m(n,"class",de("codicon codicon-error")+" svelte-un3hla"),m(e,"class","suggestion-footer svelte-un3hla")},m(a,i){P(a,e,i),k(e,n),k(e,r),k(e,t),k(t,l)},p(a,i){i&4&&s!==(s=a[24].message+"")&&W(l,s)},i:K,o:K,d(a){a&&d(e)}}}function Pe(o){let e=Array.isArray(o[20]),n,r,t,s=e&&ee(o);return{c(){s&&s.c(),n=T(),r=y("div"),this.h()},l(l){s&&s.l(l),n=C(l),r=E(l,"DIV",{class:!0}),I(r).forEach(d),this.h()},h(){m(r,"class","suggestion-footer svelte-un3hla")},m(l,a){s&&s.m(l,a),P(l,n,a),P(l,r,a),t=!0},p(l,a){a&4&&(e=Array.isArray(l[20])),e?s?(s.p(l,a),a&4&&w(s,1)):(s=ee(l),s.c(),w(s,1),s.m(n.parentNode,n)):s&&(re(),D(s,1,1,()=>{s=null}),ie())},i(l){t||(w(s),t=!0)},o(l){D(s),t=!1},d(l){l&&(d(n),d(r)),s&&s.d(l)}}}function ee(o){let e,n,r=Y(o[20]),t=[];for(let l=0;l<r.length;l+=1)t[l]=te(x(o,r,l));const s=l=>D(t[l],1,1,()=>{t[l]=null});return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=Q()},l(l){for(let a=0;a<t.length;a+=1)t[a].l(l);e=Q()},m(l,a){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(l,a);P(l,e,a),n=!0},p(l,a){if(a&268){r=Y(l[20]);let i;for(i=0;i<r.length;i+=1){const c=x(l,r,i);t[i]?(t[i].p(c,a),w(t[i],1)):(t[i]=te(c),t[i].c(),w(t[i],1),t[i].m(e.parentNode,e))}for(re(),i=r.length;i<t.length;i+=1)s(i);ie()}},i(l){if(!n){for(let a=0;a<r.length;a+=1)w(t[a]);n=!0}},o(l){t=t.filter(Boolean);for(let a=0;a<t.length;a+=1)D(t[a]);n=!1},d(l){l&&d(e),_e(t,l)}}}function te(o){let e,n;function r(){return o[16](o[21])}return e=new Te({props:{suggestion:o[21],selected:o[23]===o[3]}}),e.$on("click",r),{c(){q(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,s){R(e,t,s),n=!0},p(t,s){o=t;const l={};s&4&&(l.suggestion=o[21]),s&8&&(l.selected=o[23]===o[3]),e.$set(l)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){D(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function Le(o){let e,n,r;return n=new ye({}),{c(){e=y("div"),q(n.$$.fragment),this.h()},l(t){e=E(t,"DIV",{class:!0});var s=I(e);F(n.$$.fragment,s),s.forEach(d),this.h()},h(){m(e,"class","suggestion-footer svelte-un3hla")},m(t,s){P(t,e,s),R(n,e,null),r=!0},p:K,i(t){r||(w(n.$$.fragment,t),r=!0)},o(t){D(n.$$.fragment,t),r=!1},d(t){t&&d(e),U(n)}}}function Me(o){let e,n,r,t,s,l,a,i,c,v,_,S,b;function L(g){o[14](g)}let p={};o[4]!==void 0&&(p.modifier=o[4]),n=new Se({props:p}),me.push(()=>ke(n,"modifier",L)),a=new Ee({props:{title:"More information on tags.",href:ve+"/help#tags",icon:"codicon codicon-question"}});let u={ctx:o,current:null,token:null,hasCatch:!0,pending:Le,then:Pe,catch:Ce,value:20,error:24,blocks:[,,,]};return X(v=o[2],u),{c(){e=y("div"),q(n.$$.fragment),t=T(),s=y("input"),l=T(),q(a.$$.fragment),i=T(),c=y("ol"),u.block.c(),this.h()},l(g){e=E(g,"DIV",{class:!0});var f=I(e);F(n.$$.fragment,f),t=C(f),s=E(f,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,autocomplete:!0,"aria-label":!0,class:!0}),l=C(f),F(a.$$.fragment,f),i=C(f),c=E(f,"OL",{class:!0});var A=I(c);u.block.l(A),A.forEach(d),f.forEach(d),this.h()},h(){m(s,"type","text"),m(s,"name","searchbar"),m(s,"id","searchbar"),m(s,"placeholder",o[0]),m(s,"autocomplete","off"),m(s,"aria-label","Search for tags."),m(s,"class","svelte-un3hla"),m(c,"class","svelte-un3hla"),V(c,"open",o[5]&&o[6]),m(e,"class","searchbar svelte-un3hla"),V(e,"open",o[5]&&o[6])},m(g,f){P(g,e,f),R(n,e,null),k(e,t),k(e,s),J(s,o[1]),k(e,l),R(a,e,null),k(e,i),k(e,c),u.block.m(c,u.anchor=null),u.mount=()=>c,u.anchor=null,_=!0,S||(b=[N(s,"input",o[15]),N(s,"focus",o[11]),N(s,"blur",o[10]),N(s,"keydown",o[12]),N(s,"keyup",o[7]),N(e,"blur",o[9])],S=!0)},p(g,[f]){o=g;const A={};!r&&f&16&&(r=!0,A.modifier=o[4],ge(()=>r=!1)),n.$set(A),(!_||f&1)&&m(s,"placeholder",o[0]),f&2&&s.value!==o[1]&&J(s,o[1]),u.ctx=o,f&4&&v!==(v=o[2])&&X(v,u)||be(u,o,f),(!_||f&96)&&V(c,"open",o[5]&&o[6]),(!_||f&96)&&V(e,"open",o[5]&&o[6])},i(g){_||(w(n.$$.fragment,g),w(a.$$.fragment,g),w(u.block),_=!0)},o(g){D(n.$$.fragment,g),D(a.$$.fragment,g);for(let f=0;f<3;f+=1){const A=u.blocks[f];D(A)}_=!1},d(g){g&&d(e),U(n),U(a),u.block.d(),u.token=null,u=null,S=!1,pe(b)}}}function Ve(o,e,n){const r=ne();let{placeholder:t}=e,{fetchSuggestions:s}=e,l="",a="",i,c=0,v="+",_=!1,S=!1,b=[];const L=()=>{l!==""&&l!==a&&(n(3,c=0),a=l,n(6,S=!0),n(2,i=s(l)),i.then(h=>b=h).catch(()=>b=[]))},p=h=>{r("pick",{modifier:v,...h}),n(1,l=""),n(3,c=0),n(6,S=!1)},u=()=>{n(5,_=!1)},g=h=>{(!h.relatedTarget||!h.target.parentNode.contains(h.relatedTarget))&&n(5,_=!1)},f=h=>{n(5,_=!0),h.target.scrollIntoView({block:"center",behavior:"smooth"})},A=async h=>{if(!h.ctrlKey&&h.key==="Enter"&&l!=="")if(b.length>c)p(b[c]);else{const z=l.split(";").map(O=>O.trim().replaceAll(" ","_")),he=await Promise.all(z.map(Ie));z.map(O=>{const M=he.find(j=>(j==null?void 0:j.name)===O);return{type:(M==null?void 0:M.type)??"tag",label:O,count:(M==null?void 0:M.count)??0}}).forEach(p)}else h.code==="Escape"?h.target.blur():h.code==="ArrowUp"&&b.length>0?n(3,c=(c+b.length-1)%b.length):h.code==="ArrowDown"&&b.length>0&&n(3,c=(c+1)%b.length)};function ce(h){v=h,n(4,v)}function ue(){l=this.value,n(1,l)}const fe=h=>p(h);return o.$$set=h=>{"placeholder"in h&&n(0,t=h.placeholder),"fetchSuggestions"in h&&n(13,s=h.fetchSuggestions)},[t,l,i,c,v,_,S,L,p,u,g,f,A,s,ce,ue,fe]}class Je extends oe{constructor(e){super(),ae(this,e,Ve,Me,le,{placeholder:0,fetchSuggestions:13})}}const B=["+","-","~"],Qe=o=>{const n=((B.indexOf(o)??2)+1)%B.length;return B[n]},se=()=>({last_sync:0,items:[]}),Ke=()=>{const{subscribe:o,set:e,update:n}=we(Ae.Supertags,se());return{subscribe:o,set:e,add(r){n(t=>(t.items.push(r),t))},remove(r){n(t=>(t.items=t.items.filter(s=>s.name!==r.name),t))},update(r,t){n(s=>{const l=s.items.findIndex(a=>a.name===r);return l!==-1&&(s.items[l]=t),s})},reset(){e(se())}}},Xe=Ke();export{Je as S,Qe as n,Xe as s};
