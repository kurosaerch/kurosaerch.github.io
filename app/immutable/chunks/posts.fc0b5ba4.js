import{f as g,r as m}from"./tags.49324235.js";import{g as u}from"./tag-type-data.934b5280.js";let i=new Map;const E=20;let l=null;const F=async(t,e)=>{const s=C(t,e),n=await g(s,l);c(n);try{const r=(await n.json()).map(h);return r.forEach(a=>{i.set(a.id,a)}),r}catch(o){return console.warn("Failed to get posts",o),[]}},M=async t=>{const e=await g(j(t),l);c(e);const s=await e.text(),o=new DOMParser().parseFromString(s,"text/xml"),r=Number(o.getElementsByTagName("posts")[0].getAttribute("count"));return I(r),r},W=async t=>{if(!i.has(t)){const s=new URL("https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&fields=tag_info&json=1");s.searchParams.append("id",String(t));const n=await fetch(s);c(n);const o=await n.json(),r=h(o[0]);i.set(r.id,r)}const e=i.get(t);if(e===void 0)throw new Error("Post cannot be undefined");return e},c=t=>{if(!t.ok)throw new Error(`getPage failed with http status ${t.status}`)},h=t=>{const e=t.height,s=t.score,n=t.preview_url,o=t.file_url,r=t.parent_id,a=t.sample_url,d=t.sample_width,w=t.sample_height,x=t.rating,p=t.tag_info,f=t.tags,b=t.id,_=t.width,P=t.change,y=t.comment_count,N=t.status,v=t.source;return{preview_url:n,sample_url:a,file_url:o,comment_count:Number(y),height:Number(e),id:Number(b),change:Number(P)*1e3,parent_id:r?Number(r):void 0,rating:x,sample_height:Number(w),sample_width:Number(d),score:Number(s),source:v,status:N,tags:p?$(p):U(f),width:Number(_),type:q(o)}},$=t=>t.map(A).sort(T),U=t=>t.split(" ").map(S),A=({tag:t,count:e,type:s})=>({name:m(t),count:e,type:s}),S=t=>({name:m(t),count:0,type:"ambiguous"}),T=(t,e)=>u(t.type)-u(e.type),C=(t,e)=>{const n=`https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&fields=tag_info&json=1&limit=${E}&pid=${t}`;return e===""?n:`${n}&tags=${e}`},j=t=>{const e="https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&limit=0";return t===""?e:`${e}&tags=${t}`},I=t=>{if(typeof t!="number")throw new Error("Unexpected response received in getPage")},q=t=>t.endsWith(".webm")||t.endsWith(".mp4")?"video":t.includes(".gif")?"gif":"image";export{F as a,M as b,C as c,W as g};
