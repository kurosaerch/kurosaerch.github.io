import{s as W,f as v,l as K,a as G,g as y,h as N,m as O,d as _,c as F,j as c,i as D,u as m,n as le,v as T,e as ke,H as ut,C as pt,N as q,G as M,I as Te,o as Ke,L as Oe,M as qe,p as fe,r as Xe,K as Be,S as Pe,T as Ve,J as Ne,k as ze,U as bt,F as Ze,R as vt,D as Me,P as yt,y as ye}from"./scheduler.19d3c358.js";import{S as H,i as J,a as C,g as we,c as Se,t as V,b as x,d as ee,m as te,e as se,f as Re,r as kt}from"./index.2b8f9697.js";import{b as De}from"./paths.01598d90.js";import{h as wt}from"./always-loop-store.b24079c8.js";import{h as Qe,u as St}from"./await_block.6b55c79b.js";import{e as Le}from"./each.e59479a4.js";import{L as Et}from"./LoadingAnimation.54d99227.js";import{f as Ye}from"./format-tag.7e313273.js";import{i as At}from"./tags.49324235.js";import{a as je}from"./active-tags-store.c78264f4.js";import{S as It}from"./SimpleTag.9c4d9db3.js";const Ct="https://api.rule34.xxx/index.php?page=dapi&s=comment&q=index&json=1",$e=async(s=void 0)=>{if(typeof s!="number"&&s!==void 0)throw new TypeError("Invalid postId");const e=new URL(Ct);s!==void 0&&e.searchParams.append("post_id",String(s));const t=await fetch(e);if(!t.ok)throw new Error("Failed to get tag suggestions");const n=await t.text(),i=new DOMParser().parseFromString(n,"text/xml"),r=[];for(const o of i.getElementsByTagName("comment"))r.push(Nt(o.attributes));return r},Nt=s=>{const e=s.getNamedItem("creator"),t=s.getNamedItem("created_at"),n=s.getNamedItem("body");if(e==null||t==null||n==null)throw new Error(`Failed to parse comment, attribute was null. ${e}, ${t}, ${n}`);return{author:e.value,createdAt:t.value,content:n.value}},xe=6e4,Ue=s=>{if(!Tt(s))throw new TypeError("Invalid createdAt passed to formatCreatedAt");const e=new Date(s).getTime()/xe,n=new Date().getTime()/xe-e;if(n<1)return"just now";if(n<60)return ve(n,"minute");const l=n/60;if(l<24)return ve(l,"hour");const i=l/24;if(i<7)return ve(i,"day");if(i<30.5)return ve(i/7,"week");if(i<365.25)return ve(i/30.5,"month");const r=i/365.25;return ve(r,"year")},Tt=s=>(typeof s=="number"||typeof s=="string")&&new Date(s).toString()!=="Invalid Date",ve=(s,e)=>{const t=s.toFixed();return`${t} ${e}${t==="1"?"":"s"} ago`};function Dt(s){let e,t,n=s[0].author+"",l,i,r,o=Ue(s[0].createdAt)+"",a,u,f,A=s[0].content+"",g;return{c(){e=v("div"),t=v("span"),l=K(n),i=G(),r=v("span"),a=K(o),u=G(),f=v("span"),g=K(A),this.h()},l(k){e=y(k,"DIV",{class:!0});var w=N(e);t=y(w,"SPAN",{class:!0});var I=N(t);l=O(I,n),I.forEach(_),i=F(w),r=y(w,"SPAN",{class:!0});var P=N(r);a=O(P,o),P.forEach(_),u=F(w),f=y(w,"SPAN",{class:!0});var b=N(f);g=O(b,A),b.forEach(_),w.forEach(_),this.h()},h(){c(t,"class","author svelte-bys59y"),c(r,"class","created-at svelte-bys59y"),c(f,"class","content svelte-bys59y"),c(e,"class","svelte-bys59y")},m(k,w){D(k,e,w),m(e,t),m(t,l),m(e,i),m(e,r),m(r,a),m(e,u),m(e,f),m(f,g)},p(k,[w]){w&1&&n!==(n=k[0].author+"")&&le(l,n),w&1&&o!==(o=Ue(k[0].createdAt)+"")&&le(a,o),w&1&&A!==(A=k[0].content+"")&&le(g,A)},i:T,o:T,d(k){k&&_(e)}}}function Pt(s,e,t){let{comment:n}=e;return s.$$set=l=>{"comment"in l&&t(0,n=l.comment)},[n]}class Vt extends H{constructor(e){super(),J(this,e,Pt,Dt,W,{comment:0})}}function Mt(s){let e,t=s[0].charAt(0).toUpperCase()+"",n,l;return{c(){e=v("span"),n=K(t),this.h()},l(i){e=y(i,"SPAN",{title:!0,class:!0});var r=N(e);n=O(r,t),r.forEach(_),this.h()},h(){c(e,"title",l="Rated "+s[0]+"."),c(e,"class","svelte-1nbj6kf")},m(i,r){D(i,e,r),m(e,n)},p(i,[r]){r&1&&t!==(t=i[0].charAt(0).toUpperCase()+"")&&le(n,t),r&1&&l!==(l="Rated "+i[0]+".")&&c(e,"title",l)},i:T,o:T,d(i){i&&_(e)}}}function Rt(s,e,t){let{value:n}=e;return s.$$set=l=>{"value"in l&&t(0,n=l.value)},[n]}class Lt extends H{constructor(e){super(),J(this,e,Rt,Mt,W,{value:0})}}function Ut(s){let e,t=Ue(s[0])+"",n;return{c(){e=v("span"),n=K(t),this.h()},l(l){e=y(l,"SPAN",{class:!0});var i=N(e);n=O(i,t),i.forEach(_),this.h()},h(){c(e,"class","svelte-1vqihm9")},m(l,i){D(l,e,i),m(e,n)},p(l,[i]){i&1&&t!==(t=Ue(l[0])+"")&&le(n,t)},i:T,o:T,d(l){l&&_(e)}}}function Gt(s,e,t){let{value:n}=e;return s.$$set=l=>{"value"in l&&t(0,n=l.value)},[n]}class Ft extends H{constructor(e){super(),J(this,e,Gt,Ut,W,{value:0})}}function jt(s){let e,t=Ye(s[0])+"",n;return{c(){e=v("span"),n=K(t),this.h()},l(l){e=y(l,"SPAN",{"data-testid":!0,class:!0});var i=N(e);n=O(i,t),i.forEach(_),this.h()},h(){c(e,"data-testid","score"),c(e,"class","codicon codicon-heart svelte-7y59vr")},m(l,i){D(l,e,i),m(e,n)},p(l,[i]){i&1&&t!==(t=Ye(l[0])+"")&&le(n,t)},i:T,o:T,d(l){l&&_(e)}}}function Bt(s,e,t){let{value:n}=e;return s.$$set=l=>{"value"in l&&t(0,n=l.value)},[n]}class zt extends H{constructor(e){super(),J(this,e,Bt,jt,W,{value:0})}}function et(s){let e,t,n,l,i;return{c(){e=v("a"),t=v("i"),n=G(),l=K(s[1]),this.h()},l(r){e=y(r,"A",{href:!0,target:!0,class:!0});var o=N(e);t=y(o,"I",{class:!0}),N(t).forEach(_),n=F(o),l=O(o,s[1]),o.forEach(_),this.h()},h(){c(t,"class","codicon codicon-link"),c(e,"href",i=s[0].toString()),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(r,o){D(r,e,o),m(e,t),m(e,n),m(e,l)},p(r,o){o&2&&le(l,r[1]),o&1&&i!==(i=r[0].toString())&&c(e,"href",i)},d(r){r&&_(e)}}}function Kt(s){let e,t=s[0]&&et(s);return{c(){t&&t.c(),e=ke()},l(n){t&&t.l(n),e=ke()},m(n,l){t&&t.m(n,l),D(n,e,l)},p(n,[l]){n[0]?t?t.p(n,l):(t=et(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:T,o:T,d(n){n&&_(e),t&&t.d(n)}}}function Ot(s,e,t){let n,l,{source:i}=e;return s.$$set=r=>{"source"in r&&t(2,i=r.source)},s.$$.update=()=>{var r;s.$$.dirty&4&&t(0,n=At(i)?new URL(i):null),s.$$.dirty&1&&t(1,l=(r=n==null?void 0:n.hostname)==null?void 0:r.replace(/^www./,""))},[n,l,i]}class qt extends H{constructor(e){super(),J(this,e,Ot,Kt,W,{source:2})}}function Wt(s){let e,t,n;return{c(){e=v("a"),t=v("i"),n=K(" Open"),this.h()},l(l){e=y(l,"A",{href:!0,target:!0,class:!0});var i=N(e);t=y(i,"I",{class:!0}),N(t).forEach(_),n=O(i," Open"),i.forEach(_),this.h()},h(){c(t,"class","codicon codicon-link-external"),c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(l,i){D(l,e,i),m(e,t),m(e,n)},p(l,[i]){i&1&&c(e,"href",l[0])},i:T,o:T,d(l){l&&_(e)}}}function Ht(s,e,t){let{url:n}=e;return s.$$set=l=>{"url"in l&&t(0,n=l.url)},[n]}class Jt extends H{constructor(e){super(),J(this,e,Ht,Wt,W,{url:0})}}function Xt(s){let e,t,n;return{c(){e=v("a"),t=v("i"),n=K(" File"),this.h()},l(l){e=y(l,"A",{href:!0,target:!0,class:!0});var i=N(e);t=y(i,"I",{class:!0}),N(t).forEach(_),n=O(i," File"),i.forEach(_),this.h()},h(){c(t,"class","codicon codicon-file"),c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(l,i){D(l,e,i),m(e,t),m(e,n)},p(l,[i]){i&1&&c(e,"href",l[0])},i:T,o:T,d(l){l&&_(e)}}}function Zt(s,e,t){let{url:n}=e;return s.$$set=l=>{"url"in l&&t(0,n=l.url)},[n]}class Qt extends H{constructor(e){super(),J(this,e,Zt,Xt,W,{url:0})}}function tt(s,e,t){const n=s.slice();n[4]=e[t];const l=n[1].find(function(...r){return s[3](n[4],...r)})!==void 0;return n[5]=l,n}function st(s){let e,t;function n(){return s[2](s[5],s[4])}return e=new It({props:{tag:s[4],active:s[5]}}),e.$on("click",n),{c(){x(e.$$.fragment)},l(l){ee(e.$$.fragment,l)},m(l,i){te(e,l,i),t=!0},p(l,i){s=l;const r={};i&1&&(r.tag=s[4]),i&3&&(r.active=s[5]),e.$set(r)},i(l){t||(C(e.$$.fragment,l),t=!0)},o(l){V(e.$$.fragment,l),t=!1},d(l){se(e,l)}}}function Yt(s){let e,t,n=Le(s[0]),l=[];for(let r=0;r<n.length;r+=1)l[r]=st(tt(s,n,r));const i=r=>V(l[r],1,1,()=>{l[r]=null});return{c(){e=v("ul");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=y(r,"UL",{class:!0});var o=N(e);for(let a=0;a<l.length;a+=1)l[a].l(o);o.forEach(_),this.h()},h(){c(e,"class","tags svelte-1gd63k6")},m(r,o){D(r,e,o);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null);t=!0},p(r,[o]){if(o&3){n=Le(r[0]);let a;for(a=0;a<n.length;a+=1){const u=tt(r,n,a);l[a]?(l[a].p(u,o),C(l[a],1)):(l[a]=st(u),l[a].c(),C(l[a],1),l[a].m(e,null))}for(we(),a=n.length;a<l.length;a+=1)i(a);Se()}},i(r){if(!t){for(let o=0;o<n.length;o+=1)C(l[o]);t=!0}},o(r){l=l.filter(Boolean);for(let o=0;o<l.length;o+=1)V(l[o]);t=!1},d(r){r&&_(e),ut(l,r)}}}function $t(s,e,t){let n;pt(s,je,o=>t(1,n=o));let{tags:l}=e;const i=(o,a)=>o?je.removeByName(a.name):je.addOrReplace({...a,modifier:"+"}),r=(o,a)=>a.name===o.name;return s.$$set=o=>{"tags"in o&&t(0,l=o.tags)},[l,n,i,r]}class xt extends H{constructor(e){super(),J(this,e,$t,Yt,W,{tags:0})}}const ft=s=>s.endsWith(".gif"),es=(s,e,t)=>ft(e)?{static:t,animated:e}:{static:e,animated:s},ht=s=>s.endsWith(".mp4")||s.endsWith(".webm"),Rs=(s,e,t)=>ht(e)?{static:t,animated:e}:{static:e,animated:s},Ls=s=>s.some(e=>e.name==="loop"),Us=s=>ft(s)||ht(s),_t=s=>(s==null?void 0:s.key)===" ",gt=s=>(s==null?void 0:s.key)==="Enter",dt=s=>{var e,t;gt(s)&&((t=(e=s.target)==null?void 0:e.click)==null||t.call(e))},ts="1250px",$=new IntersectionObserver(s=>{for(const e of s){const t=e.isIntersecting?e.target.getAttribute("data-src")??"":"";e.target.setAttribute("src",t)}},{rootMargin:ts});function ss(s){let e,t,n,l,i,r,o,a;return{c(){e=v("div"),t=v("img"),this.h()},l(u){e=y(u,"DIV",{class:!0});var f=N(e);t=y(f,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,style:!0,width:!0,height:!0,tabindex:!0}),f.forEach(_),this.h()},h(){c(t,"class","post-media svelte-dgcl67"),c(t,"loading","lazy"),c(t,"data-src",s[3]),c(t,"alt",n=s[0].id.toString()),c(t,"style",l=`aspect-ratio: ${s[0].width} / ${s[0].height}`),c(t,"width",i=s[0].width),c(t,"height",r=s[0].height),c(t,"tabindex","0"),c(e,"class","svelte-dgcl67"),q(e,"expandable",s[4]),q(e,"open",s[1])},m(u,f){D(u,e,f),m(e,t),s[7](t),o||(a=[M(t,"click",s[6]),M(t,"keydown",dt),M(t,"error",s[8])],o=!0)},p(u,[f]){f&8&&c(t,"data-src",u[3]),f&1&&n!==(n=u[0].id.toString())&&c(t,"alt",n),f&1&&l!==(l=`aspect-ratio: ${u[0].width} / ${u[0].height}`)&&c(t,"style",l),f&1&&i!==(i=u[0].width)&&c(t,"width",i),f&1&&r!==(r=u[0].height)&&c(t,"height",r),f&16&&q(e,"expandable",u[4]),f&2&&q(e,"open",u[1])},i:T,o:T,d(u){u&&_(e),s[7](null),o=!1,Te(a)}}}function ns(s,e,t){let n,l,i,{post:r}=e,{open:o}=e,a;Ke(()=>{$==null||$.observe(a)}),Oe(()=>{$==null||$.unobserve(a),t(2,a.src="",a)});function u(g){qe.call(this,s,g)}function f(g){fe[g?"unshift":"push"](()=>{a=g,t(2,a)})}const A=g=>g.target.src=`${De}/assets/failed-to-load.svg`;return s.$$set=g=>{"post"in g&&t(0,r=g.post),"open"in g&&t(1,o=g.open)},s.$$.update=()=>{s.$$.dirty&1&&t(5,n=r.width/r.height),s.$$.dirty&32&&t(4,l=n<.33),s.$$.dirty&1&&t(3,i=wt?r.file_url:r.sample_url)},[r,o,a,i,l,n,u,f,A]}class Gs extends H{constructor(e){super(),J(this,e,ns,ss,W,{post:0,open:1})}}const nt=s=>{if(typeof s!="number")throw new TypeError(`Attempted to call formatVideoTime with invalid value: ${s}`);const e=Math.floor(s),t=e%60,n=Math.floor(e/60);return`${lt(n)}:${lt(t)}`},lt=s=>{const e=String(s),t=Math.max(0,2-e.length);return`${"0".repeat(t)}${e}`};function ls(s){let e,t;return{c(){e=v("img"),this.h()},l(n){e=y(n,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),this.h()},h(){Ne(e.src,t=De+"/assets/play.svg")||c(e,"src",t),c(e,"alt","Start GIF"),c(e,"width","16"),c(e,"height","32"),ze(e,"margin-left","4px")},m(n,l){D(n,e,l)},d(n){n&&_(e)}}}function rs(s){let e,t;return{c(){e=v("img"),this.h()},l(n){e=y(n,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){Ne(e.src,t=De+"/assets/pause.svg")||c(e,"src",t),c(e,"alt","Stop GIF"),c(e,"width","16"),c(e,"height","32")},m(n,l){D(n,e,l)},d(n){n&&_(e)}}}function as(s){let e,t;return{c(){e=v("img"),this.h()},l(n){e=y(n,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){Ne(e.src,t=De+"/assets/load.svg")||c(e,"src",t),c(e,"alt","Loading GIF"),c(e,"width","16"),c(e,"height","32")},m(n,l){D(n,e,l)},d(n){n&&_(e)}}}function is(s){let e,t,n,l,i;function r(u,f){return u[1]?as:u[0]?rs:ls}let o=r(s),a=o(s);return{c(){e=v("button"),t=v("div"),a.c(),this.h()},l(u){e=y(u,"BUTTON",{class:!0});var f=N(e);t=y(f,"DIV",{class:!0});var A=N(t);a.l(A),A.forEach(_),f.forEach(_),this.h()},h(){c(t,"class","circle svelte-16x84bp"),c(e,"class",n=Xe(s[3].class)+" svelte-16x84bp"),q(e,"play",s[0]&&!s[1])},m(u,f){D(u,e,f),m(e,t),a.m(t,null),l||(i=M(e,"click",Be(s[2])),l=!0)},p(u,[f]){o!==(o=r(u))&&(a.d(1),a=o(u),a&&(a.c(),a.m(t,null))),f&8&&n!==(n=Xe(u[3].class)+" svelte-16x84bp")&&c(e,"class",n),f&11&&q(e,"play",u[0]&&!u[1])},i:T,o:T,d(u){u&&_(e),a.d(),l=!1,i()}}}function os(s,e,t){let{playing:n}=e,{loading:l}=e;const i=()=>{t(1,l=!0),t(0,n=!n)};return s.$$set=r=>{t(3,e=Pe(Pe({},e),Ve(r))),"playing"in r&&t(0,n=r.playing),"loading"in r&&t(1,l=r.loading)},e=Ve(e),[n,l,i,e]}class mt extends H{constructor(e){super(),J(this,e,os,is,W,{playing:0,loading:1})}}function rt(s){let e,t,n,l=!0,i=!1,r,o,a,u=nt(s[15])+"",f,A,g,k,w,I,P,b,h,j,z;function he(){cancelAnimationFrame(r),e.paused||(r=kt(he),i=!0),s[25].call(e)}function X(d){s[30](d)}function Z(d){s[31](d)}let re={class:"center"};return s[5]!==void 0&&(re.playing=s[5]),s[6]!==void 0&&(re.loading=s[6]),I=new mt({props:re}),fe.push(()=>Re(I,"playing",X)),fe.push(()=>Re(I,"loading",Z)),{c(){e=v("video"),o=G(),a=v("span"),f=K(u),A=G(),g=v("input"),w=G(),x(I.$$.fragment),this.h()},l(d){e=y(d,"VIDEO",{poster:!0,src:!0,preload:!0,style:!0,class:!0}),N(e).forEach(_),o=F(d),a=y(d,"SPAN",{class:!0});var E=N(a);f=O(E,u),E.forEach(_),A=F(d),g=y(d,"INPUT",{type:!0,min:!0,max:!0,step:!0,style:!0,class:!0}),w=F(d),ee(I.$$.fragment,d),this.h()},h(){c(e,"poster",s[1]),e.loop=s[4],Ne(e.src,t=s[0])||c(e,"src",t),c(e,"preload","metadata"),c(e,"style",n=`aspect-ratio: ${s[2]} / ${s[3]}`),c(e,"class","svelte-g134if"),s[8]===void 0&&bt(()=>s[26].call(e)),c(a,"class","svelte-g134if"),q(a,"hide",s[12]),c(g,"type","range"),c(g,"min",0),c(g,"max",s[8]),c(g,"step",.0166666),c(g,"style",k=`background-image: linear-gradient(90deg, var(--accent) ${s[13]}%, var(--background-2) ${s[13]}%);}`),c(g,"class","svelte-g134if"),q(g,"hide",s[12])},m(d,E){D(d,e,E),s[23](e),D(d,o,E),D(d,a,E),m(a,f),D(d,A,E),D(d,g,E),Ze(g,s[7]),D(d,w,E),te(I,d,E),h=!0,j||(z=[M(e,"play",s[24]),M(e,"pause",s[24]),M(e,"timeupdate",he),M(e,"durationchange",s[26]),M(e,"waiting",s[19]),M(e,"playing",s[20]),M(e,"pause",s[20]),M(e,"ended",s[27]),M(e,"dblclick",Be(vt(s[28]))),M(g,"change",s[29]),M(g,"input",s[29]),M(g,"click",Be(us))],j=!0)},p(d,E){(!h||E[0]&2)&&c(e,"poster",d[1]),(!h||E[0]&16)&&(e.loop=d[4]),(!h||E[0]&1&&!Ne(e.src,t=d[0]))&&c(e,"src",t),(!h||E[0]&12&&n!==(n=`aspect-ratio: ${d[2]} / ${d[3]}`))&&c(e,"style",n),E[0]&16384&&l!==(l=d[14])&&e[l?"pause":"play"](),!i&&E[0]&128&&!isNaN(d[7])&&(e.currentTime=d[7]),i=!1,(!h||E[0]&32768)&&u!==(u=nt(d[15])+"")&&le(f,u),(!h||E[0]&4096)&&q(a,"hide",d[12]),(!h||E[0]&256)&&c(g,"max",d[8]),(!h||E[0]&8192&&k!==(k=`background-image: linear-gradient(90deg, var(--accent) ${d[13]}%, var(--background-2) ${d[13]}%);}`))&&c(g,"style",k),E[0]&128&&Ze(g,d[7]),(!h||E[0]&4096)&&q(g,"hide",d[12]);const B={};!P&&E[0]&32&&(P=!0,B.playing=d[5],Me(()=>P=!1)),!b&&E[0]&64&&(b=!0,B.loading=d[6],Me(()=>b=!1)),I.$set(B)},i(d){h||(C(I.$$.fragment,d),h=!0)},o(d){V(I.$$.fragment,d),h=!1},d(d){d&&(_(e),_(o),_(a),_(A),_(g),_(w)),s[23](null),se(I,d),j=!1,Te(z)}}}function cs(s){let e,t,n,l,i,r=s[9]&&rt(s);return{c(){e=v("div"),r&&r.c(),this.h()},l(o){e=y(o,"DIV",{tabindex:!0,class:!0,style:!0});var a=N(e);r&&r.l(a),a.forEach(_),this.h()},h(){c(e,"tabindex","0"),c(e,"class",t="post-media player "+s[21].class+" svelte-g134if"),ze(e,"aspect-ratio",s[2]+"/"+s[3])},m(o,a){D(o,e,a),r&&r.m(e,null),s[32](e),n=!0,l||(i=[M(e,"click",s[22]),M(e,"keydown",s[18])],l=!0)},p(o,a){o[9]?r?(r.p(o,a),a[0]&512&&C(r,1)):(r=rt(o),r.c(),C(r,1),r.m(e,null)):r&&(we(),V(r,1,1,()=>{r=null}),Se()),(!n||a[0]&2097152&&t!==(t="post-media player "+o[21].class+" svelte-g134if"))&&c(e,"class",t),(!n||a[0]&12)&&ze(e,"aspect-ratio",o[2]+"/"+o[3])},i(o){n||(C(r),n=!0)},o(o){V(r),n=!1},d(o){o&&_(e),r&&r.d(),s[32](null),l=!1,Te(i)}}}const at=5,us=()=>{};function fs(s,e,t){let n,l,i,r,{src:o}=e,{poster:a}=e,{width:u}=e,{height:f}=e,{loop:A}=e,g,k,w=!1,I=!1,P=0,b=0,h=!1;const j=()=>{t(7,P=Math.max(0,P-at))},z=()=>{t(7,P=Math.min(b,P+at))},he=p=>{var oe;gt(p)?(oe=p.target)==null||oe.click():_t(p)||p.key==="k"?(p.preventDefault(),t(5,w=!w)):p.key==="ArrowLeft"||p.key==="j"?j():(p.key==="ArrowRight"||p.key==="l")&&z()},X=new IntersectionObserver(p=>{for(const oe of p)oe.isIntersecting?t(9,h=!0):k&&(t(5,w=!1),t(6,I=!1),k.addEventListener("error",()=>{t(9,h=!1)},{once:!0}),t(11,k.src="",k))},{rootMargin:"0px"}),Z=()=>t(6,I=!0),re=()=>t(6,I=!1);Ke(()=>X==null?void 0:X.observe(g)),Oe(()=>{X==null||X.unobserve(g),t(11,k.src="",k)});function d(p){qe.call(this,s,p)}function E(p){fe[p?"unshift":"push"](()=>{k=p,t(11,k)})}function B(){l=this.paused,t(14,l),t(5,w),t(9,h)}function ae(){P=this.currentTime,t(7,P)}function _e(){b=this.duration,t(8,b)}const pe=()=>{A||(t(6,I=!1),t(5,w=!1))},Ee=p=>{p.offsetX<p.target.clientWidth/2?j():z()};function Ae(){P=yt(this.value),t(7,P)}function ne(p){w=p,t(5,w),t(9,h)}function ie(p){I=p,t(6,I)}function ge(p){fe[p?"unshift":"push"](()=>{g=p,t(10,g)})}return s.$$set=p=>{t(21,e=Pe(Pe({},e),Ve(p))),"src"in p&&t(0,o=p.src),"poster"in p&&t(1,a=p.poster),"width"in p&&t(2,u=p.width),"height"in p&&t(3,f=p.height),"loop"in p&&t(4,A=p.loop)},s.$$.update=()=>{s.$$.dirty[0]&384&&t(15,n=b-P),s.$$.dirty[0]&544&&t(5,w=h&&w),s.$$.dirty[0]&32&&t(14,l=!w),s.$$.dirty[0]&384&&t(13,i=P/b*98+1),s.$$.dirty[0]&96&&t(12,r=w&&!I)},e=Ve(e),[o,a,u,f,A,w,I,P,b,h,g,k,r,i,l,n,j,z,he,Z,re,e,d,E,B,ae,_e,pe,Ee,Ae,ne,ie,ge]}class Fs extends H{constructor(e){super(),J(this,e,fs,cs,W,{src:0,poster:1,width:2,height:3,loop:4},null,[-1,-1])}}function hs(s){let e,t,n,l,i,r,o,a,u,f,A,g,k;function w(b){s[13](b)}function I(b){s[14](b)}let P={class:"center"};return s[2]!==void 0&&(P.playing=s[2]),s[3]!==void 0&&(P.loading=s[3]),o=new mt({props:P}),fe.push(()=>Re(o,"playing",w)),fe.push(()=>Re(o,"loading",I)),{c(){e=v("div"),t=v("img"),r=G(),x(o.$$.fragment),this.h()},l(b){e=y(b,"DIV",{class:!0,style:!0});var h=N(e);t=y(h,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,width:!0,height:!0,tabindex:!0}),r=F(h),ee(o.$$.fragment,h),h.forEach(_),this.h()},h(){c(t,"class","post-media media-img svelte-1cndgba"),c(t,"loading","lazy"),c(t,"data-src",s[4]),c(t,"alt",n=s[0].id.toString()),c(t,"width",l=s[0].width),c(t,"height",i=s[0].height),c(t,"tabindex","0"),c(e,"class","container svelte-1cndgba"),c(e,"style",f=`aspect-ratio: ${s[0].width} / ${s[0].height}`)},m(b,h){D(b,e,h),m(e,t),s[9](t),m(e,r),te(o,e,null),A=!0,g||(k=[M(t,"click",s[8]),M(t,"keydown",s[10]),M(t,"load",s[11]),M(t,"error",s[12])],g=!0)},p(b,[h]){(!A||h&16)&&c(t,"data-src",b[4]),(!A||h&1&&n!==(n=b[0].id.toString()))&&c(t,"alt",n),(!A||h&1&&l!==(l=b[0].width))&&c(t,"width",l),(!A||h&1&&i!==(i=b[0].height))&&c(t,"height",i);const j={};!a&&h&4&&(a=!0,j.playing=b[2],Me(()=>a=!1)),!u&&h&8&&(u=!0,j.loading=b[3],Me(()=>u=!1)),o.$set(j),(!A||h&1&&f!==(f=`aspect-ratio: ${b[0].width} / ${b[0].height}`))&&c(e,"style",f)},i(b){A||(C(o.$$.fragment,b),A=!0)},o(b){V(o.$$.fragment,b),A=!1},d(b){b&&_(e),s[9](null),se(o),g=!1,Te(k)}}}function _s(s,e,t){let n,l,i,r,{post:o}=e,a,u=!1,f=!1;Ke(()=>$==null?void 0:$.observe(a)),Oe(()=>{$==null||$.unobserve(a),t(1,a.src="",a)});function A(h){qe.call(this,s,h)}function g(h){fe[h?"unshift":"push"](()=>{a=h,t(1,a),t(2,u),t(6,l),t(5,i),t(7,n),t(0,o)})}const k=h=>{dt(h),_t(h)&&(h.preventDefault(),t(3,f=!0),t(2,u=!u))},w=()=>t(3,f=!1),I=h=>{t(3,f=!1),h.target.src=`${De}/assets/failed-to-load.svg`};function P(h){u=h,t(2,u)}function b(h){f=h,t(3,f)}return s.$$set=h=>{"post"in h&&t(0,o=h.post)},s.$$.update=()=>{s.$$.dirty&1&&t(7,n=es(o.file_url,o.sample_url,o.preview_url)),s.$$.dirty&128&&t(6,l=n.animated),s.$$.dirty&128&&t(5,i=n.static),s.$$.dirty&100&&t(4,r=u?l:i),s.$$.dirty&102&&a&&t(1,a.src=u?l:i,a)},[o,a,u,f,r,i,l,n,A,g,k,w,I,P,b]}class js extends H{constructor(e){super(),J(this,e,_s,hs,W,{post:0})}}function it(s,e,t){const n=s.slice();return n[6]=e[t],n}function ot(s){let e,t="•",n,l,i;return l=new qt({props:{source:s[0].source}}),{c(){e=v("span"),e.textContent=t,n=G(),x(l.$$.fragment),this.h()},l(r){e=y(r,"SPAN",{class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-7hh8jk"&&(e.textContent=t),n=F(r),ee(l.$$.fragment,r),this.h()},h(){c(e,"class","svelte-188brre")},m(r,o){D(r,e,o),D(r,n,o),te(l,r,o),i=!0},p(r,o){const a={};o&1&&(a.source=r[0].source),l.$set(a)},i(r){i||(C(l.$$.fragment,r),i=!0)},o(r){V(l.$$.fragment,r),i=!1},d(r){r&&(_(e),_(n)),se(l,r)}}}function gs(s){let e,t,n,l={ctx:s,current:null,token:null,hasCatch:!1,pending:ys,then:ps,catch:ms,value:5,blocks:[,,,]};return Qe(t=$e(s[0].id),l),{c(){e=ke(),l.block.c()},l(i){e=ke(),l.block.l(i)},m(i,r){D(i,e,r),l.block.m(i,l.anchor=r),l.mount=()=>e.parentNode,l.anchor=e,n=!0},p(i,r){s=i,l.ctx=s,r&1&&t!==(t=$e(s[0].id))&&Qe(t,l)||St(l,s,r)},i(i){n||(C(l.block),n=!0)},o(i){for(let r=0;r<3;r+=1){const o=l.blocks[r];V(o)}n=!1},d(i){i&&_(e),l.block.d(i),l.token=null,l=null}}}function ds(s){let e,t;return e=new xt({props:{tags:s[0].tags}}),{c(){x(e.$$.fragment)},l(n){ee(e.$$.fragment,n)},m(n,l){te(e,n,l),t=!0},p(n,l){const i={};l&1&&(i.tags=n[0].tags),e.$set(i)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ms(s){return{c:T,l:T,m:T,p:T,i:T,o:T,d:T}}function ps(s){let e,t,n,l;const i=[vs,bs],r=[];function o(a,u){return a[5].length>0?0:1}return e=o(s),t=r[e]=i[e](s),{c(){t.c(),n=ke()},l(a){t.l(a),n=ke()},m(a,u){r[e].m(a,u),D(a,n,u),l=!0},p(a,u){let f=e;e=o(a),e===f?r[e].p(a,u):(we(),V(r[f],1,1,()=>{r[f]=null}),Se(),t=r[e],t?t.p(a,u):(t=r[e]=i[e](a),t.c()),C(t,1),t.m(n.parentNode,n))},i(a){l||(C(t),l=!0)},o(a){V(t),l=!1},d(a){a&&_(n),r[e].d(a)}}}function bs(s){let e,t="Comments for this post are not available";return{c(){e=v("span"),e.textContent=t,this.h()},l(n){e=y(n,"SPAN",{class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-4t2lxe"&&(e.textContent=t),this.h()},h(){c(e,"class","no-comments svelte-188brre")},m(n,l){D(n,e,l)},p:T,i:T,o:T,d(n){n&&_(e)}}}function vs(s){let e,t,n=Le(s[5]),l=[];for(let r=0;r<n.length;r+=1)l[r]=ct(it(s,n,r));const i=r=>V(l[r],1,1,()=>{l[r]=null});return{c(){e=v("ul");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=y(r,"UL",{class:!0});var o=N(e);for(let a=0;a<l.length;a+=1)l[a].l(o);o.forEach(_),this.h()},h(){c(e,"class","comments svelte-188brre")},m(r,o){D(r,e,o);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null);t=!0},p(r,o){if(o&1){n=Le(r[5]);let a;for(a=0;a<n.length;a+=1){const u=it(r,n,a);l[a]?(l[a].p(u,o),C(l[a],1)):(l[a]=ct(u),l[a].c(),C(l[a],1),l[a].m(e,null))}for(we(),a=n.length;a<l.length;a+=1)i(a);Se()}},i(r){if(!t){for(let o=0;o<n.length;o+=1)C(l[o]);t=!0}},o(r){l=l.filter(Boolean);for(let o=0;o<l.length;o+=1)V(l[o]);t=!1},d(r){r&&_(e),ut(l,r)}}}function ct(s){let e,t;return e=new Vt({props:{comment:s[6]}}),{c(){x(e.$$.fragment)},l(n){ee(e.$$.fragment,n)},m(n,l){te(e,n,l),t=!0},p(n,l){const i={};l&1&&(i.comment=n[6]),e.$set(i)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ys(s){let e,t;return e=new Et({}),{c(){x(e.$$.fragment)},l(n){ee(e.$$.fragment,n)},m(n,l){te(e,n,l),t=!0},p:T,i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ks(s){let e,t,n,l,i,r="•",o,a,u,f,A="•",g,k,w,I,P="•",b,h,j,z,he="•",X,Z,re,d,E,B,ae,_e=s[0].tags.length+"",pe,Ee,Ae,ne,ie,ge=(s[0].comment_count||"No")+"",p,oe,Ge,Q,Y,ce,Fe,We;n=new Lt({props:{value:s[0].rating}}),a=new zt({props:{value:s[0].score}}),k=new Ft({props:{value:s[0].change}}),h=new Jt({props:{url:"/post?id="+s[0].id+"&src="+encodeURIComponent(s[2])}}),Z=new Qt({props:{url:s[2]}});let U=s[0].source&&ot(s);const He=[ds,gs],ue=[];function Je(S,R){return S[1]==="tags"?0:1}return Q=Je(s),Y=ue[Q]=He[Q](s),{c(){e=v("div"),t=v("div"),x(n.$$.fragment),l=G(),i=v("span"),i.textContent=r,o=G(),x(a.$$.fragment),u=G(),f=v("span"),f.textContent=A,g=G(),x(k.$$.fragment),w=G(),I=v("span"),I.textContent=P,b=G(),x(h.$$.fragment),j=G(),z=v("span"),z.textContent=he,X=G(),x(Z.$$.fragment),re=G(),U&&U.c(),d=G(),E=v("div"),B=v("button"),ae=v("span"),pe=K(_e),Ee=K(" tags"),Ae=G(),ne=v("button"),ie=v("span"),p=K(ge),oe=K(" comments"),Ge=G(),Y.c(),this.h()},l(S){e=y(S,"DIV",{class:!0});var R=N(e);t=y(R,"DIV",{class:!0});var L=N(t);ee(n.$$.fragment,L),l=F(L),i=y(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(i)!=="svelte-7hh8jk"&&(i.textContent=r),o=F(L),ee(a.$$.fragment,L),u=F(L),f=y(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(f)!=="svelte-7hh8jk"&&(f.textContent=A),g=F(L),ee(k.$$.fragment,L),w=F(L),I=y(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(I)!=="svelte-7hh8jk"&&(I.textContent=P),b=F(L),ee(h.$$.fragment,L),j=F(L),z=y(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(z)!=="svelte-7hh8jk"&&(z.textContent=he),X=F(L),ee(Z.$$.fragment,L),re=F(L),U&&U.l(L),L.forEach(_),d=F(R),E=y(R,"DIV",{class:!0});var de=N(E);B=y(de,"BUTTON",{class:!0});var Ie=N(B);ae=y(Ie,"SPAN",{class:!0});var be=N(ae);pe=O(be,_e),Ee=O(be," tags"),be.forEach(_),Ie.forEach(_),Ae=F(de),ne=y(de,"BUTTON",{class:!0});var Ce=N(ne);ie=y(Ce,"SPAN",{class:!0});var me=N(ie);p=O(me,ge),oe=O(me," comments"),me.forEach(_),Ce.forEach(_),de.forEach(_),Ge=F(R),Y.l(R),R.forEach(_),this.h()},h(){c(i,"class","svelte-188brre"),c(f,"class","svelte-188brre"),c(I,"class","svelte-188brre"),c(z,"class","svelte-188brre"),c(t,"class","summary svelte-188brre"),c(ae,"class","svelte-188brre"),c(B,"class","codicon codicon-tag svelte-188brre"),q(B,"active",s[1]==="tags"),c(ie,"class","svelte-188brre"),c(ne,"class","codicon codicon-comment-discussion svelte-188brre"),q(ne,"active",s[1]==="comments"),c(E,"class","tabs svelte-188brre"),c(e,"class","details svelte-188brre")},m(S,R){D(S,e,R),m(e,t),te(n,t,null),m(t,l),m(t,i),m(t,o),te(a,t,null),m(t,u),m(t,f),m(t,g),te(k,t,null),m(t,w),m(t,I),m(t,b),te(h,t,null),m(t,j),m(t,z),m(t,X),te(Z,t,null),m(t,re),U&&U.m(t,null),m(e,d),m(e,E),m(E,B),m(B,ae),m(ae,pe),m(ae,Ee),m(E,Ae),m(E,ne),m(ne,ie),m(ie,p),m(ie,oe),m(e,Ge),ue[Q].m(e,null),ce=!0,Fe||(We=[M(B,"click",s[3]),M(ne,"click",s[4])],Fe=!0)},p(S,[R]){const L={};R&1&&(L.value=S[0].rating),n.$set(L);const de={};R&1&&(de.value=S[0].score),a.$set(de);const Ie={};R&1&&(Ie.value=S[0].change),k.$set(Ie);const be={};R&5&&(be.url="/post?id="+S[0].id+"&src="+encodeURIComponent(S[2])),h.$set(be);const Ce={};R&4&&(Ce.url=S[2]),Z.$set(Ce),S[0].source?U?(U.p(S,R),R&1&&C(U,1)):(U=ot(S),U.c(),C(U,1),U.m(t,null)):U&&(we(),V(U,1,1,()=>{U=null}),Se()),(!ce||R&1)&&_e!==(_e=S[0].tags.length+"")&&le(pe,_e),(!ce||R&2)&&q(B,"active",S[1]==="tags"),(!ce||R&1)&&ge!==(ge=(S[0].comment_count||"No")+"")&&le(p,ge),(!ce||R&2)&&q(ne,"active",S[1]==="comments");let me=Q;Q=Je(S),Q===me?ue[Q].p(S,R):(we(),V(ue[me],1,1,()=>{ue[me]=null}),Se(),Y=ue[Q],Y?Y.p(S,R):(Y=ue[Q]=He[Q](S),Y.c()),C(Y,1),Y.m(e,null))},i(S){ce||(C(n.$$.fragment,S),C(a.$$.fragment,S),C(k.$$.fragment,S),C(h.$$.fragment,S),C(Z.$$.fragment,S),C(U),C(Y),ce=!0)},o(S){V(n.$$.fragment,S),V(a.$$.fragment,S),V(k.$$.fragment,S),V(h.$$.fragment,S),V(Z.$$.fragment,S),V(U),V(Y),ce=!1},d(S){S&&_(e),se(n),se(a),se(k),se(h),se(Z),U&&U.d(),ue[Q].d(),Fe=!1,Te(We)}}}function ws(s,e,t){let n,{post:l}=e,i="tags";const r=()=>{t(1,i="tags")},o=()=>{t(1,i="comments")};return s.$$set=a=>{"post"in a&&t(0,l=a.post)},s.$$.update=()=>{s.$$.dirty&1&&t(2,n=l.file_url)},[l,i,n,r,o]}class Bs extends H{constructor(e){super(),J(this,e,ws,ks,W,{post:0})}}export{Vt as C,Bs as D,qt as E,js as G,Gs as I,Jt as K,xt as P,Lt as R,zt as S,Fs as V,Ft as a,Qt as b,es as c,Rs as d,gt as e,Ls as f,$e as g,Us as i};
