var x=Object.defineProperty;var tt=(s,t,r)=>t in s?x(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var d=(s,t,r)=>(tt(s,typeof t!="symbol"?t+"":t,r),r);import{s as M,f as y,U as et,g as w,h as P,V as st,d as m,j as _,r as E,i as b,v as $,u as rt,F as nt,M as it,E as ot,a as O,e as T,c as R,P as at}from"./scheduler.88299003.js";import{S as q,i as z,a as g,g as k,t as p,c as S,b as v,d as D,m as B,e as V}from"./index.15b414ac.js";import{e as K}from"./each.e59479a4.js";import{D as Y}from"./DetailedTag.28ff9b0d.js";import{s as N,b as lt,c as ct,d as ut}from"./posts.e3ad19e2.js";import{S as j}from"./store-keys.5b62d166.js";import{B as ht}from"./blocked-content-store.8cb9d99a.js";function ft(s){let t,r;return{c(){t=y("h1"),r=new et(!1),this.h()},l(e){t=w(e,"H1",{class:!0});var o=P(t);r=st(o,!1),o.forEach(m),this.h()},h(){r.a=null,_(t,"class",E(s[1])+" svelte-1jtyohl")},m(e,o){b(e,t,o),r.m(s[0],t)},p:$,i:$,o:$,d(e){e&&m(t)}}}function gt(s){const t=new Date,r=n=>{const u=`${n.getDate()}-${n.getMonth()}`;return u==="24-12"||u==="25-12"?"kurðŸŽ…search":"kurosearch"},e=n=>n.getMonth()===5?"pride":"default",o=r(t),i=e(t);return[o,i]}class It extends q{constructor(t){super(),z(this,t,gt,ft,M,{})}}function pt(s){let t,r,e,o,i;return{c(){t=y("button"),r=y("i"),this.h()},l(n){t=w(n,"BUTTON",{title:!0,class:!0});var u=P(t);r=w(u,"I",{class:!0}),P(r).forEach(m),u.forEach(m),this.h()},h(){_(r,"class",e=E(s[1])+" svelte-c0182g"),_(t,"title",s[0]),_(t,"class","svelte-c0182g")},m(n,u){b(n,t,u),rt(t,r),o||(i=nt(t,"click",s[2]),o=!0)},p(n,[u]){u&2&&e!==(e=E(n[1])+" svelte-c0182g")&&_(r,"class",e),u&1&&_(t,"title",n[0])},i:$,o:$,d(n){n&&m(t),o=!1,i()}}}function dt(s,t,r){let{title:e}=t,{icon:o}=t;function i(n){it.call(this,s,n)}return s.$$set=n=>{"title"in n&&r(0,e=n.title),"icon"in n&&r(1,o=n.icon)},[e,o,i]}class Z extends q{constructor(t){super(),z(this,t,dt,pt,M,{title:0,icon:1})}}function U(s,t,r){const e=s.slice();return e[8]=t[r],e}function F(s){let t,r,e,o,i=K(s[0]),n=[];for(let a=0;a<i.length;a+=1)n[a]=L(U(s,i,a));const u=a=>p(n[a],1,1,()=>{n[a]=null});let l=s[0].length>0&&G(s),h=s[0].length>1&&H(s);return{c(){for(let a=0;a<n.length;a+=1)n[a].c();t=O(),l&&l.c(),r=O(),h&&h.c(),e=T()},l(a){for(let c=0;c<n.length;c+=1)n[c].l(a);t=R(a),l&&l.l(a),r=R(a),h&&h.l(a),e=T()},m(a,c){for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(a,c);b(a,t,c),l&&l.m(a,c),b(a,r,c),h&&h.m(a,c),b(a,e,c),o=!0},p(a,c){if(c&3){i=K(a[0]);let f;for(f=0;f<i.length;f+=1){const I=U(a,i,f);n[f]?(n[f].p(I,c),g(n[f],1)):(n[f]=L(I),n[f].c(),g(n[f],1),n[f].m(t.parentNode,t))}for(k(),f=i.length;f<n.length;f+=1)u(f);S()}a[0].length>0?l?(l.p(a,c),c&1&&g(l,1)):(l=G(a),l.c(),g(l,1),l.m(r.parentNode,r)):l&&(k(),p(l,1,1,()=>{l=null}),S()),a[0].length>1?h?(h.p(a,c),c&1&&g(h,1)):(h=H(a),h.c(),g(h,1),h.m(e.parentNode,e)):h&&(k(),p(h,1,1,()=>{h=null}),S())},i(a){if(!o){for(let c=0;c<i.length;c+=1)g(n[c]);g(l),g(h),o=!0}},o(a){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)p(n[c]);p(l),p(h),o=!1},d(a){a&&(m(t),m(r),m(e)),at(n,a),l&&l.d(a),h&&h.d(a)}}}function mt(s){let t,r;function e(){return s[4](s[8])}function o(){return s[5](s[8])}return t=new Y({props:{tag:s[8],active:!0}}),t.$on("click",e),t.$on("contextmenu",o),{c(){v(t.$$.fragment)},l(i){D(t.$$.fragment,i)},m(i,n){B(t,i,n),r=!0},p(i,n){s=i;const u={};n&1&&(u.tag=s[8]),t.$set(u)},i(i){r||(g(t.$$.fragment,i),r=!0)},o(i){p(t.$$.fragment,i),r=!1},d(i){V(t,i)}}}function _t(s){let t,r;function e(){return s[2](s[8])}function o(){return s[3](s[8])}return t=new Y({props:{tag:{name:s[8].name,type:"supertag",modifier:"+",count:s[8].tags.length},active:!0}}),t.$on("click",e),t.$on("contextmenu",o),{c(){v(t.$$.fragment)},l(i){D(t.$$.fragment,i)},m(i,n){B(t,i,n),r=!0},p(i,n){s=i;const u={};n&1&&(u.tag={name:s[8].name,type:"supertag",modifier:"+",count:s[8].tags.length}),t.$set(u)},i(i){r||(g(t.$$.fragment,i),r=!0)},o(i){p(t.$$.fragment,i),r=!1},d(i){V(t,i)}}}function L(s){let t,r,e,o;const i=[_t,mt],n=[];function u(l,h){return"description"in l[8]?0:1}return t=u(s),r=n[t]=i[t](s),{c(){r.c(),e=T()},l(l){r.l(l),e=T()},m(l,h){n[t].m(l,h),b(l,e,h),o=!0},p(l,h){let a=t;t=u(l),t===a?n[t].p(l,h):(k(),p(n[a],1,1,()=>{n[a]=null}),S(),r=n[t],r?r.p(l,h):(r=n[t]=i[t](l),r.c()),g(r,1),r.m(e.parentNode,e))},i(l){o||(g(r),o=!0)},o(l){p(r),o=!1},d(l){l&&m(e),n[t].d(l)}}}function G(s){let t,r;return t=new Z({props:{icon:"codicon codicon-copy",title:"Share this search with others."}}),t.$on("click",s[6]),{c(){v(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,o){B(t,e,o),r=!0},p:$,i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){p(t.$$.fragment,e),r=!1},d(e){V(t,e)}}}function H(s){let t,r;return t=new Z({props:{icon:"codicon codicon-star-full",title:"Create a supertag from the current selection."}}),t.$on("click",s[7]),{c(){v(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,o){B(t,e,o),r=!0},p:$,i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){p(t.$$.fragment,e),r=!1},d(e){V(t,e)}}}function bt(s){let t,r,e=s[0].length>0&&F(s);return{c(){t=y("ul"),e&&e.c(),this.h()},l(o){t=w(o,"UL",{class:!0});var i=P(t);e&&e.l(i),i.forEach(m),this.h()},h(){_(t,"class","svelte-11k0uwj")},m(o,i){b(o,t,i),e&&e.m(t,null),r=!0},p(o,[i]){o[0].length>0?e?(e.p(o,i),i&1&&g(e,1)):(e=F(o),e.c(),g(e,1),e.m(t,null)):e&&(k(),p(e,1,1,()=>{e=null}),S())},i(o){r||(g(e),r=!0)},o(o){p(e),r=!1},d(o){o&&m(t),e&&e.d()}}}function $t(s,t,r){const e=ot();let{tags:o}=t;const i=c=>e("click",c),n=c=>e("contextmenu",c),u=c=>e("click",c),l=c=>e("contextmenu",c),h=()=>e("copy"),a=()=>e("createSupertag",o);return s.$$set=c=>{"tags"in c&&r(0,o=c.tags)},[o,e,i,n,u,l,h,a]}class Ot extends q{constructor(t){super(),z(this,t,$t,bt,M,{tags:0})}}const J=()=>({posts:[],pageCount:0,ids:new Set,postCount:0,requested:!1}),kt=s=>JSON.stringify({posts:s.posts,pageCount:s.pageCount,ids:[...s.ids.values()],postCount:s.postCount,requested:s.requested}),St=s=>{const t=JSON.parse(s);return{posts:t.posts,pageCount:t.pageCount,ids:new Set(t.ids),postCount:t.postCount,requested:t.requested}},Ct=()=>{const{subscribe:s,update:t,set:r}=N(j.Results,J(),kt,St);return{subscribe:s,addPage(e,o=void 0){t(i=>{const n=e.filter(u=>!i.ids.has(u.id));return n.forEach(u=>i.ids.add(u.id)),{posts:[...i.posts,...n],pageCount:i.pageCount+1,ids:i.ids,postCount:o??i.postCount,requested:!0}})},reset(){r(J())}}},Rt=Ct(),Q=()=>({property:"id",direction:"desc"}),yt=()=>{const{subscribe:s,set:t,update:r}=N(j.Sort,Q());return{subscribe:s,set:t,update(e){r(o=>({...o,...e}))},reset(){t(Q())}}},Kt=yt(),W=()=>({scoreValue:0,scoreComparator:">=",rating:"all"}),wt=()=>{const{subscribe:s,set:t,update:r}=N(j.Filter,W());return{subscribe:s,set(e){t({...e,scoreValue:e.scoreValue??0})},update(e){r(o=>({...o,...e}))},reset(){t(W())}}},Ut=wt(),Pt=()=>{const{subscribe:s,update:t,set:r}=N(j.ActiveSupertags,[]);return{subscribe:s,set:r,addOrReplace:e=>t(o=>{const i=o.findIndex(n=>n.name===e.name);return i===-1?o.push(e):o[i]=e,o}),removeByName:e=>t(o=>{const i=o.findIndex(n=>n.name===e);return o.splice(i,1),o}),reset:()=>r([])}},Ft=Pt(),Tt=s=>s==="-"?"-":"",vt=s=>s.replaceAll(" ","_"),Dt=s=>`${Tt(s.modifier)}${vt(s.name)}`,A=s=>{const t=Bt(s);let r=[...X([...t["+"],...t["-"]])];return t["~"].length>0&&r.push(`( ${X(t["~"]).join(" ~ ")} )`),r.join("+")},C=(s,t,r,e,o,i,n,u)=>{const l=[`sort:${t}:${r}`];if((e!==0||i!==">=")&&l.push(`score:${i}${e}`),o!=="all"&&l.push(`rating:${o}`),s.length>0&&l.push(A(s)),u.length>0){const a=u.map(c=>A(c.tags)).join("+");l.push(a)}if(n.length>0){const a=n.flatMap(f=>ht[f]).map(f=>({modifier:"-",name:f})),c=A(a);l.push(c)}return l.join("+")},X=s=>s.map(Dt),Bt=s=>{const t={"+":[],"-":[],"~":[]};return s.forEach(r=>t[r.modifier].push(r)),t};class Lt{constructor(){d(this,"pid");d(this,"tags");d(this,"supertags");d(this,"blockedContent");d(this,"sortProperty");d(this,"sortDirection");d(this,"scoreValue");d(this,"rating");d(this,"scoreComparator");d(this,"tagString");this.pid=0,this.tags=[],this.supertags=[],this.blockedContent=[],this.sortProperty="id",this.sortDirection="desc",this.scoreValue=0,this.rating="all",this.scoreComparator=">="}withPid(t){return this.pid=t,this}withTags(t){return this.tags=t,this}withSupertags(t){return this.supertags=t,this}withSortProperty(t){return this.sortProperty=t,this}withSortDirection(t){return this.sortDirection=t,this}withScoreValue(t){return this.scoreValue=t,this}withScoreComparator(t){return this.scoreComparator=t,this}withRating(t){return this.rating=t,this}withBlockedContent(t){return this.blockedContent=Object.entries(t).filter(([r,e])=>e).map(([r,e])=>r),this}async getPageAndCount(){return this.tagString=C(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags),Promise.all([this.getPage(),this.getCount()])}async getPage(){return this.tagString||(this.tagString=C(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),lt(this.pid,this.tagString)}async getCount(){return this.tagString||(this.tagString=C(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),ct(this.tagString)}getQuery(){return this.tagString||(this.tagString=C(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),ut(0,this.tagString)}}export{Ot as A,It as K,Lt as S,Ft as a,Ut as f,Rt as r,Kt as s};
