import{s as W,f as y,l as K,a as F,g as k,h as T,m as O,d as h,c as j,j as c,i as P,u as d,n as le,v as D,e as ke,G as _t,C as Fe,N as q,F as M,H as Te,o as qe,K as We,M as He,p as fe,r as Ye,J as Ke,S as Pe,T as Ue,I as Ne,k as Oe,U as yt,E as $e,R as kt,L as Ve,P as wt,y as ye}from"./scheduler.32f194ce.js";import{S as H,i as J,a as N,g as we,c as Se,t as V,b as x,d as ee,m as te,e as se,f as Me,r as St}from"./index.aa0a4971.js";import{b as De}from"./paths.ca3da844.js";import{i as Je,h as Et}from"./always-loop-store.7008ae9e.js";import{i as At,r as Re}from"./tags.b027a74d.js";import{h as xe,u as It}from"./await_block.af8be678.js";import{e as Le}from"./each.e59479a4.js";import{L as Ct}from"./LoadingAnimation.1752780f.js";import{f as et}from"./format-tag.7e313273.js";import{a as ze}from"./active-tags-store.d23316a6.js";import{S as Nt}from"./SimpleTag.4f811b70.js";const Tt="https://api.rule34.xxx/index.php?page=dapi&s=comment&q=index&json=1",tt=async(s=void 0)=>{if(typeof s!="number"&&s!==void 0)throw new TypeError("Invalid postId");const e=new URL(Tt);s!==void 0&&e.searchParams.append("post_id",String(s));const t=await fetch(e);if(!t.ok)throw new Error("Failed to get tag suggestions");const n=await t.text(),a=new DOMParser().parseFromString(n,"text/xml"),r=[];for(const o of a.getElementsByTagName("comment"))r.push(Dt(o.attributes));return r},Dt=s=>{const e=s.getNamedItem("creator"),t=s.getNamedItem("created_at"),n=s.getNamedItem("body");if(e==null||t==null||n==null)throw new Error(`Failed to parse comment, attribute was null. ${e}, ${t}, ${n}`);return{author:e.value,createdAt:t.value,content:n.value}},st=6e4,Ge=s=>{if(!Pt(s))throw new TypeError("Invalid createdAt passed to formatCreatedAt");const e=new Date(s).getTime()/st,n=new Date().getTime()/st-e;if(n<1)return"just now";if(n<60)return ve(n,"minute");const l=n/60;if(l<24)return ve(l,"hour");const a=l/24;if(a<7)return ve(a,"day");if(a<30.5)return ve(a/7,"week");if(a<365.25)return ve(a/30.5,"month");const r=a/365.25;return ve(r,"year")},Pt=s=>(typeof s=="number"||typeof s=="string")&&new Date(s).toString()!=="Invalid Date",ve=(s,e)=>{const t=s.toFixed();return`${t} ${e}${t==="1"?"":"s"} ago`};function Ut(s){let e,t,n=s[0].author+"",l,a,r,o=Ge(s[0].createdAt)+"",i,u,f,w=s[0].content+"",b;return{c(){e=y("div"),t=y("span"),l=K(n),a=F(),r=y("span"),i=K(o),u=F(),f=y("span"),b=K(w),this.h()},l(_){e=k(_,"DIV",{class:!0});var S=T(e);t=k(S,"SPAN",{class:!0});var C=T(t);l=O(C,n),C.forEach(h),a=j(S),r=k(S,"SPAN",{class:!0});var U=T(r);i=O(U,o),U.forEach(h),u=j(S),f=k(S,"SPAN",{class:!0});var v=T(f);b=O(v,w),v.forEach(h),S.forEach(h),this.h()},h(){c(t,"class","author svelte-bys59y"),c(r,"class","created-at svelte-bys59y"),c(f,"class","content svelte-bys59y"),c(e,"class","svelte-bys59y")},m(_,S){P(_,e,S),d(e,t),d(t,l),d(e,a),d(e,r),d(r,i),d(e,u),d(e,f),d(f,b)},p(_,[S]){S&1&&n!==(n=_[0].author+"")&&le(l,n),S&1&&o!==(o=Ge(_[0].createdAt)+"")&&le(i,o),S&1&&w!==(w=_[0].content+"")&&le(b,w)},i:D,o:D,d(_){_&&h(e)}}}function Vt(s,e,t){let{comment:n}=e;return s.$$set=l=>{"comment"in l&&t(0,n=l.comment)},[n]}class Mt extends H{constructor(e){super(),J(this,e,Vt,Ut,W,{comment:0})}}function Rt(s){let e,t=s[0].charAt(0).toUpperCase()+"",n,l;return{c(){e=y("span"),n=K(t),this.h()},l(a){e=k(a,"SPAN",{title:!0,class:!0});var r=T(e);n=O(r,t),r.forEach(h),this.h()},h(){c(e,"title",l="Rated "+s[0]+"."),c(e,"class","svelte-1nbj6kf")},m(a,r){P(a,e,r),d(e,n)},p(a,[r]){r&1&&t!==(t=a[0].charAt(0).toUpperCase()+"")&&le(n,t),r&1&&l!==(l="Rated "+a[0]+".")&&c(e,"title",l)},i:D,o:D,d(a){a&&h(e)}}}function Lt(s,e,t){let{value:n}=e;return s.$$set=l=>{"value"in l&&t(0,n=l.value)},[n]}class Gt extends H{constructor(e){super(),J(this,e,Lt,Rt,W,{value:0})}}function Ft(s){let e,t=Ge(s[0])+"",n;return{c(){e=y("span"),n=K(t),this.h()},l(l){e=k(l,"SPAN",{class:!0});var a=T(e);n=O(a,t),a.forEach(h),this.h()},h(){c(e,"class","svelte-1vqihm9")},m(l,a){P(l,e,a),d(e,n)},p(l,[a]){a&1&&t!==(t=Ge(l[0])+"")&&le(n,t)},i:D,o:D,d(l){l&&h(e)}}}function jt(s,e,t){let{value:n}=e;return s.$$set=l=>{"value"in l&&t(0,n=l.value)},[n]}class Bt extends H{constructor(e){super(),J(this,e,jt,Ft,W,{value:0})}}function zt(s){let e,t=et(s[0])+"",n;return{c(){e=y("span"),n=K(t),this.h()},l(l){e=k(l,"SPAN",{"data-testid":!0,class:!0});var a=T(e);n=O(a,t),a.forEach(h),this.h()},h(){c(e,"data-testid","score"),c(e,"class","codicon codicon-heart svelte-7y59vr")},m(l,a){P(l,e,a),d(e,n)},p(l,[a]){a&1&&t!==(t=et(l[0])+"")&&le(n,t)},i:D,o:D,d(l){l&&h(e)}}}function Kt(s,e,t){let{value:n}=e;return s.$$set=l=>{"value"in l&&t(0,n=l.value)},[n]}class Ot extends H{constructor(e){super(),J(this,e,Kt,zt,W,{value:0})}}function nt(s){let e,t,n,l,a;return{c(){e=y("a"),t=y("i"),n=F(),l=K(s[1]),this.h()},l(r){e=k(r,"A",{href:!0,target:!0,class:!0});var o=T(e);t=k(o,"I",{class:!0}),T(t).forEach(h),n=j(o),l=O(o,s[1]),o.forEach(h),this.h()},h(){c(t,"class","codicon codicon-link"),c(e,"href",a=s[0].toString()),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(r,o){P(r,e,o),d(e,t),d(e,n),d(e,l)},p(r,o){o&2&&le(l,r[1]),o&1&&a!==(a=r[0].toString())&&c(e,"href",a)},d(r){r&&h(e)}}}function qt(s){let e,t=s[0]&&nt(s);return{c(){t&&t.c(),e=ke()},l(n){t&&t.l(n),e=ke()},m(n,l){t&&t.m(n,l),P(n,e,l)},p(n,[l]){n[0]?t?t.p(n,l):(t=nt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:D,o:D,d(n){n&&h(e),t&&t.d(n)}}}function Wt(s,e,t){let n,l,{source:a}=e;return s.$$set=r=>{"source"in r&&t(2,a=r.source)},s.$$.update=()=>{var r;s.$$.dirty&4&&t(0,n=At(a)?new URL(a):null),s.$$.dirty&1&&t(1,l=(r=n==null?void 0:n.hostname)==null?void 0:r.replace(/^www./,""))},[n,l,a]}class Ht extends H{constructor(e){super(),J(this,e,Wt,qt,W,{source:2})}}function Jt(s){let e,t,n;return{c(){e=y("a"),t=y("i"),n=K(" Open"),this.h()},l(l){e=k(l,"A",{href:!0,target:!0,class:!0});var a=T(e);t=k(a,"I",{class:!0}),T(t).forEach(h),n=O(a," Open"),a.forEach(h),this.h()},h(){c(t,"class","codicon codicon-link-external"),c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(l,a){P(l,e,a),d(e,t),d(e,n)},p(l,[a]){a&1&&c(e,"href",l[0])},i:D,o:D,d(l){l&&h(e)}}}function Xt(s,e,t){let{url:n}=e;return s.$$set=l=>{"url"in l&&t(0,n=l.url)},[n]}class Zt extends H{constructor(e){super(),J(this,e,Xt,Jt,W,{url:0})}}function Qt(s){let e,t,n;return{c(){e=y("a"),t=y("i"),n=K(" File"),this.h()},l(l){e=k(l,"A",{href:!0,target:!0,class:!0});var a=T(e);t=k(a,"I",{class:!0}),T(t).forEach(h),n=O(a," File"),a.forEach(h),this.h()},h(){c(t,"class","codicon codicon-file"),c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(l,a){P(l,e,a),d(e,t),d(e,n)},p(l,[a]){a&1&&c(e,"href",l[0])},i:D,o:D,d(l){l&&h(e)}}}function Yt(s,e,t){let{url:n}=e;return s.$$set=l=>{"url"in l&&t(0,n=l.url)},[n]}class $t extends H{constructor(e){super(),J(this,e,Yt,Qt,W,{url:0})}}function lt(s,e,t){const n=s.slice();n[4]=e[t];const l=n[1].find(function(...r){return s[3](n[4],...r)})!==void 0;return n[5]=l,n}function rt(s){let e,t;function n(){return s[2](s[5],s[4])}return e=new Nt({props:{tag:s[4],active:s[5]}}),e.$on("click",n),{c(){x(e.$$.fragment)},l(l){ee(e.$$.fragment,l)},m(l,a){te(e,l,a),t=!0},p(l,a){s=l;const r={};a&1&&(r.tag=s[4]),a&3&&(r.active=s[5]),e.$set(r)},i(l){t||(N(e.$$.fragment,l),t=!0)},o(l){V(e.$$.fragment,l),t=!1},d(l){se(e,l)}}}function xt(s){let e,t,n=Le(s[0]),l=[];for(let r=0;r<n.length;r+=1)l[r]=rt(lt(s,n,r));const a=r=>V(l[r],1,1,()=>{l[r]=null});return{c(){e=y("ul");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=k(r,"UL",{class:!0});var o=T(e);for(let i=0;i<l.length;i+=1)l[i].l(o);o.forEach(h),this.h()},h(){c(e,"class","tags svelte-1gd63k6")},m(r,o){P(r,e,o);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(e,null);t=!0},p(r,[o]){if(o&3){n=Le(r[0]);let i;for(i=0;i<n.length;i+=1){const u=lt(r,n,i);l[i]?(l[i].p(u,o),N(l[i],1)):(l[i]=rt(u),l[i].c(),N(l[i],1),l[i].m(e,null))}for(we(),i=n.length;i<l.length;i+=1)a(i);Se()}},i(r){if(!t){for(let o=0;o<n.length;o+=1)N(l[o]);t=!0}},o(r){l=l.filter(Boolean);for(let o=0;o<l.length;o+=1)V(l[o]);t=!1},d(r){r&&h(e),_t(l,r)}}}function es(s,e,t){let n;Fe(s,ze,o=>t(1,n=o));let{tags:l}=e;const a=(o,i)=>o?ze.removeByName(i.name):ze.addOrReplace({...i,modifier:"+"}),r=(o,i)=>i.name===o.name;return s.$$set=o=>{"tags"in o&&t(0,l=o.tags)},[l,n,a,r]}class ts extends H{constructor(e){super(),J(this,e,es,xt,W,{tags:0})}}const gt=s=>s.endsWith(".gif"),ss=(s,e,t)=>gt(e)?{static:t,animated:e}:{static:e,animated:s},dt=s=>s.endsWith(".mp4")||s.endsWith(".webm"),Ls=(s,e,t)=>dt(e)?{static:t,animated:e}:{static:e,animated:s},Gs=s=>s.some(e=>e.name==="loop"),Fs=s=>gt(s)||dt(s),mt=s=>(s==null?void 0:s.key)===" ",pt=s=>(s==null?void 0:s.key)==="Enter",bt=s=>{var e,t;pt(s)&&((t=(e=s.target)==null?void 0:e.click)==null||t.call(e))},ns="1250px",$=new IntersectionObserver(s=>{for(const e of s){const t=e.isIntersecting?e.target.getAttribute("data-src")??"":"";e.target.setAttribute("src",t)}},{rootMargin:ns});function ls(s){let e,t,n,l,a,r,o,i;return{c(){e=y("div"),t=y("img"),this.h()},l(u){e=k(u,"DIV",{class:!0});var f=T(e);t=k(f,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,style:!0,width:!0,height:!0,tabindex:!0}),f.forEach(h),this.h()},h(){c(t,"class","post-media svelte-dgcl67"),c(t,"loading","lazy"),c(t,"data-src",s[3]),c(t,"alt",n=s[0].id.toString()),c(t,"style",l=`aspect-ratio: ${s[0].width} / ${s[0].height}`),c(t,"width",a=s[0].width),c(t,"height",r=s[0].height),c(t,"tabindex","0"),c(e,"class","svelte-dgcl67"),q(e,"expandable",s[4]),q(e,"open",s[1])},m(u,f){P(u,e,f),d(e,t),s[8](t),o||(i=[M(t,"click",s[7]),M(t,"keydown",bt),M(t,"error",s[9])],o=!0)},p(u,[f]){f&8&&c(t,"data-src",u[3]),f&1&&n!==(n=u[0].id.toString())&&c(t,"alt",n),f&1&&l!==(l=`aspect-ratio: ${u[0].width} / ${u[0].height}`)&&c(t,"style",l),f&1&&a!==(a=u[0].width)&&c(t,"width",a),f&1&&r!==(r=u[0].height)&&c(t,"height",r),f&16&&q(e,"expandable",u[4]),f&2&&q(e,"open",u[1])},i:D,o:D,d(u){u&&h(e),s[8](null),o=!1,Te(i)}}}function rs(s,e,t){let n,l,a,r;Fe(s,Je,_=>t(6,r=_));let{post:o}=e,{open:i}=e,u;qe(()=>{$==null||$.observe(u)}),We(()=>{$==null||$.unobserve(u)});function f(_){He.call(this,s,_)}function w(_){fe[_?"unshift":"push"](()=>{u=_,t(2,u)})}const b=_=>_.target.src=`${De}/assets/failed-to-load.svg`;return s.$$set=_=>{"post"in _&&t(0,o=_.post),"open"in _&&t(1,i=_.open)},s.$$.update=()=>{s.$$.dirty&1&&t(5,n=o.width/o.height),s.$$.dirty&32&&t(4,l=n<.33),s.$$.dirty&65&&t(3,a=Re(Et?o.file_url:o.sample_url,r))},[o,i,u,a,l,n,r,f,w,b]}class js extends H{constructor(e){super(),J(this,e,rs,ls,W,{post:0,open:1})}}const at=s=>{if(typeof s!="number")throw new TypeError(`Attempted to call formatVideoTime with invalid value: ${s}`);const e=Math.floor(s),t=e%60,n=Math.floor(e/60);return`${it(n)}:${it(t)}`},it=s=>{const e=String(s),t=Math.max(0,2-e.length);return`${"0".repeat(t)}${e}`};function as(s){let e,t;return{c(){e=y("img"),this.h()},l(n){e=k(n,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),this.h()},h(){Ne(e.src,t=De+"/assets/play.svg")||c(e,"src",t),c(e,"alt","Start GIF"),c(e,"width","16"),c(e,"height","32"),Oe(e,"margin-left","4px")},m(n,l){P(n,e,l)},d(n){n&&h(e)}}}function is(s){let e,t;return{c(){e=y("img"),this.h()},l(n){e=k(n,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){Ne(e.src,t=De+"/assets/pause.svg")||c(e,"src",t),c(e,"alt","Stop GIF"),c(e,"width","16"),c(e,"height","32")},m(n,l){P(n,e,l)},d(n){n&&h(e)}}}function os(s){let e,t;return{c(){e=y("img"),this.h()},l(n){e=k(n,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){Ne(e.src,t=De+"/assets/load.svg")||c(e,"src",t),c(e,"alt","Loading GIF"),c(e,"width","16"),c(e,"height","32")},m(n,l){P(n,e,l)},d(n){n&&h(e)}}}function cs(s){let e,t,n,l,a;function r(u,f){return u[1]?os:u[0]?is:as}let o=r(s),i=o(s);return{c(){e=y("button"),t=y("div"),i.c(),this.h()},l(u){e=k(u,"BUTTON",{class:!0});var f=T(e);t=k(f,"DIV",{class:!0});var w=T(t);i.l(w),w.forEach(h),f.forEach(h),this.h()},h(){c(t,"class","circle svelte-16x84bp"),c(e,"class",n=Ye(s[3].class)+" svelte-16x84bp"),q(e,"play",s[0]&&!s[1])},m(u,f){P(u,e,f),d(e,t),i.m(t,null),l||(a=M(e,"click",Ke(s[2])),l=!0)},p(u,[f]){o!==(o=r(u))&&(i.d(1),i=o(u),i&&(i.c(),i.m(t,null))),f&8&&n!==(n=Ye(u[3].class)+" svelte-16x84bp")&&c(e,"class",n),f&11&&q(e,"play",u[0]&&!u[1])},i:D,o:D,d(u){u&&h(e),i.d(),l=!1,a()}}}function us(s,e,t){let{playing:n}=e,{loading:l}=e;const a=()=>{t(1,l=!0),t(0,n=!n)};return s.$$set=r=>{t(3,e=Pe(Pe({},e),Ue(r))),"playing"in r&&t(0,n=r.playing),"loading"in r&&t(1,l=r.loading)},e=Ue(e),[n,l,a,e]}class vt extends H{constructor(e){super(),J(this,e,us,cs,W,{playing:0,loading:1})}}function ot(s){let e,t,n,l=!0,a=!1,r,o,i,u=at(s[15])+"",f,w,b,_,S,C,U,v,m,I,z;function he(){cancelAnimationFrame(r),e.paused||(r=St(he),a=!0),s[25].call(e)}function X(g){s[30](g)}function Z(g){s[31](g)}let re={class:"center"};return s[5]!==void 0&&(re.playing=s[5]),s[6]!==void 0&&(re.loading=s[6]),C=new vt({props:re}),fe.push(()=>Me(C,"playing",X)),fe.push(()=>Me(C,"loading",Z)),{c(){e=y("video"),o=F(),i=y("span"),f=K(u),w=F(),b=y("input"),S=F(),x(C.$$.fragment),this.h()},l(g){e=k(g,"VIDEO",{poster:!0,src:!0,preload:!0,style:!0,class:!0}),T(e).forEach(h),o=j(g),i=k(g,"SPAN",{class:!0});var A=T(i);f=O(A,u),A.forEach(h),w=j(g),b=k(g,"INPUT",{type:!0,min:!0,max:!0,step:!0,style:!0,class:!0}),S=j(g),ee(C.$$.fragment,g),this.h()},h(){c(e,"poster",s[1]),e.loop=s[4],Ne(e.src,t=s[0])||c(e,"src",t),c(e,"preload","metadata"),c(e,"style",n=`aspect-ratio: ${s[2]} / ${s[3]}`),c(e,"class","svelte-g134if"),s[8]===void 0&&yt(()=>s[26].call(e)),c(i,"class","svelte-g134if"),q(i,"hide",s[12]),c(b,"type","range"),c(b,"min",0),c(b,"max",s[8]),c(b,"step",.0166666),c(b,"style",_=`background-image: linear-gradient(90deg, var(--accent) ${s[13]}%, var(--background-2) ${s[13]}%);}`),c(b,"class","svelte-g134if"),q(b,"hide",s[12])},m(g,A){P(g,e,A),s[23](e),P(g,o,A),P(g,i,A),d(i,f),P(g,w,A),P(g,b,A),$e(b,s[7]),P(g,S,A),te(C,g,A),m=!0,I||(z=[M(e,"play",s[24]),M(e,"pause",s[24]),M(e,"timeupdate",he),M(e,"durationchange",s[26]),M(e,"waiting",s[19]),M(e,"playing",s[20]),M(e,"pause",s[20]),M(e,"ended",s[27]),M(e,"dblclick",Ke(kt(s[28]))),M(b,"change",s[29]),M(b,"input",s[29]),M(b,"click",Ke(hs))],I=!0)},p(g,A){(!m||A[0]&2)&&c(e,"poster",g[1]),(!m||A[0]&16)&&(e.loop=g[4]),(!m||A[0]&1&&!Ne(e.src,t=g[0]))&&c(e,"src",t),(!m||A[0]&12&&n!==(n=`aspect-ratio: ${g[2]} / ${g[3]}`))&&c(e,"style",n),A[0]&16384&&l!==(l=g[14])&&e[l?"pause":"play"](),!a&&A[0]&128&&!isNaN(g[7])&&(e.currentTime=g[7]),a=!1,(!m||A[0]&32768)&&u!==(u=at(g[15])+"")&&le(f,u),(!m||A[0]&4096)&&q(i,"hide",g[12]),(!m||A[0]&256)&&c(b,"max",g[8]),(!m||A[0]&8192&&_!==(_=`background-image: linear-gradient(90deg, var(--accent) ${g[13]}%, var(--background-2) ${g[13]}%);}`))&&c(b,"style",_),A[0]&128&&$e(b,g[7]),(!m||A[0]&4096)&&q(b,"hide",g[12]);const B={};!U&&A[0]&32&&(U=!0,B.playing=g[5],Ve(()=>U=!1)),!v&&A[0]&64&&(v=!0,B.loading=g[6],Ve(()=>v=!1)),C.$set(B)},i(g){m||(N(C.$$.fragment,g),m=!0)},o(g){V(C.$$.fragment,g),m=!1},d(g){g&&(h(e),h(o),h(i),h(w),h(b),h(S)),s[23](null),se(C,g),I=!1,Te(z)}}}function fs(s){let e,t,n,l,a,r=s[9]&&ot(s);return{c(){e=y("div"),r&&r.c(),this.h()},l(o){e=k(o,"DIV",{tabindex:!0,class:!0,style:!0});var i=T(e);r&&r.l(i),i.forEach(h),this.h()},h(){c(e,"tabindex","0"),c(e,"class",t="post-media player "+s[21].class+" svelte-g134if"),Oe(e,"aspect-ratio",s[2]+"/"+s[3])},m(o,i){P(o,e,i),r&&r.m(e,null),s[32](e),n=!0,l||(a=[M(e,"click",s[22]),M(e,"keydown",s[18])],l=!0)},p(o,i){o[9]?r?(r.p(o,i),i[0]&512&&N(r,1)):(r=ot(o),r.c(),N(r,1),r.m(e,null)):r&&(we(),V(r,1,1,()=>{r=null}),Se()),(!n||i[0]&2097152&&t!==(t="post-media player "+o[21].class+" svelte-g134if"))&&c(e,"class",t),(!n||i[0]&12)&&Oe(e,"aspect-ratio",o[2]+"/"+o[3])},i(o){n||(N(r),n=!0)},o(o){V(r),n=!1},d(o){o&&h(e),r&&r.d(),s[32](null),l=!1,Te(a)}}}const ct=5,hs=()=>{};function _s(s,e,t){let n,l,a,r,{src:o}=e,{poster:i}=e,{width:u}=e,{height:f}=e,{loop:w}=e,b,_,S=!1,C=!1,U=0,v=0,m=!1;const I=()=>{t(7,U=Math.max(0,U-ct))},z=()=>{t(7,U=Math.min(v,U+ct))},he=p=>{var oe;pt(p)?(oe=p.target)==null||oe.click():mt(p)||p.key==="k"?(p.preventDefault(),t(5,S=!S)):p.key==="ArrowLeft"||p.key==="j"?I():(p.key==="ArrowRight"||p.key==="l")&&z()},X=new IntersectionObserver(p=>{for(const oe of p)oe.isIntersecting?t(9,m=!0):_&&(t(5,S=!1),t(6,C=!1),_.addEventListener("error",()=>{t(9,m=!1)},{once:!0}),t(11,_.src="",_))},{rootMargin:"0px"}),Z=()=>t(6,C=!0),re=()=>t(6,C=!1);qe(()=>X==null?void 0:X.observe(b)),We(()=>X==null?void 0:X.unobserve(b));function g(p){He.call(this,s,p)}function A(p){fe[p?"unshift":"push"](()=>{_=p,t(11,_)})}function B(){l=this.paused,t(14,l),t(5,S),t(9,m)}function ae(){U=this.currentTime,t(7,U)}function _e(){v=this.duration,t(8,v)}const pe=()=>{w||(t(6,C=!1),t(5,S=!1))},Ee=p=>{p.offsetX<p.target.clientWidth/2?I():z()};function Ae(){U=wt(this.value),t(7,U)}function ne(p){S=p,t(5,S),t(9,m)}function ie(p){C=p,t(6,C)}function ge(p){fe[p?"unshift":"push"](()=>{b=p,t(10,b)})}return s.$$set=p=>{t(21,e=Pe(Pe({},e),Ue(p))),"src"in p&&t(0,o=p.src),"poster"in p&&t(1,i=p.poster),"width"in p&&t(2,u=p.width),"height"in p&&t(3,f=p.height),"loop"in p&&t(4,w=p.loop)},s.$$.update=()=>{s.$$.dirty[0]&384&&t(15,n=v-U),s.$$.dirty[0]&544&&t(5,S=m&&S),s.$$.dirty[0]&32&&t(14,l=!S),s.$$.dirty[0]&384&&t(13,a=U/v*98+1),s.$$.dirty[0]&96&&t(12,r=S&&!C)},e=Ue(e),[o,i,u,f,w,S,C,U,v,m,b,_,r,a,l,n,I,z,he,Z,re,e,g,A,B,ae,_e,pe,Ee,Ae,ne,ie,ge]}class Bs extends H{constructor(e){super(),J(this,e,_s,fs,W,{src:0,poster:1,width:2,height:3,loop:4},null,[-1,-1])}}function gs(s){let e,t,n,l,a,r,o,i,u,f,w,b,_;function S(v){s[14](v)}function C(v){s[15](v)}let U={class:"center"};return s[2]!==void 0&&(U.playing=s[2]),s[3]!==void 0&&(U.loading=s[3]),o=new vt({props:U}),fe.push(()=>Me(o,"playing",S)),fe.push(()=>Me(o,"loading",C)),{c(){e=y("div"),t=y("img"),r=F(),x(o.$$.fragment),this.h()},l(v){e=k(v,"DIV",{class:!0,style:!0});var m=T(e);t=k(m,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,width:!0,height:!0,tabindex:!0}),r=j(m),ee(o.$$.fragment,m),m.forEach(h),this.h()},h(){c(t,"class","post-media media-img svelte-1cndgba"),c(t,"loading","lazy"),c(t,"data-src",s[4]),c(t,"alt",n=s[0].id.toString()),c(t,"width",l=s[0].width),c(t,"height",a=s[0].height),c(t,"tabindex","0"),c(e,"class","container svelte-1cndgba"),c(e,"style",f=`aspect-ratio: ${s[0].width} / ${s[0].height}`)},m(v,m){P(v,e,m),d(e,t),s[10](t),d(e,r),te(o,e,null),w=!0,b||(_=[M(t,"click",s[9]),M(t,"keydown",s[11]),M(t,"load",s[12]),M(t,"error",s[13])],b=!0)},p(v,[m]){(!w||m&16)&&c(t,"data-src",v[4]),(!w||m&1&&n!==(n=v[0].id.toString()))&&c(t,"alt",n),(!w||m&1&&l!==(l=v[0].width))&&c(t,"width",l),(!w||m&1&&a!==(a=v[0].height))&&c(t,"height",a);const I={};!i&&m&4&&(i=!0,I.playing=v[2],Ve(()=>i=!1)),!u&&m&8&&(u=!0,I.loading=v[3],Ve(()=>u=!1)),o.$set(I),(!w||m&1&&f!==(f=`aspect-ratio: ${v[0].width} / ${v[0].height}`))&&c(e,"style",f)},i(v){w||(N(o.$$.fragment,v),w=!0)},o(v){V(o.$$.fragment,v),w=!1},d(v){v&&h(e),s[10](null),se(o),b=!1,Te(_)}}}function ds(s,e,t){let n,l,a,r,o;Fe(s,Je,I=>t(8,o=I));let{post:i}=e,u,f=!1,w=!1;qe(()=>$==null?void 0:$.observe(u)),We(()=>$==null?void 0:$.unobserve(u));function b(I){He.call(this,s,I)}function _(I){fe[I?"unshift":"push"](()=>{u=I,t(1,u),t(2,f),t(6,l),t(5,a),t(7,n),t(8,o),t(0,i)})}const S=I=>{bt(I),mt(I)&&(I.preventDefault(),t(3,w=!0),t(2,f=!f))},C=()=>t(3,w=!1),U=I=>{t(3,w=!1),I.target.src=`${De}/assets/failed-to-load.svg`};function v(I){f=I,t(2,f)}function m(I){w=I,t(3,w)}return s.$$set=I=>{"post"in I&&t(0,i=I.post)},s.$$.update=()=>{s.$$.dirty&1&&t(7,n=ss(i.file_url,i.sample_url,i.preview_url)),s.$$.dirty&384&&t(6,l=Re(n.animated,o)),s.$$.dirty&384&&t(5,a=Re(n.static,o)),s.$$.dirty&100&&t(4,r=f?l:a),s.$$.dirty&102&&u&&t(1,u.src=f?l:a,u)},[i,u,f,w,r,a,l,n,o,b,_,S,C,U,v,m]}class zs extends H{constructor(e){super(),J(this,e,ds,gs,W,{post:0})}}function ut(s,e,t){const n=s.slice();return n[7]=e[t],n}function ft(s){let e,t="•",n,l,a;return l=new Ht({props:{source:s[0].source}}),{c(){e=y("span"),e.textContent=t,n=F(),x(l.$$.fragment),this.h()},l(r){e=k(r,"SPAN",{class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-7hh8jk"&&(e.textContent=t),n=j(r),ee(l.$$.fragment,r),this.h()},h(){c(e,"class","svelte-188brre")},m(r,o){P(r,e,o),P(r,n,o),te(l,r,o),a=!0},p(r,o){const i={};o&1&&(i.source=r[0].source),l.$set(i)},i(r){a||(N(l.$$.fragment,r),a=!0)},o(r){V(l.$$.fragment,r),a=!1},d(r){r&&(h(e),h(n)),se(l,r)}}}function ms(s){let e,t,n,l={ctx:s,current:null,token:null,hasCatch:!1,pending:ws,then:vs,catch:bs,value:6,blocks:[,,,]};return xe(t=tt(s[0].id),l),{c(){e=ke(),l.block.c()},l(a){e=ke(),l.block.l(a)},m(a,r){P(a,e,r),l.block.m(a,l.anchor=r),l.mount=()=>e.parentNode,l.anchor=e,n=!0},p(a,r){s=a,l.ctx=s,r&1&&t!==(t=tt(s[0].id))&&xe(t,l)||It(l,s,r)},i(a){n||(N(l.block),n=!0)},o(a){for(let r=0;r<3;r+=1){const o=l.blocks[r];V(o)}n=!1},d(a){a&&h(e),l.block.d(a),l.token=null,l=null}}}function ps(s){let e,t;return e=new ts({props:{tags:s[0].tags}}),{c(){x(e.$$.fragment)},l(n){ee(e.$$.fragment,n)},m(n,l){te(e,n,l),t=!0},p(n,l){const a={};l&1&&(a.tags=n[0].tags),e.$set(a)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function bs(s){return{c:D,l:D,m:D,p:D,i:D,o:D,d:D}}function vs(s){let e,t,n,l;const a=[ks,ys],r=[];function o(i,u){return i[6].length>0?0:1}return e=o(s),t=r[e]=a[e](s),{c(){t.c(),n=ke()},l(i){t.l(i),n=ke()},m(i,u){r[e].m(i,u),P(i,n,u),l=!0},p(i,u){let f=e;e=o(i),e===f?r[e].p(i,u):(we(),V(r[f],1,1,()=>{r[f]=null}),Se(),t=r[e],t?t.p(i,u):(t=r[e]=a[e](i),t.c()),N(t,1),t.m(n.parentNode,n))},i(i){l||(N(t),l=!0)},o(i){V(t),l=!1},d(i){i&&h(n),r[e].d(i)}}}function ys(s){let e,t="Comments for this post are not available";return{c(){e=y("span"),e.textContent=t,this.h()},l(n){e=k(n,"SPAN",{class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-4t2lxe"&&(e.textContent=t),this.h()},h(){c(e,"class","no-comments svelte-188brre")},m(n,l){P(n,e,l)},p:D,i:D,o:D,d(n){n&&h(e)}}}function ks(s){let e,t,n=Le(s[6]),l=[];for(let r=0;r<n.length;r+=1)l[r]=ht(ut(s,n,r));const a=r=>V(l[r],1,1,()=>{l[r]=null});return{c(){e=y("ul");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=k(r,"UL",{class:!0});var o=T(e);for(let i=0;i<l.length;i+=1)l[i].l(o);o.forEach(h),this.h()},h(){c(e,"class","comments svelte-188brre")},m(r,o){P(r,e,o);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(e,null);t=!0},p(r,o){if(o&1){n=Le(r[6]);let i;for(i=0;i<n.length;i+=1){const u=ut(r,n,i);l[i]?(l[i].p(u,o),N(l[i],1)):(l[i]=ht(u),l[i].c(),N(l[i],1),l[i].m(e,null))}for(we(),i=n.length;i<l.length;i+=1)a(i);Se()}},i(r){if(!t){for(let o=0;o<n.length;o+=1)N(l[o]);t=!0}},o(r){l=l.filter(Boolean);for(let o=0;o<l.length;o+=1)V(l[o]);t=!1},d(r){r&&h(e),_t(l,r)}}}function ht(s){let e,t;return e=new Mt({props:{comment:s[7]}}),{c(){x(e.$$.fragment)},l(n){ee(e.$$.fragment,n)},m(n,l){te(e,n,l),t=!0},p(n,l){const a={};l&1&&(a.comment=n[7]),e.$set(a)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ws(s){let e,t;return e=new Ct({}),{c(){x(e.$$.fragment)},l(n){ee(e.$$.fragment,n)},m(n,l){te(e,n,l),t=!0},p:D,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function Ss(s){let e,t,n,l,a,r="•",o,i,u,f,w="•",b,_,S,C,U="•",v,m,I,z,he="•",X,Z,re,g,A,B,ae,_e=s[0].tags.length+"",pe,Ee,Ae,ne,ie,ge=(s[0].comment_count||"No")+"",p,oe,je,Q,Y,ce,Be,Xe;n=new Gt({props:{value:s[0].rating}}),i=new Ot({props:{value:s[0].score}}),_=new Bt({props:{value:s[0].change}}),m=new Zt({props:{url:"/post?id="+s[0].id+"&src="+encodeURIComponent(s[2])}}),Z=new $t({props:{url:s[2]}});let G=s[0].source&&ft(s);const Ze=[ps,ms],ue=[];function Qe(E,R){return E[1]==="tags"?0:1}return Q=Qe(s),Y=ue[Q]=Ze[Q](s),{c(){e=y("div"),t=y("div"),x(n.$$.fragment),l=F(),a=y("span"),a.textContent=r,o=F(),x(i.$$.fragment),u=F(),f=y("span"),f.textContent=w,b=F(),x(_.$$.fragment),S=F(),C=y("span"),C.textContent=U,v=F(),x(m.$$.fragment),I=F(),z=y("span"),z.textContent=he,X=F(),x(Z.$$.fragment),re=F(),G&&G.c(),g=F(),A=y("div"),B=y("button"),ae=y("span"),pe=K(_e),Ee=K(" tags"),Ae=F(),ne=y("button"),ie=y("span"),p=K(ge),oe=K(" comments"),je=F(),Y.c(),this.h()},l(E){e=k(E,"DIV",{class:!0});var R=T(e);t=k(R,"DIV",{class:!0});var L=T(t);ee(n.$$.fragment,L),l=j(L),a=k(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(a)!=="svelte-7hh8jk"&&(a.textContent=r),o=j(L),ee(i.$$.fragment,L),u=j(L),f=k(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(f)!=="svelte-7hh8jk"&&(f.textContent=w),b=j(L),ee(_.$$.fragment,L),S=j(L),C=k(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(C)!=="svelte-7hh8jk"&&(C.textContent=U),v=j(L),ee(m.$$.fragment,L),I=j(L),z=k(L,"SPAN",{class:!0,"data-svelte-h":!0}),ye(z)!=="svelte-7hh8jk"&&(z.textContent=he),X=j(L),ee(Z.$$.fragment,L),re=j(L),G&&G.l(L),L.forEach(h),g=j(R),A=k(R,"DIV",{class:!0});var de=T(A);B=k(de,"BUTTON",{class:!0});var Ie=T(B);ae=k(Ie,"SPAN",{class:!0});var be=T(ae);pe=O(be,_e),Ee=O(be," tags"),be.forEach(h),Ie.forEach(h),Ae=j(de),ne=k(de,"BUTTON",{class:!0});var Ce=T(ne);ie=k(Ce,"SPAN",{class:!0});var me=T(ie);p=O(me,ge),oe=O(me," comments"),me.forEach(h),Ce.forEach(h),de.forEach(h),je=j(R),Y.l(R),R.forEach(h),this.h()},h(){c(a,"class","svelte-188brre"),c(f,"class","svelte-188brre"),c(C,"class","svelte-188brre"),c(z,"class","svelte-188brre"),c(t,"class","summary svelte-188brre"),c(ae,"class","svelte-188brre"),c(B,"class","codicon codicon-tag svelte-188brre"),q(B,"active",s[1]==="tags"),c(ie,"class","svelte-188brre"),c(ne,"class","codicon codicon-comment-discussion svelte-188brre"),q(ne,"active",s[1]==="comments"),c(A,"class","tabs svelte-188brre"),c(e,"class","details svelte-188brre")},m(E,R){P(E,e,R),d(e,t),te(n,t,null),d(t,l),d(t,a),d(t,o),te(i,t,null),d(t,u),d(t,f),d(t,b),te(_,t,null),d(t,S),d(t,C),d(t,v),te(m,t,null),d(t,I),d(t,z),d(t,X),te(Z,t,null),d(t,re),G&&G.m(t,null),d(e,g),d(e,A),d(A,B),d(B,ae),d(ae,pe),d(ae,Ee),d(A,Ae),d(A,ne),d(ne,ie),d(ie,p),d(ie,oe),d(e,je),ue[Q].m(e,null),ce=!0,Be||(Xe=[M(B,"click",s[4]),M(ne,"click",s[5])],Be=!0)},p(E,[R]){const L={};R&1&&(L.value=E[0].rating),n.$set(L);const de={};R&1&&(de.value=E[0].score),i.$set(de);const Ie={};R&1&&(Ie.value=E[0].change),_.$set(Ie);const be={};R&5&&(be.url="/post?id="+E[0].id+"&src="+encodeURIComponent(E[2])),m.$set(be);const Ce={};R&4&&(Ce.url=E[2]),Z.$set(Ce),E[0].source?G?(G.p(E,R),R&1&&N(G,1)):(G=ft(E),G.c(),N(G,1),G.m(t,null)):G&&(we(),V(G,1,1,()=>{G=null}),Se()),(!ce||R&1)&&_e!==(_e=E[0].tags.length+"")&&le(pe,_e),(!ce||R&2)&&q(B,"active",E[1]==="tags"),(!ce||R&1)&&ge!==(ge=(E[0].comment_count||"No")+"")&&le(p,ge),(!ce||R&2)&&q(ne,"active",E[1]==="comments");let me=Q;Q=Qe(E),Q===me?ue[Q].p(E,R):(we(),V(ue[me],1,1,()=>{ue[me]=null}),Se(),Y=ue[Q],Y?Y.p(E,R):(Y=ue[Q]=Ze[Q](E),Y.c()),N(Y,1),Y.m(e,null))},i(E){ce||(N(n.$$.fragment,E),N(i.$$.fragment,E),N(_.$$.fragment,E),N(m.$$.fragment,E),N(Z.$$.fragment,E),N(G),N(Y),ce=!0)},o(E){V(n.$$.fragment,E),V(i.$$.fragment,E),V(_.$$.fragment,E),V(m.$$.fragment,E),V(Z.$$.fragment,E),V(G),V(Y),ce=!1},d(E){E&&h(e),se(n),se(i),se(_),se(m),se(Z),G&&G.d(),ue[Q].d(),Be=!1,Te(Xe)}}}function Es(s,e,t){let n,l;Fe(s,Je,u=>t(3,l=u));let{post:a}=e,r="tags";const o=()=>{t(1,r="tags")},i=()=>{t(1,r="comments")};return s.$$set=u=>{"post"in u&&t(0,a=u.post)},s.$$.update=()=>{s.$$.dirty&9&&t(2,n=Re(a.file_url,l))},[a,r,n,l,o,i]}class Ks extends H{constructor(e){super(),J(this,e,Es,Ss,W,{post:0})}}export{Mt as C,Ks as D,Ht as E,zs as G,js as I,Zt as K,ts as P,Gt as R,Ot as S,Bs as V,Bt as a,$t as b,ss as c,Ls as d,pt as e,Gs as f,tt as g,Fs as i};
