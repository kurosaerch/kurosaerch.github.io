var Z=Object.defineProperty;var x=(s,t,r)=>t in s?Z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var d=(s,t,r)=>(x(s,typeof t!="symbol"?t+"":t,r),r);import{s as A,b as tt,c as et,d as st}from"./posts.e71a7ea5.js";import{S as E}from"./store-keys.3fb7abd8.js";import{s as M,f as y,U as rt,g as w,h as P,V as nt,d as m,j as _,r as j,i as b,v as k,u as it,F as ot,M as at,E as lt,a as I,e as T,c as R,P as ct}from"./scheduler.88299003.js";import{S as q,i as z,a as g,g as $,t as p,c as C,b as v,d as D,m as B,e as V}from"./index.15b414ac.js";import{e as K}from"./each.e59479a4.js";import{D as X}from"./DetailedTag.28ff9b0d.js";import{B as ut}from"./blocked-content-store.db35eae7.js";const U=()=>({sortProperty:"id",scoreValue:0,scoreComparator:">=",sortDirection:"desc",rating:"all"}),ht=()=>{const{subscribe:s,set:t,update:r}=A(E.SortFilter,U());return{subscribe:s,set(e){const o=e.scoreValue??0;t({...e,scoreValue:o})},update(e){r(o=>({...o,...e}))},reset(){t(U())}}},qt=ht();function ft(s){let t,r;return{c(){t=y("h1"),r=new rt(!1),this.h()},l(e){t=w(e,"H1",{class:!0});var o=P(t);r=nt(o,!1),o.forEach(m),this.h()},h(){r.a=null,_(t,"class",j(s[1])+" svelte-1jtyohl")},m(e,o){b(e,t,o),r.m(s[0],t)},p:k,i:k,o:k,d(e){e&&m(t)}}}function gt(s){const t=new Date,r=n=>{const u=`${n.getDate()}-${n.getMonth()}`;return u==="24-12"||u==="25-12"?"kurðŸŽ…search":"kurosearch"},e=n=>n.getMonth()===5?"pride":"default",o=r(t),i=e(t);return[o,i]}class zt extends q{constructor(t){super(),z(this,t,gt,ft,M,{})}}function pt(s){let t,r,e,o,i;return{c(){t=y("button"),r=y("i"),this.h()},l(n){t=w(n,"BUTTON",{title:!0,class:!0});var u=P(t);r=w(u,"I",{class:!0}),P(r).forEach(m),u.forEach(m),this.h()},h(){_(r,"class",e=j(s[1])+" svelte-c0182g"),_(t,"title",s[0]),_(t,"class","svelte-c0182g")},m(n,u){b(n,t,u),it(t,r),o||(i=ot(t,"click",s[2]),o=!0)},p(n,[u]){u&2&&e!==(e=j(n[1])+" svelte-c0182g")&&_(r,"class",e),u&1&&_(t,"title",n[0])},i:k,o:k,d(n){n&&m(t),o=!1,i()}}}function dt(s,t,r){let{title:e}=t,{icon:o}=t;function i(n){at.call(this,s,n)}return s.$$set=n=>{"title"in n&&r(0,e=n.title),"icon"in n&&r(1,o=n.icon)},[e,o,i]}class Y extends q{constructor(t){super(),z(this,t,dt,pt,M,{title:0,icon:1})}}function F(s,t,r){const e=s.slice();return e[8]=t[r],e}function L(s){let t,r,e,o,i=K(s[0]),n=[];for(let a=0;a<i.length;a+=1)n[a]=G(F(s,i,a));const u=a=>p(n[a],1,1,()=>{n[a]=null});let l=s[0].length>0&&H(s),h=s[0].length>1&&J(s);return{c(){for(let a=0;a<n.length;a+=1)n[a].c();t=I(),l&&l.c(),r=I(),h&&h.c(),e=T()},l(a){for(let c=0;c<n.length;c+=1)n[c].l(a);t=R(a),l&&l.l(a),r=R(a),h&&h.l(a),e=T()},m(a,c){for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(a,c);b(a,t,c),l&&l.m(a,c),b(a,r,c),h&&h.m(a,c),b(a,e,c),o=!0},p(a,c){if(c&3){i=K(a[0]);let f;for(f=0;f<i.length;f+=1){const O=F(a,i,f);n[f]?(n[f].p(O,c),g(n[f],1)):(n[f]=G(O),n[f].c(),g(n[f],1),n[f].m(t.parentNode,t))}for($(),f=i.length;f<n.length;f+=1)u(f);C()}a[0].length>0?l?(l.p(a,c),c&1&&g(l,1)):(l=H(a),l.c(),g(l,1),l.m(r.parentNode,r)):l&&($(),p(l,1,1,()=>{l=null}),C()),a[0].length>1?h?(h.p(a,c),c&1&&g(h,1)):(h=J(a),h.c(),g(h,1),h.m(e.parentNode,e)):h&&($(),p(h,1,1,()=>{h=null}),C())},i(a){if(!o){for(let c=0;c<i.length;c+=1)g(n[c]);g(l),g(h),o=!0}},o(a){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)p(n[c]);p(l),p(h),o=!1},d(a){a&&(m(t),m(r),m(e)),ct(n,a),l&&l.d(a),h&&h.d(a)}}}function mt(s){let t,r;function e(){return s[4](s[8])}function o(){return s[5](s[8])}return t=new X({props:{tag:s[8],active:!0}}),t.$on("click",e),t.$on("contextmenu",o),{c(){v(t.$$.fragment)},l(i){D(t.$$.fragment,i)},m(i,n){B(t,i,n),r=!0},p(i,n){s=i;const u={};n&1&&(u.tag=s[8]),t.$set(u)},i(i){r||(g(t.$$.fragment,i),r=!0)},o(i){p(t.$$.fragment,i),r=!1},d(i){V(t,i)}}}function _t(s){let t,r;function e(){return s[2](s[8])}function o(){return s[3](s[8])}return t=new X({props:{tag:{name:s[8].name,type:"supertag",modifier:"+",count:s[8].tags.length},active:!0}}),t.$on("click",e),t.$on("contextmenu",o),{c(){v(t.$$.fragment)},l(i){D(t.$$.fragment,i)},m(i,n){B(t,i,n),r=!0},p(i,n){s=i;const u={};n&1&&(u.tag={name:s[8].name,type:"supertag",modifier:"+",count:s[8].tags.length}),t.$set(u)},i(i){r||(g(t.$$.fragment,i),r=!0)},o(i){p(t.$$.fragment,i),r=!1},d(i){V(t,i)}}}function G(s){let t,r,e,o;const i=[_t,mt],n=[];function u(l,h){return"description"in l[8]?0:1}return t=u(s),r=n[t]=i[t](s),{c(){r.c(),e=T()},l(l){r.l(l),e=T()},m(l,h){n[t].m(l,h),b(l,e,h),o=!0},p(l,h){let a=t;t=u(l),t===a?n[t].p(l,h):($(),p(n[a],1,1,()=>{n[a]=null}),C(),r=n[t],r?r.p(l,h):(r=n[t]=i[t](l),r.c()),g(r,1),r.m(e.parentNode,e))},i(l){o||(g(r),o=!0)},o(l){p(r),o=!1},d(l){l&&m(e),n[t].d(l)}}}function H(s){let t,r;return t=new Y({props:{icon:"codicon codicon-copy",title:"Share this search with others."}}),t.$on("click",s[6]),{c(){v(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,o){B(t,e,o),r=!0},p:k,i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){p(t.$$.fragment,e),r=!1},d(e){V(t,e)}}}function J(s){let t,r;return t=new Y({props:{icon:"codicon codicon-star-full",title:"Create a supertag from the current selection."}}),t.$on("click",s[7]),{c(){v(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,o){B(t,e,o),r=!0},p:k,i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){p(t.$$.fragment,e),r=!1},d(e){V(t,e)}}}function bt(s){let t,r,e=s[0].length>0&&L(s);return{c(){t=y("ul"),e&&e.c(),this.h()},l(o){t=w(o,"UL",{class:!0});var i=P(t);e&&e.l(i),i.forEach(m),this.h()},h(){_(t,"class","svelte-11k0uwj")},m(o,i){b(o,t,i),e&&e.m(t,null),r=!0},p(o,[i]){o[0].length>0?e?(e.p(o,i),i&1&&g(e,1)):(e=L(o),e.c(),g(e,1),e.m(t,null)):e&&($(),p(e,1,1,()=>{e=null}),C())},i(o){r||(g(e),r=!0)},o(o){p(e),r=!1},d(o){o&&m(t),e&&e.d()}}}function kt(s,t,r){const e=lt();let{tags:o}=t;const i=c=>e("click",c),n=c=>e("contextmenu",c),u=c=>e("click",c),l=c=>e("contextmenu",c),h=()=>e("copy"),a=()=>e("createSupertag",o);return s.$$set=c=>{"tags"in c&&r(0,o=c.tags)},[o,e,i,n,u,l,h,a]}class Ot extends q{constructor(t){super(),z(this,t,kt,bt,M,{tags:0})}}const Q=()=>({posts:[],pageCount:0,ids:new Set,postCount:0,requested:!1}),$t=s=>JSON.stringify({posts:s.posts,pageCount:s.pageCount,ids:[...s.ids.values()],postCount:s.postCount,requested:s.requested}),Ct=s=>{const t=JSON.parse(s);return{posts:t.posts,pageCount:t.pageCount,ids:new Set(t.ids),postCount:t.postCount,requested:t.requested}},St=()=>{const{subscribe:s,update:t,set:r}=A(E.Results,Q(),$t,Ct);return{subscribe:s,addPage(e,o=void 0){t(i=>{const n=e.filter(u=>!i.ids.has(u.id));return n.forEach(u=>i.ids.add(u.id)),{posts:[...i.posts,...n],pageCount:i.pageCount+1,ids:i.ids,postCount:o??i.postCount,requested:!0}})},reset(){r(Q())}}},It=St(),yt=()=>{const{subscribe:s,update:t,set:r}=A(E.ActiveSupertags,[]);return{subscribe:s,set:r,addOrReplace:e=>t(o=>{const i=o.findIndex(n=>n.name===e.name);return i===-1?o.push(e):o[i]=e,o}),removeByName:e=>t(o=>{const i=o.findIndex(n=>n.name===e);return o.splice(i,1),o}),reset:()=>r([])}},Rt=yt(),wt=s=>s==="-"?"-":"",Pt=s=>s.replaceAll(" ","_"),Tt=s=>`${wt(s.modifier)}${Pt(s.name)}`,N=s=>{const t=vt(s);let r=[...W([...t["+"],...t["-"]])];return t["~"].length>0&&r.push(`( ${W(t["~"]).join(" ~ ")} )`),r.join("+")},S=(s,t,r,e,o,i,n,u)=>{const l=[`sort:${t}:${r}`];if((e!==0||i!==">=")&&l.push(`score:${i}${e}`),o!=="all"&&l.push(`rating:${o}`),s.length>0&&l.push(N(s)),u.length>0){const a=u.map(c=>N(c.tags)).join("+");l.push(a)}if(n.length>0){const a=n.flatMap(f=>ut[f]).map(f=>({modifier:"-",name:f})),c=N(a);l.push(c)}return l.join("+")},W=s=>s.map(Tt),vt=s=>{const t={"+":[],"-":[],"~":[]};return s.forEach(r=>t[r.modifier].push(r)),t};class Kt{constructor(){d(this,"pid");d(this,"tags");d(this,"supertags");d(this,"blockedContent");d(this,"sortProperty");d(this,"sortDirection");d(this,"scoreValue");d(this,"rating");d(this,"scoreComparator");d(this,"tagString");this.pid=0,this.tags=[],this.supertags=[],this.blockedContent=[],this.sortProperty="id",this.sortDirection="desc",this.scoreValue=0,this.rating="all",this.scoreComparator=">="}withPid(t){return this.pid=t,this}withTags(t){return this.tags=t,this}withSupertags(t){return this.supertags=t,this}withSortProperty(t){return this.sortProperty=t,this}withSortDirection(t){return this.sortDirection=t,this}withScoreValue(t){return this.scoreValue=t,this}withScoreComparator(t){return this.scoreComparator=t,this}withRating(t){return this.rating=t,this}withBlockedContent(t){return this.blockedContent=Object.entries(t).filter(([r,e])=>e).map(([r,e])=>r),this}async getPageAndCount(){return this.tagString=S(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags),Promise.all([this.getPage(),this.getCount()])}async getPage(){return this.tagString||(this.tagString=S(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),tt(this.pid,this.tagString)}async getCount(){return this.tagString||(this.tagString=S(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),et(this.tagString)}getQuery(){return this.tagString||(this.tagString=S(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),st(0,this.tagString)}}export{Ot as A,zt as K,Kt as S,Rt as a,It as r,qt as s};
