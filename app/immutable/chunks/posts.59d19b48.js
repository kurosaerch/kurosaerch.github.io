import{f as g,r as m}from"./tags.49324235.js";import{g as u}from"./tag-type-data.934b5280.js";const i=new Map,E=20;let l=null;const F=async(t,e)=>{const s=C(t,e),r=await g(s,l);c(r);try{let n=await r.json();n=n.filter(a=>a.change);const o=n.map(h);return o.forEach(a=>{i.set(a.id,a)}),o}catch(n){return console.warn("Failed to get posts",n),[]}},M=async t=>{const e=await g(j(t),l);c(e);const s=await e.text(),n=new DOMParser().parseFromString(s,"text/xml"),o=Number(n.getElementsByTagName("posts")[0].getAttribute("count"));return I(o),o},W=async t=>{if(!i.has(t)){const s=new URL("https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&fields=tag_info&json=1");s.searchParams.append("id",String(t));const r=await fetch(s);c(r);const n=await r.json(),o=h(n[0]);i.set(o.id,o)}const e=i.get(t);if(e===void 0)throw new Error("Post cannot be undefined");return e},c=t=>{if(!t.ok)throw new Error(`getPage failed with http status ${t.status}`)},h=t=>{const e=t.height,s=t.score,r=t.preview_url,n=t.file_url,o=t.parent_id,a=t.sample_url,d=t.sample_width,w=t.sample_height,f=t.rating,p=t.tag_info,x=t.tags,b=t.id,_=t.width,P=t.change,y=t.comment_count,N=t.status,v=t.source;return{preview_url:r,sample_url:a,file_url:n,comment_count:Number(y),height:Number(e),id:Number(b),change:Number(P)*1e3,parent_id:o?Number(o):void 0,rating:f,sample_height:Number(w),sample_width:Number(d),score:Number(s),source:v,status:N,tags:p?$(p):U(x),width:Number(_),type:q(n)}},$=t=>t.map(A).sort(T),U=t=>t.split(" ").map(S),A=({tag:t,count:e,type:s})=>({name:m(t),count:e,type:s}),S=t=>({name:m(t),count:0,type:"ambiguous"}),T=(t,e)=>u(t.type)-u(e.type),C=(t,e)=>{const r=`https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&fields=tag_info&json=1&limit=${E}&pid=${t}`;return e===""?r:`${r}&tags=${e}`},j=t=>{const e="https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&limit=0";return t===""?e:`${e}&tags=${t}`},I=t=>{if(typeof t!="number")throw new Error("Unexpected response received in getPage")},q=t=>t.endsWith(".webm")||t.endsWith(".mp4")?"video":t.includes(".gif")?"gif":"image";export{W as a,M as b,C as c,F as g};
