var J=Object.defineProperty;var Q=(s,t,r)=>t in s?J(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var g=(s,t,r)=>(Q(s,typeof t!="symbol"?t+"":t,r),r);import{s as B,b as W,c as X,d as Y}from"./posts.e71a7ea5.js";import{S as V}from"./store-keys.3fb7abd8.js";import{s as N,f as C,U as Z,g as S,h as $,V as x,d as p,j as d,r as D,i as b,v as _,u as tt,F as et,M as st,E as rt,a as nt,e as y,c as it,P as ot}from"./scheduler.88299003.js";import{S as j,i as A,a as h,g as P,t as f,c as T,b as E,d as M,m as q,e as z}from"./index.15b414ac.js";import{e as O}from"./each.e59479a4.js";import{D as H}from"./DetailedTag.28ff9b0d.js";import{B as at}from"./blocked-content-store.db35eae7.js";const I=()=>({sortProperty:"id",scoreValue:0,scoreComparator:">=",sortDirection:"desc",rating:"all"}),lt=()=>{const{subscribe:s,set:t,update:r}=B(V.SortFilter,I());return{subscribe:s,set(e){const i=e.scoreValue??0;t({...e,scoreValue:i})},update(e){r(i=>({...i,...e}))},reset(){t(I())}}},Et=lt();function ct(s){let t,r;return{c(){t=C("h1"),r=new Z(!1),this.h()},l(e){t=S(e,"H1",{class:!0});var i=$(t);r=x(i,!1),i.forEach(p),this.h()},h(){r.a=null,d(t,"class",D(s[1])+" svelte-1jtyohl")},m(e,i){b(e,t,i),r.m(s[0],t)},p:_,i:_,o:_,d(e){e&&p(t)}}}function ut(s){const t=new Date,r=a=>{const l=`${a.getDate()}-${a.getMonth()}`;return l==="24-12"||l==="25-12"?"kurðŸŽ…search":"kurosearch"},e=a=>a.getMonth()===5?"pride":"default",i=r(t),n=e(t);return[i,n]}class Mt extends j{constructor(t){super(),A(this,t,ut,ct,N,{})}}function ht(s){let t,r,e,i,n;return{c(){t=C("button"),r=C("i"),this.h()},l(a){t=S(a,"BUTTON",{title:!0,class:!0});var l=$(t);r=S(l,"I",{class:!0}),$(r).forEach(p),l.forEach(p),this.h()},h(){d(r,"class",e=D(s[1])+" svelte-c0182g"),d(t,"title",s[0]),d(t,"class","svelte-c0182g")},m(a,l){b(a,t,l),tt(t,r),i||(n=et(t,"click",s[2]),i=!0)},p(a,[l]){l&2&&e!==(e=D(a[1])+" svelte-c0182g")&&d(r,"class",e),l&1&&d(t,"title",a[0])},i:_,o:_,d(a){a&&p(t),i=!1,n()}}}function gt(s,t,r){let{title:e}=t,{icon:i}=t;function n(a){st.call(this,s,a)}return s.$$set=a=>{"title"in a&&r(0,e=a.title),"icon"in a&&r(1,i=a.icon)},[e,i,n]}class ft extends j{constructor(t){super(),A(this,t,gt,ht,N,{title:0,icon:1})}}function R(s,t,r){const e=s.slice();return e[7]=t[r],e}function K(s){let t,r,e,i=O(s[0]),n=[];for(let o=0;o<i.length;o+=1)n[o]=U(R(s,i,o));const a=o=>f(n[o],1,1,()=>{n[o]=null});let l=s[0].length>1&&F(s);return{c(){for(let o=0;o<n.length;o+=1)n[o].c();t=nt(),l&&l.c(),r=y()},l(o){for(let u=0;u<n.length;u+=1)n[u].l(o);t=it(o),l&&l.l(o),r=y()},m(o,u){for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(o,u);b(o,t,u),l&&l.m(o,u),b(o,r,u),e=!0},p(o,u){if(u&3){i=O(o[0]);let c;for(c=0;c<i.length;c+=1){const m=R(o,i,c);n[c]?(n[c].p(m,u),h(n[c],1)):(n[c]=U(m),n[c].c(),h(n[c],1),n[c].m(t.parentNode,t))}for(P(),c=i.length;c<n.length;c+=1)a(c);T()}o[0].length>1?l?(l.p(o,u),u&1&&h(l,1)):(l=F(o),l.c(),h(l,1),l.m(r.parentNode,r)):l&&(P(),f(l,1,1,()=>{l=null}),T())},i(o){if(!e){for(let u=0;u<i.length;u+=1)h(n[u]);h(l),e=!0}},o(o){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)f(n[u]);f(l),e=!1},d(o){o&&(p(t),p(r)),ot(n,o),l&&l.d(o)}}}function pt(s){let t,r;function e(){return s[4](s[7])}function i(){return s[5](s[7])}return t=new H({props:{tag:s[7],active:!0}}),t.$on("click",e),t.$on("contextmenu",i),{c(){E(t.$$.fragment)},l(n){M(t.$$.fragment,n)},m(n,a){q(t,n,a),r=!0},p(n,a){s=n;const l={};a&1&&(l.tag=s[7]),t.$set(l)},i(n){r||(h(t.$$.fragment,n),r=!0)},o(n){f(t.$$.fragment,n),r=!1},d(n){z(t,n)}}}function dt(s){let t,r;function e(){return s[2](s[7])}function i(){return s[3](s[7])}return t=new H({props:{tag:{name:s[7].name,type:"supertag",modifier:"+",count:s[7].tags.length},active:!0}}),t.$on("click",e),t.$on("contextmenu",i),{c(){E(t.$$.fragment)},l(n){M(t.$$.fragment,n)},m(n,a){q(t,n,a),r=!0},p(n,a){s=n;const l={};a&1&&(l.tag={name:s[7].name,type:"supertag",modifier:"+",count:s[7].tags.length}),t.$set(l)},i(n){r||(h(t.$$.fragment,n),r=!0)},o(n){f(t.$$.fragment,n),r=!1},d(n){z(t,n)}}}function U(s){let t,r,e,i;const n=[dt,pt],a=[];function l(o,u){return"description"in o[7]?0:1}return t=l(s),r=a[t]=n[t](s),{c(){r.c(),e=y()},l(o){r.l(o),e=y()},m(o,u){a[t].m(o,u),b(o,e,u),i=!0},p(o,u){let c=t;t=l(o),t===c?a[t].p(o,u):(P(),f(a[c],1,1,()=>{a[c]=null}),T(),r=a[t],r?r.p(o,u):(r=a[t]=n[t](o),r.c()),h(r,1),r.m(e.parentNode,e))},i(o){i||(h(r),i=!0)},o(o){f(r),i=!1},d(o){o&&p(e),a[t].d(o)}}}function F(s){let t,r;return t=new ft({props:{icon:"codicon codicon-star-full",title:"Create a supertag from the current selection."}}),t.$on("click",s[6]),{c(){E(t.$$.fragment)},l(e){M(t.$$.fragment,e)},m(e,i){q(t,e,i),r=!0},p:_,i(e){r||(h(t.$$.fragment,e),r=!0)},o(e){f(t.$$.fragment,e),r=!1},d(e){z(t,e)}}}function mt(s){let t,r,e=s[0].length>0&&K(s);return{c(){t=C("ul"),e&&e.c(),this.h()},l(i){t=S(i,"UL",{class:!0});var n=$(t);e&&e.l(n),n.forEach(p),this.h()},h(){d(t,"class","svelte-11k0uwj")},m(i,n){b(i,t,n),e&&e.m(t,null),r=!0},p(i,[n]){i[0].length>0?e?(e.p(i,n),n&1&&h(e,1)):(e=K(i),e.c(),h(e,1),e.m(t,null)):e&&(P(),f(e,1,1,()=>{e=null}),T())},i(i){r||(h(e),r=!0)},o(i){f(e),r=!1},d(i){i&&p(t),e&&e.d()}}}function _t(s,t,r){const e=rt();let{tags:i}=t;const n=c=>e("click",c),a=c=>e("contextmenu",c),l=c=>e("click",c),o=c=>e("contextmenu",c),u=()=>e("createSupertag",i);return s.$$set=c=>{"tags"in c&&r(0,i=c.tags)},[i,e,n,a,l,o,u]}class qt extends j{constructor(t){super(),A(this,t,_t,mt,N,{tags:0})}}const L=()=>({posts:[],pageCount:0,ids:new Set,postCount:0,requested:!1}),bt=s=>JSON.stringify({posts:s.posts,pageCount:s.pageCount,ids:[...s.ids.values()],postCount:s.postCount,requested:s.requested}),kt=s=>{const t=JSON.parse(s);return{posts:t.posts,pageCount:t.pageCount,ids:new Set(t.ids),postCount:t.postCount,requested:t.requested}},Ct=()=>{const{subscribe:s,update:t,set:r}=B(V.Results,L(),bt,kt);return{subscribe:s,addPage(e,i=void 0){t(n=>{const a=e.filter(l=>!n.ids.has(l.id));return a.forEach(l=>n.ids.add(l.id)),{posts:[...n.posts,...a],pageCount:n.pageCount+1,ids:n.ids,postCount:i??n.postCount,requested:!0}})},reset(){r(L())}}},zt=Ct(),St=()=>{const{subscribe:s,update:t,set:r}=B(V.ActiveSupertags,[]);return{subscribe:s,set:r,addOrReplace:e=>t(i=>{const n=i.findIndex(a=>a.name===e.name);return n===-1?i.push(e):i[n]=e,i}),removeByName:e=>t(i=>{const n=i.findIndex(a=>a.name===e);return i.splice(n,1),i}),reset:()=>r([])}},Ot=St(),$t=s=>s==="-"?"-":"",yt=s=>s.replaceAll(" ","_"),Pt=s=>`${$t(s.modifier)}${yt(s.name)}`,v=s=>{const t=Tt(s);let r=[...G([...t["+"],...t["-"]])];return t["~"].length>0&&r.push(`( ${G(t["~"]).join(" ~ ")} )`),r.join("+")},k=(s,t,r,e,i,n,a,l)=>{const o=[`sort:${t}:${r}`];if((e!==0||n!==">=")&&o.push(`score:${n}${e}`),i!=="all"&&o.push(`rating:${i}`),s.length>0&&o.push(v(s)),l.length>0){const c=l.map(m=>v(m.tags)).join("+");o.push(c)}if(a.length>0){const c=a.flatMap(w=>at[w]).map(w=>({modifier:"-",name:w})),m=v(c);o.push(m)}return o.join("+")},G=s=>s.map(Pt),Tt=s=>{const t={"+":[],"-":[],"~":[]};return s.forEach(r=>t[r.modifier].push(r)),t};class It{constructor(){g(this,"pid");g(this,"tags");g(this,"supertags");g(this,"blockedContent");g(this,"sortProperty");g(this,"sortDirection");g(this,"scoreValue");g(this,"rating");g(this,"scoreComparator");g(this,"tagString");this.pid=0,this.tags=[],this.supertags=[],this.blockedContent=[],this.sortProperty="id",this.sortDirection="desc",this.scoreValue=0,this.rating="all",this.scoreComparator=">="}withPid(t){return this.pid=t,this}withTags(t){return this.tags=t,this}withSupertags(t){return this.supertags=t,this}withSortProperty(t){return this.sortProperty=t,this}withSortDirection(t){return this.sortDirection=t,this}withScoreValue(t){return this.scoreValue=t,this}withScoreComparator(t){return this.scoreComparator=t,this}withRating(t){return this.rating=t,this}withBlockedContent(t){return this.blockedContent=Object.entries(t).filter(([r,e])=>e).map(([r,e])=>r),this}async getPageAndCount(){return this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags),Promise.all([this.getPage(),this.getCount()])}async getPage(){return this.tagString||(this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),W(this.pid,this.tagString)}async getCount(){return this.tagString||(this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),X(this.tagString)}getQuery(){return this.tagString||(this.tagString=k(this.tags,this.sortProperty,this.sortDirection,this.scoreValue,this.rating,this.scoreComparator,this.blockedContent,this.supertags)),Y(0,this.tagString)}}export{qt as A,Mt as K,It as S,Ot as a,zt as r,Et as s};
